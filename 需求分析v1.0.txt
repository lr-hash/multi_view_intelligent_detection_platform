小纪汗煤矿多视域智能侦测平台
1. 引言
1.1 文档目的
本文档旨在详细定义煤矿多视域智能侦测平台的建设需求，明确系统架构、功能模块、接口规范、网络设计及运行环境等核心内容，为系统设计、开发、测试、部署及验收提供统一的依据，确保平台满足煤矿安全生产中多源监测数据集成、压裂设计可视化及压裂效果科学评价的业务需求。
1.2 文档范围
本需求分析文档覆盖煤矿多视域智能侦测平台的全生命周期需求，包括系统概述、术语说明、系统结构、主体功能与业务逻辑、接口需求、网络总体设计、运行环境等模块，适用于小纪汗煤矿 11223 工作面及同类煤矿场景，涉及 KJ216 顶板动态监测系统、SOS 微震监测系统、水力压裂施工监测等多系统的数据集成与分析应用。
1.3 读者对象
1.项目决策层：煤矿企业管理人员、项目负责人，用于了解项目目标与整体规划；
2.技术实施层：系统架构师、开发工程师、测试工程师、运维工程师，用于指导技术落地；
3.业务使用层：煤矿生产技术人员、安全监测人员，用于明确业务操作与应用场景；
4.验收评估层：第三方测试机构、煤矿行业专家，用于开展系统验收与效果评估。
2. 系统概述
2.1 项目背景
小纪汗煤矿 11223 工作面作为 11 盘区北翼末采面，面临上一采空区侧向悬顶面积大、回风顺槽矿压显现剧烈（两帮及底板鼓起严重）等问题。现有防治手段存在局限性：加大支护强度属于被动防护，难以从源头解决问题；爆破切顶受炸药管控且易产生次生灾害。
当前煤矿已部署 KJ216 煤矿顶板动态监测系统、SOS 微震监测系统，但两套系统数据分散独立，缺乏统一整合分析；水力压裂施工过程中，压裂设计参数可视化不足，压裂效果缺乏多源数据支撑的科学评价体系。为实现矿压灾害精准防控，亟需建设多视域智能侦测平台，集成多系统数据，开发可视化与分析功能，为煤矿安全生产提供技术保障。
2.2 系统目标
2.2.1 数据集成目标
1.实现 KJ216 顶板监测、SOS 微震监测、水力压裂施工监测系统的无缝对接，数据同步成功率≥99.9%；
2.建立统一的数据标准体系，完成异构数据格式转换与标准化处理，数据存储正确率≥99.99%。
2.2.2 可视化目标
1.开发长水平孔压裂设计可视化模块，实现钻场、钻孔、压裂段的二维 / 三维展示，轨迹偏差可视化精度≤±0.5m；
2.构建统一数据看板，直观展示矿压、微震、变形、压裂等核心指标，页面加载响应时间≤2 秒。
2.2.3 分析评价目标
1.研发多源数据融合算法，实现顶板离层、微震能量、支架压力等数据的综合分析，单条数据处理延迟≤5 秒；
2.建立压裂效果评价模型，量化评估压裂前后矿压控制效果，自动生成评价报告，支持多格式导出。
2.2.4 安全运维目标
1.系统支持 7×24 小时连续运行，年平均故障时间≤8 小时，故障恢复时间≤30 分钟；
2.建立分级权限管控与数据加密机制，保障数据传输与存储安全，防止敏感信息泄露。
2.3 核心业务流程
2.3.1 数据采集与集成流程
1.接口对接：平台通过专用接口对接 KJ216 系统、SOS 微震系统、压裂设备，接收异构数据；
2.数据标准化：对接收数据进行格式转换、校验、清洗，转换为统一标准格式，剔除异常数据；
3.数据存储：结构化数据存入 SQL Server 数据库，非结构化数据（压裂曲线、报表）存入文件服务器，完成数据备份。
2.3.2 压裂设计与效果评价流程
1.压裂设计可视化：导入钻孔设计参数（坐标、轨迹、压裂段），通过三维渲染技术展示设计方案；
2.多源数据融合：提取压裂前后的矿压、微震、变形数据，通过融合算法生成综合监测指标；
3.效果分析：对比压裂前后数据变化，计算顶板稳定系数、压裂有效率等评价指标；
4.报告生成：自动生成压裂效果评价报告，支持 PDF/Excel 格式导出，推送至相关管理人员。
2.3.3 异常报警与处置流程
1.阈值设置：用户自定义监测指标报警阈值（如支架压力≥60MPa、巷道变形量≥50mm）；
2.报警触发：系统实时监测数据，指标超阈值时触发声光报警；
3.通知推送：通过平台消息、GPRS 短信将报警信息推送至相关人员；
4.处置反馈：记录报警处置过程与结果，形成闭环管理。
4. 系统结构
4.1 架构图
系统总体架构（分层架构）

4.2 功能图
思维导图链接
5. 主体功能与业务逻辑
5.1 集成接口模块
5.1.1 外部系统对接接口
（1）KJ653 煤矿顶板动态监测系统对接接口
1.功能描述：
KJ653 煤矿顶板动态监测系统对接接口用于实现多视域智能侦测平台与 KJ653 顶板动态监测系统之间的实时数据接入。该接口的核心功能是持续、稳定地从 KJ653 系统中获取顶板动态监测数据，并将数据提供给平台内部的数据管理、实时分析与预警模块使用。
本接口仅承担数据接入与传输职责，不直接面向工作人员提供数据查看、趋势展示或报表等功能。
2.业务逻辑：
链路初始化：程序启动时，根据配置文件中的 IP 地址或串口参数，连接至 KJ653 系统的 NPORT 以太网接口或 RDS 通讯单元 。
身份验证与授权：通过只读账户登录 KJ653 的地面 SQL Server 数据库或通过透明传输协议获取访问权限 。
周期性轮询：
接口模块发出读取指令（SQL 查询或串行读取请求）。
查询自上次采集时间（Timestamp）以后的所有新增原始记录。
数据镜像传输：
将读取到的每一行原始数据（包含所有原始字段，如标志符、原始压力值等）打包。
不做任何单位换算或阈值检查。
落库存储：将打包好的数据直接执行 INSERT 操作，存入平台数据库的临时缓冲表或 data_import_log 的 error_message 字段（若存储全报文）。
更新标记：记录最后一条成功接入的数据 ID，作为下次轮询的起始点。
3.输入输出：
输入：KJ653 系统原始监测记录
定义：输入是指从 KJ653 数据库（SQL Server）或硬件网关抓取的、未经处理的原始数据行。它包含了传感器在矿井现场采集的最基础数值（工作面支架作阻力检测、单体工作面支护阻力检测、围岩离层运动检测、锚杆载荷应力检测、岩层（煤层）内部应力检测、活柱缩量检测及巷道两帮顶底板收敛量监测）。
输入实例（以综采压力数据为例）：源自数据集 20250418105621综采数据.csv：


输出：平台透传封装报文
对定义：输出是指接口模块将上述原始数据进行“镜像映射”后的结构化对象。输出不改变任何字段内容，仅增加必要的对接元数据（如接入时间、源系统标识），以便后续处理模块调用。
输出实例（JSON 格式封装）： 该实例展示了上述原始记录被接口模块捕获后，原封不动地传递给平台存储层的形态：
输出实例：
{
  "source_system": "KJ653",
  "ingest_time": "2026-01-29T15:05:00Z",
  "data_category": "SupportPressure",
  "raw_data_record": {
    "RecordTime": "2025-03-05 10:56:21",
    "StationNo": 1,
    "SupportNo": 45,
    "Position": "中部",
    "P1": 32.50,
    "P2": 30.10,
    "P3": 0.00,
    "AngleX": 12.5,
    "AngleY": 3.2,
    "Status": "正常"
  },
  "metadata": {
    "original_id": "8892",
    "transfer_status": "Success"
  }
}
4.约束条件：
非侵入性：接口模块的运行不应影响 KJ653 系统正常的巡测功能和数据存储流程 。
透明度限制：严禁在接口层进行任何数据清洗（如去除 0 值、异常值处理），这些工作应由后续的“处理与分析模块”负责。
时序一致性：输出数据必须保留原始系统产生的 记录时间（RecordTime），严禁用接入平台的时间覆盖原始采集时间。
响应延迟约束：由于 KJ653 系统的巡测周期 ≤30s，接口模块的实时处理时延必须控制在 5s 以内，确保平台展示与现场动态同步 。 。
并发处理：当系统接入多工作面（如 11223 工作面、11223 回风）且测点数接近 1000 个时，模块需具备高并发数据吞吐能力 。
（2）SOS 微震系统对接接口
1.功能描述：
SOS 微震监测系统对接接口用于将矿井已部署的 SOS 微震监测系统产生的微震事件数据、传感器数据及系统运行状态数据实时或准实时接入煤矿多视域智能侦测平台。
该接口通过对 SOS 微震系统数据源的直接访问，实现微震原始数据的持续获取与转存，为后续微震活动分析、压裂影响评估及动力灾害预警提供基础数据支撑。
本接口仅承担微震监测原始数据的接入职责，不对数据进行事件判识、能量计算、空间分析或结果展示。
2.业务逻辑：
链路建立：模块通过 SOS 系统提供的标准数据分发端口（如 TCP Socket）或数据库（MS-SQL）只读账户进行连接。
事件流监听：监听器保持长连接状态，一旦 SOS 系统计算出新的微震事件并存盘，模块立即触发数据抓取。
原始字段抓取：从 SOS 系统中提取最核心的原始字段，包括：日期、时间（CZAS）、能量值（ENERGIA）、三维坐标（X, Y, Z） 。
封装与转发：将抓取到的原始行数据按照平台定义的格式进行报文封装，不做任何单位转换或震级换算，直接写入 microseismic_event 表 。
同步确认：记录最后一条同步成功的事件 ID 或时间戳，确保数据在网络波动后能自动补采，不重不漏。
3.输入输出：
输入：SOS 系统原始微震记录
定义：输入是指从 SOS 监测系统直接读取的原始数据行，反映了微震系统对岩层破裂事件的初始定位和能量估算结果 。
输入实例（源自数据集 微震（2025.5.4--2025.10.19）.xlsx） ： | Data (日期) | CZAS (时间) | X (m) | Y (m) | Z (m) | ENERGIA (能量/J) | | :--- | :--- | :--- | :--- | :--- | :--- | | 2025-05-04 | 00:33:22 | 5723.75 | 9736.28 | 803.62 | 1732.88 | | 2025-05-04 | 02:18:00 | 5818.67 | 9661.40 | 806.13 | 1825.31 | | 2025-05-04 | 05:14:24 | 5644.21 | 9686.44 | 803.36 | 736.31 |


输出：平台透传封装报文
定义：输出是接口模块对输入数据进行标准化包装后的结果，完整保留了原始的能量值和三维坐标，仅增加接入时间等元数据标签 。
输出实例（JSON 实时报文结构）：
{
  "header": {
    "msg_type": "MICROSEISMIC_EVENT_STREAM",
    "ingest_time": "2026-01-29T16:15:22Z",
    "source_system": "SOS_EMAG"
  },
  "payload": {
    "event_date": "2025-05-04",
    "event_time": "00:33:22",
    "coord_x": 5723.75,
    "coord_y": 9736.28,
    "coord_z": 803.62,
    "energy": 1732.88
  },
  "status": "SUCCESS_RAW"
}
4.约束条件：
零转换原则：模块严禁对坐标进行投影转换，严禁对能量（ENERGIA）进行任何形式的量级缩放或四舍五入。
实时性要求：接口模块的实时处理时延必须控制在 5s 以内，确保平台展示与现场动态同步 。
数据保真度：必须保留 SOS 系统原始的时间精度（包含毫秒位，若存在），这是后续分析压裂泵注压力与微震关联的关键。
唯一性约束：必须结合“日期+时间+坐标”作为唯一性校验，防止在重复同步或链路闪断后的补采过程中产生冗余记录 。
异常处理：若接入的原始能量值为 0 或坐标异常，接口应如实记录并推送，不得擅自丢弃，由后端的“压裂效果评价模块”负责逻辑过滤。
5.1.2 接口管理
（1）接口状态监测
1.功能描述：
链SQL 连通性实时检测：通过高频探针监测与各系统地面数据库（MS-SQL/MySQL 等）的链路连接状态。
数据新鲜度监控：实时计算数据库中最新记录的时间戳（T_{record}）与当前系统时间（T_{current}）的差值，即“数据延迟”。
状态自动分级：根据延迟时长将各接口划分为“正常（Online）”、“波动（Unstable）”及“离线（Offline）”三种状态。
主动预警推流：一旦接口状态发生非正常偏移，立即向 Web 前端推送预警报文，并驱动弹窗提醒。
该预警主要针对接口状态异常，不针对接收到异常数据的预警
2.业务逻辑：
心跳信号轮询：监测模块定时向各数据接入接口请求“生存信号”。该信号包含：SQL 连接是否成功、最后一次读取成功的记录时间。
延迟时间计算：计算公式：Latency = T_{current} - T_{last_record}。
状态判定准则：
正常 (Online)：SQL 连接成功且 Latency < 阈值1。
波动 (Unstable)：SQL 连接成功但 阈值1 <le Latency < 阈值2。
离线 (Offline)：SQL 连接断开 或 Latency >= 阈值2。
异常事件封装：当判定为“波动”或“离线”时，模块立即从 data_import_log 中调取最新的错误摘要，并封装成预警对象。
预警分发：通过 WebSocket 或长轮询机制将预警对象推送至 Web 界面。
3.输入输出：
输入：各接口运行状态元数据
说明：输入是由三个接入接口定期汇报的数据库连接指标及记录统计。
输入实例（表格形式）：
接口标识	最后记录时间
(Tlast_record​)	SQL 连接状态	当前系统时间(Tcurrent​)
KJ653_DB	2026-01-29 18:14:30	正常	2026-01-29 18:15:00
SOS_DB	2026-01-29 18:14:58	正常	2026-01-29 18:15:00
FRACTURE_DB	2026-01-29 18:10:00	超时	2026-01-29 18:15:00
输出：Web 前端预警弹窗报文
说明：当状态为“波动”或“离线”时，系统输出的 JSON 格式预警数据。输出实例（JSON 格式）：
{
  "action": "TRIGGER_ALARM_MODAL",
  "payload": {
    "interface_id": "FRACTURE_DB_001",
    "interface_name": "压裂设备实时接入接口",
    "current_status": "OFFLINE",
    "error_description": "SQL 数据库连接超时。自 2026-01-29 18:10:00 起无新数据写入。",
    "severity": "CRITICAL",
    "timestamp": "2026-01-29 18:15:05",
    "log_view_button": {
      "text": "查看日志",
      "target_url": "/admin/logs?source=FRACTURE_DB&status=error"
    }
  }
}
4.约束条件：
零耦合设计：监测模块严禁干预各接口的取数过程，仅作为观测者记录结果。
低负载查询：检索 record_time 时必须利用数据库索引字段，单次状态巡检对源数据库的 CPU 占用需 $<1\%$。
延迟阈值差异化：矿压接口（KJ653）建议阈值：波动 (60s)，离线 (300s)。
压裂数据建议阈值：波动 (5s)，离线 (30s)。
日志持久化：所有的接口状态切换及预警触发必须记录在 data_import_log 表中。
（注意：SOS 微震监测系统：基于“数据库心跳”
微震事件具有随机性（Stochastic），没有固定的产生频率，因此其阈值逻辑略有不同。
核心依据：SOS 系统将定位结果存储在 SQL 服务器中。在压裂施工期间，由于水力扰动，微震事件应较为频繁地产生；但在平时，可能数小时无事件。
监控逻辑：不能单纯依靠“数据更新时间”来判断，而应依靠 SQL Server 的连接心跳。
连通性阈值（10s）：如果接口模块连接 SOS 数据库的探测指令（Ping）在 10 秒内无响应，应判定为网络或数据库服务异常。
数据静默阈值（施工期间 300s）：在压裂进行时，如果 5 分钟没有任何微震事件记录，考虑到水力压裂必然伴随岩层破裂，这可能暗示数据接入链路已断开或系统灵敏度出现问题。）
5.Web界面显示：
接口健康看板：在主界面以三色灯（绿、黄、红）直观显示三个系统的接入状态。
预警弹出窗口：当输出状态为“波动”或“离线”时，屏幕中央弹出强提醒窗口。
窗口标题：明确显示“接口传输异常预警”。
窗口内容：指明具体哪个接口（如：SOS 微震系统接口）出现问题，并简述错误（如：数据断流时长过大）。
核心功能按钮：[查看日志] 按钮，点击后自动跳转至日志管理模块，并预过滤出该接口的报错详情。
（2）接口日志记录
1.功能描述：
接入事务持久化：实时记录三大接口（KJ653、SOS、压裂设备）每一次执行 SQL 轮询操作的详细结果，包括操作时间、耗时及影响行数。
异常详细堆栈记录：当数据库连接超时（Timeout）、拒绝连接（Refused）或 SQL 语法错误时，捕获完整的错误信息并分类存储。
断点位标维护：记录每次成功抓取的最后一条记录的时间戳或 ID，为下次“增量抓取”提供物理依据，确保施工数据不重不漏。
日志性能优化：采用异步写入机制，确保日志记录行为不会阻塞实时数据接入的主线程。
2.业务逻辑：
事务开始：对接接口发起 SQL 抓取动作（如从 KJ653 库读取支架压力）时，日志模块同步初始化一条待记录项。
执行监控：成功场景：记录抓取的记录条数（record_count），更新导入状态为 成功。失败场景：捕获底层的 Exception 信息（如：Network is unreachable），更新状态为 失败，并将报错详情写入 error_message 字段。
位标回写：若本次抓取成功，将最新的 RecordTime 回写至配置表，作为该接口的“断点标记”。
信号通知：日志写入完成后，向“接口状态监测模块”发送一个“任务完成”信号，包含当前的延迟时间 Latency。
定期清理：为保证数据库性能，自动清理 30 天以前的常规成功日志，但永久保留报错类日志。
3.输入输出：
输入：接口执行反馈 (Interface Execution Feedback)
说明：该输入是对接接口模块在尝试执行数据库读取操作后，反馈给日志模块的原始执行指标。

字段名称	实例值 (KJ653)	实例值 (压裂设备)	实例值 (SOS)
操作接口	KJ653_PRESSURE_INTERFACE	FRACTURE_PUMP_INTERFACE	SOS_MICROSEISMIC_INTERFACE
执行结果	SUCCESS	FAILURE	SUCCESS
读取行数	32	0	1
错误摘要	NULL	SQL Server Connection Timeout (1433)	NULL

输出：data_import_log 物理表记录
说明：日志模块处理后，在数据库中生成的结构化行数据。
输出实例 (JSON 映射视图)：
{
  "log_id": 20260130001,
  "file_name": "SQL_SYNC_11223_FRACTURE",
  "data_type": "压裂施工数据",
  "record_count": 0,
  "import_status": "失败",
  "error_message": "Exception: Connection timed out. Source: 192.168.1.50:1433. Retry in 30s.",
  "import_time": "2026-01-30 10:45:05",
  "operator": "SYSTEM_AUTO_INGEST"
}
4.约束条件：
存储空间控制 (Feasibility)：由于压裂数据为 1s 级接入，每日日志量巨大。系统必须每 24 小时对“成功”类日志进行聚合汇总（如“昨日成功执行 86400 次”），仅保留“失败”类的详细条目，以保护磁盘 IO。
索引优化：data_import_log 表的 import_time 和 import_status 字段必须建立复合索引，确保 Web 界面在查询日志时响应时间 $< 500ms$。
报错等级化：1级 (Warning)：网络瞬时抖动导致的单次失败（不弹出预警）。
2级 (Critical)：连续 3 次尝试失败，或连接被拒绝（触发预警弹窗）。
事务隔离：日志模块必须在独立的数据库连接池中执行，防止主数据业务因日志表锁死而受到影响。
5.Web 界面显示内容及工作人员操作流程
Web 界面显示内容：
日志列表页：
实时滚动栏：显示最新的 50 条数据接入记录，异常行以红色底纹高亮。
快捷过滤器：支持按“接口类型（矿压/微震/压裂）”和“导入状态（成功/失败）”一键筛选。
详情透视窗：点击某条错误记录，弹出浮窗显示原始 SQL 错误代码及当时的系统环境参数。
关联跳转：当接口监测模块弹出预警时，点击“查看日志”按钮，系统将自动在当前页面高亮定位至该接口报错的最早起始点。
工作人员操作流程：
查阅日志：当 Web 界面弹出“接口离线”预警时，工作人员点击 [查看日志]。
定位根因：若 error_message 为 Invalid credentials：前往系统设置检查数据库账号密码是否过期。若 error_message 为 Target machine actively refused it：联系矿信息中心，确认 KJ653 或 SOS 服务器是否宕机或防火墙策略变更。
人工重试 (Manual Retry)：修复物理故障（如重启服务器）后，工作人员点击界面上的 [立即同步]。
校验闭环：观察日志表中是否出现新的 import_status = '成功' 记录，确认 Latency（延迟）逐渐缩小，预警窗自动关闭。
(3)接口参数配置
1.功能描述：
数据库连接参数管理：配置与各系统（KJ653、SOS、压裂集控）地面服务器连接所需的 IP 地址、端口号（如 SQL Server 默认的 1433）、数据库名称及认证凭据。
同步频率设置：针对不同数据源设定个性化的 SQL 轮询间隔（Interval），以匹配矿压系统的 30s 巡测周期或压裂施工的秒级实时要求。
断点与位标管理：存储并允许手动修改最后一次成功抓取的记录时间戳（Last Timestamp）或自增 ID，确保在系统重启后能够实现断点续传。
工作面与关联映射：将接入的数据流与平台中的 working_face_id（如 11223 工作面）及 roadway_id（如 11223 回风）进行逻辑绑定。
2.业务逻辑：
参数持久化：管理人员在 Web 界面输入的配置参数被存储于平台的系统配置表中。
运行时加载：对接接口模块在启动或接收到“刷新配置”指令时，动态加载对应接口的数据库连接字符串。 
模式自动切换：当系统检测到处于“压裂施工状态”时，该模块可自动将压裂接口的轮询间隔从静态模式（如 60s）切换为施工高频模式（如 1s）。
连接预校验：在保存配置前，模块会自动执行一次微型 SQL 探测（如 SELECT GETDATE()），以验证所配参数的可行性和连通性。 
安全加密：对存储的数据库密码进行加密处理，确保矿井监测系统敏感凭据不被明文泄露。
3.输入输出：
输入：Web 界面配置参数 (Staff Input)
说明：由工作人员在管理后台填写的各接口物理及逻辑参数。
配置项	KJ653 接口实例	SOS 接口实例	压裂设备接口实例
服务器 IP	192.168.1.10	192.168.1.20	192.168.1.50
DB 端口	1433	1433	3306 (MySQL)
数据库名	KJ653_DB	SOS_Event_DB	Fracturing_System
轮询间隔	10s	5s	1s (施工模式)
绑定工作面	11223 工作面	11223 工作面	11223 回风

输出：后端执行引擎配置对象 (JSON)
说明：接口模块读取配置表后生成的、用于驱动 SQL 取数任务的结构化对象。
输出实例：
{
  "interface_config": {
    "target": "KJ653_Support_Pressure",
    "connection_string": "jdbc:sqlserver://192.168.1.10:1433;databaseName=KJ653_DB",
    "polling_interval_ms": 10000,
    "last_sync_point": "2026-01-30 08:00:00",
    "mapping": {
      "face_id": 1,
      "roadway_id": 1
    },
    "retry_policy": {
      "max_attempts": 3,
      "backoff_ms": 5000
    }
  }
}
4.约束条件：
只读权限强制性 (Feasibility)：所有配置的数据库账号必须仅具备 SELECT 权限。 这是确保不干扰矿压与微震系统运行的最底层可行性要求。
网络隔离合规性：配置的 IP 地址必须处于矿井工业以太环网的受信范围内，确保数据采集不跨越非安全网络边界。 
轮询频率上限：为防止过量查询拖慢源系统 SQL Server 的性能，单个接口的轮询频率不得高于每秒 2 次（$\ge 500~ms$）。
时钟对齐约束：配置参数中应包含“时差修正值”，用于补偿源系统服务器与平台服务器之间的系统时间差异，确保压裂评价时的数据对齐精度。
5.2 数据处理模块
5.2.1 数据校验
（1）数据完整性与合理性校验
1.主要功能：全维度数据审查
模块需对从统一数据库抓取的动态监测表进行秒级审查，核心校验点如下：
完整性校验：
对象：所有接入表（support_pressure_data, microseismic_event, roof_separation_data 等）。
标准：
主键与时间戳：id, record_time / event_time 必须非空且格式正确。
外键关联：working_face_id 或 roadway_id 必须在基础配置表中有对应记录。
核心物理量：压力表中的 p1_pressure、微震表中的 energy 严禁出现 NULL。
合理性校验：
KJ653 矿压/应力/位移标准：
支架压力：p1_pressure ϵ[0, 60.0] MPa（超过 60MPa 判定为压力突变异常或传感器损坏）。
顶板离层：deep_separation 与 shallow_separation ϵ [0, 300.0] mm。
锚杆应力：stress_value ϵ [0, 1000.0] kN。
SOS 微震标准：能量值：energy > 0（物理现象中破裂能量必须为正）。
空间坐标：coord_x, coord_y, coord_z 必须处于 working_face 表定义的坐标矩形内（防止系统误报矿界外的干扰信号）。
逻辑一致性校验：
离层对比逻辑：深基点离层值（deep_separation）必须 >= 浅基点离层值（shallow_separation）。
时序逻辑：数据的 record_time 不得晚于服务器当前系统时间（防止采集系统时钟超前导致的时序错乱）。
2.业务逻辑：开发实现路径
开发人员需按照以下“过滤器”流水线实现逻辑：
配置加载器：从内存缓存中读取 monitoring_device 表中的各测点量程上限。
多层过滤引擎：
第一层（非空判断）：IF (data.p1_pressure == null) -> ROUTE_TO_ERROR_DB
第二层（范围判断）：IF (data.energy < 0 || data.energy > 1e10) -> ROUTE_TO_ERROR_DB
第三层（空间判断）：对比微震点与工作面 CAD 边界，IF (isOutside(coord, boundary)) -> ROUTE_TO_ERROR_DB
结果分类器：
Success：更新该条记录状态 is_valid = 1，将数据推入 Redis 实时消息队列（供时间对齐模块订阅）。
Failure：更新记录状态 is_valid = 0，调用日志组件写入 data_import_log。
异常触发器：异步发起 WebSocket 通知 给 Web 前端，携带具体的错误诊断信息。
3.输入输出
输入：待校验的原始 JSON 记录 (微震实例)
{
  "source_table": "microseismic_event",
  "data": {
    "event_time": "2026-01-31 10:15:00",
    "energy": 5000.0,
    "coord_x": 99999.99, // 假设矿区 X 坐标范围仅为 30000-40000
    "coord_y": 28100.0,
    "coord_z": -600.0
  }
}
输出：校验异常后的路由与警告信息
{
  "status": "ABNORMAL_DETECTED",
  "error_code": "ERR_SPATIAL_OUT_OF_BOUNDS",
  "diagnostic": "微震事件 X 坐标 (99999.99) 超出工作面定义范围。",
  "route": "ABNORMAL_DATABASE",
  "ui_action": {
    "show_modal": true,
    "title": "数据空间校验失败",
    "content": "检测到非本区域微震信号，已封存。"
  }
}
4.约束条件：
可行性与性能底线处理时延（Performance）：由于压裂期间数据激增，校验模块对单条记录的处理时间必须 <=5 毫秒。
配置实时性：若管理人员在“参数配置模块”修改了量程（如从 60 改为 80），校验模块必须在 5 秒内 完成配置重载。
异常回溯：异常数据库必须保留至少 30 天的原始报文，以供在发生“压裂事故”后进行离线取证。
原子性要求：数据的“路由到异常库”与“写入日志”必须在一个数据库事务内完成，严禁出现有日志无数据的情况。
5. Web 界面显示内容及工作人员操作流程
Web 界面显示内容：
异常拦截浮窗（强交互组件）：
警报标题：[数据质量预警] 发现非法监测数值。
故障源详情：显示“数据表：支架压力表 | 测点：112号支架”。
数值对比：实测值: 75.40 | 合法区间: [0, 60.00]。
操作按钮：
[查看校验日志]：点击后直接在侧边栏拉出该数据的完整 JSON 报文。
[临时放行]：针对极端压裂情况，允许授权人员点击此按钮，使该数据重新进入计算链。
全局质量仪表盘：
饼图：今日校验通过 vs 校验拦截。
排行榜：列出故障频率最高的 Top 3 传感器（帮助定位硬件老化问题）。
工作人员操作流程
警报接收：工作人员在监控 11223 工作面时，收到弹窗提醒：“11223 回风顺槽离层仪数据逻辑冲突（深部 < 浅部）”。
日志查证：点击 [查看校验日志]，确认最近 5 分钟该测点的离层数据始终处于冲突状态。
现场联动：判定为传感器机械卡死或线路短路，通知井下巡检人员前往 11223 回风顺槽核实。
异常标记：在 Web 界面将该时间段标记为“设备维修期”，系统将自动忽略该测点的异常，避免持续弹出预警。
恢复确认：维修完成后，观察界面状态，确认新接入的离层数据已通过“逻辑一致性校验”，绿色通行灯亮起。
(2)数据时间对齐与空间标准化
1.主要功能：
构建统一的时空基准该模块负责解决 KJ653 矿压数据（阶梯式、低频）与 SOS 微震数据（脉冲式、高频）之间的“不合拍”问题。
时间轴对齐（Temporal Alignment）校验标准：
以 1 秒（1s） 为标准步长构建全局时序轴。
对齐对象：
KJ653 动态表：由于支架压力（support_pressure_data）和离层数据（roof_separation_data）是每 30s 巡测一次，模块需通过线性插值填充 1s 步长的空隙，使之能与秒级的微震事件和压裂施工数据精准对齐。
SOS 微震表：将离散的事件时间戳映射到最近的整秒刻度上。
空间标准化（Spatial Standardization）坐标归一化：
统一基准：以 working_face（工作面信息表）中定义的孔口设计坐标或矿井全局坐标为原点。
标准化转换：将 microseismic_event 中的 $X, Y, Z$ 坐标与工作面推进位置（巷道走向）进行相对坐标转换。
空间索引：为每个数据点打上“区域标签”（如：距工作面 10-20m 范围、回风巷侧等），方便后续空间挖掘。
2.业务逻辑：
开发实现算法开发人员应遵循以下数据清洗逻辑：
全局时钟同步（Sync）：
读取 data_import_log 中的各表最新时间。若两个系统的时钟偏差超过 5s，则根据 working_face 中的时差修正系数进行强制平移。
线性插值算法（Linear Interpolation）：
对于 support_pressure_data，设 $T_1$ 时刻压力为 $P_1$，$T_2$ 时刻为 $P_2$。对于任意 $t ϵ (T_1, T_2)$，该秒的预测压力 $P_t$ 计算如下：

限制条件：若 $|T_2 - T_1| > 90s$（即丢失 3 个以上巡测周期），则判定为数据中断，禁止插值，标记为空。
空间投影引擎（Projection）：
调用 borehole_trajectory（钻孔轨迹表）数据。
计算微震事件坐标点 $(X_e, Y_e, Z_e)$ 距离当前压裂钻孔中心线的垂直距离。
特征向量生成：
将对齐后的结果封装为：{Timestamp, Support_Pressure, Micro_Energy, Relative_X, Relative_Y}。
3.输入输出说明及实例（开发级细节）
输入：
校验合格的异步数据流数据 
A（矿压）：2026-02-01 10:00:00, 压力 30MPa；下一条 10:00:30, 压力 33MPa。数据 B（微震）：2026-02-01 10:00:15, 能量 500J。
输出：
标准化后的关联数据集输出结果（JSON 视图）：
JSON{
  "standard_timestamp": "2026-02-01 10:00:15",
  "aligned_features": {
    "pressure_p1": 31.5, // 经过插值计算：30 + (33-30)*(15/30)
    "micro_energy": 500.0,
    "spatial_tag": "11223_Face_Advancing_Zone",
    "relative_coord": { "dx": 15.5, "dy": -2.0, "dz": 10.2 }
  },
  "metadata": { "interp_method": "LINEAR", "confidence": 0.95 }
}
4.约束条件：
计算漂移容差：微震事件发生时间与最近一个矿压采集点的偏移量不得超过 1.5s，否则该微震点判定为“孤立点”，不参与压裂压力相关性分析。
空间冗余度：标准化后的坐标点需保留 2 位小数，以满足 11223 工作面施工设计中关于“分段压裂位置精度”的要求。
内存回收：由于插值计算会产生 30 倍于原始数据量的数据流，该模块必须采用 滑动窗口模式（Sliding Window），仅保留内存中最近 1 小时的对齐数据。
时序单调性：对齐后的数据集必须严格按 Timestamp 升序排列，严禁出现乱序，否则会直接导致前端动态曲线“跳帧”。
5.Web 界面显示内容及工作人员操作流程
Web 界面显示
时空对齐监控看板：
双轴动态曲线图：上方显示插值后的平滑矿压曲线，下方显示对应的微震能量脉冲。
3D 标准化视图：在 11223 工作面 CAD 底图上，实时渲染标准化后的微震点位置，点的大小代表能量，颜色代表与矿压波动的关联度。
对齐质量告警窗：
当输出状态为 “插值失效”（数据断流）时弹出。
内容：[警告] 矿压系统与微震系统时钟差值 > 10s，关联评价已自动挂起。
按钮：[强制时钟对齐]、[查看原始延迟日志]。
工作人员操作流程
基准设定：在压裂工程开始前，工作人员通过 Web 界面选定 “主参考系”（通常选定压裂钻孔孔口坐标）。
同步校验：观察实时曲线，确认当微震发生时，插值后的矿压曲线是否有同步波动响应。
参数干预：若发现微震点密集出现在工作面边界外，工作人员点击 [重新校准坐标原点]，系统将重新执行标准化计算。
异常处置：若收到“插值失效”弹窗，点击 [查看原始延迟日志]。若判定为统一数据库读取延迟，点击 [增大对齐窗口]（由 5s 延至 15s）。若判定为源软件停机，则在界面标记该段为“无效分析期”。
导出报告：施工结束后，一键导出“时空标准化数据集”供专家组进行压裂效果终审。
5.2.3 多元数据融合算法
（1）加权融合算法
1. 算法概览 (Algorithm Overview)
A. 核心定位 (Core Positioning)
加权融合算法是多元数据融合体系中的逻辑基石与归一化引擎。若将多源监测数据视为语言不通的“各国代表”，本算法即为**“同声传译与汇总官”**，其职能是将物理世界的“硬指标”翻译为数学世界的“软风险”。
在煤矿安全监测的实际场景中，系统面临的最大计算障碍是**“多物理量纲的不可比性”**：
矿压 (Strata Pressure)：表征的是力，单位为 MPa（兆帕），数值通常在 0~50 之间。
微震 (Microseismic)：表征的是能量，单位为 J（焦耳），数值跨度极大（10²~10⁵）。
变形 (Deformation)：表征的是位移/速率，单位为 mm（毫米），数值通常在 0~100 之间。
压裂 (Fracturing)：表征的是工况状态，表现为布尔值或流体压力。
本算法的核心任务是建立一个映射函数 $f(x)$，执行以下转化：
去量纲化：剥离上述物理单位，消除数量级差异（如消除 $10^4$ 与 $10^1$ 的偏差）。
归一化映射：将所有异构数据线性或非线性地映射至 $[0, 1]$ 标准风险域（0 代表绝对安全，1 代表理论极限风险）。
输出定义：产出一个无量纲的、初步的加权融合得分 (Raw Fusion Score)，该得分仅代表当前的瞬时综合态势，为下游“综合指标计算模块”的时间序列分析提供唯一的数学输入基础。
B.核心能力 (Core Capabilities)
异构数据同构化 (Data Homogenization)
通过内置的归一化算法（如 Min-Max Scaling 或 Sigmoid 激活函数），将不同物理意义的监测值转化为统一的**“风险隶属度”**。
效果：使得系统能够从数学层面判断：40MPa 的支架压力带来的风险值（如 0.8）与 10000J 的微震能量带来的风险值（如0.8）是等价的，从而实现跨物理量的直接代数运算。
专家经验数字化 (Experience Digitization)
将行业专家对不同灾害前兆的定性认知（例如：“在冲击地压防治中，微震监测的重要性高于表面变形监测”），转化为算法配置文件中精确的定量权重参数（如 $W_{ms}=0.3 > W_{def}=0.2$）。
效果：确保算法的计算结果符合煤矿安全生产的物理规律和先验知识，而非单纯的数据统计结果。
故障自适应能力 (Fault Adaptation)
建立动态权重重分配机制 (Dynamic Weight Re-balancing)。算法实时监控输入数据的有效性标记（Valid Flag），一旦检测到某路传感器（如微震系统）离线或数据异常（NaN/Null）：
立即将该路数据的权重 $W_i$ 临时置为 0。
自动将该失效权重按比例分配给剩余的在线传感器。
效果：确保融合计算的分母（权重之和）始终归一化为 1.0，保证输出的融合得分不会因设备故障而出现“断崖式下跌”或“假阴性漏报”，维持监测结果的连续性。
2. 数学模型与逻辑 (Mathematical Model)
本算法采用 线性加权求和模型 (Linear Weighted Sum Model)，辅以 动态权重重分配机制。
步骤一：数据归一化 (Normalization)
所有输入指标必须映射[0, 1] 区间，表示风险隶属度（0代表安全，1代表极度危险）。
正向指标（数值越大越危险）：如支架阻力、微震能量、变形速率。
采用 分段线性映射 或 极值归一化 公式：

其中：$x_i$ 为实测值，$L_{min}$ 为安全基线，$L_{max}$ 为危险饱和值（如支架额定阻力）。
负向指标（数值越小越危险）：如压裂施工压力（防泄漏）。

B. 步骤二：权重分配体系 (Weighting System)
权重的确定采用“静态预设 + 动态调整”策略。
基础权重 ($W_{base}$)：
由 AHP（层次分析法）结合现场专家打分确定。假设系统初始配置如下：
矿压权重 (W_p): 0.4
微震权重 (W_e): 0.3
变形权重 (W_d): 0.2
压裂权重 (W_f): 0.1
(注：∑W = 1.0)
C.步骤三：缺失数据处理与权重重构 (Dynamic Re-balancing)
这是本算法鲁棒性的关键。当某一路传感器（如微震系统）掉线或数据被标记为无效（NULL/NaN）时，算法不能简单地将其项置为0（否则会导致总分偏低，造成漏报）。
重分配逻辑：
识别当前有效的指标集合 $S_{active}$。
计算有效指标的基础权重之和 
计算新的临时权重 $W'_{i}$：

举例：若微震 ($0.3$) 掉线，剩余基础权重之和为 $0.4+0.2+0.1 = 0.7$。
矿压新权重 = 0.4 / 0.7≈0.57
变形新权重 = 0.2 / 0.7≈0.29
压裂新权重 =0.1 / 0.7≈0.14
D.步骤四：融合计算 (Fusion Calculation)
最终的加权融合得分 $I_{fusion}$ 计算公式为：

结果 $I_{fusion}$ 必然落在 $[0, 1]$ 区间内。
3. 输入输出详细定义 (I/O Specification)
A.算法输入 (Inputs) 算法接收一个包含多维数据的结构体对象：
参数名	数据类型	单位	说明	来源模块
val_pressure	Float	MPa	支架平均工作阻力	数据标准化模块
val_energy	Float	J	当前微震事件能量	数据标准化模块
val_deformation	Float	mm/d	巷道变形速率	数据标准化模块
val_fracture	Float	MPa	压裂记录压力	压裂台账模块
status_flags	Object	-	各子系统在线状态 {P:1, E:0, ...}	系统监控服务

B.算法输出 (Outputs) 算法输出计算结果对象，供下一级“综合指标计算”使用：
参数名	数据类型	说明	示例值
raw_fusion_score	Float	初步融合分数 (0~1)	0.765
active_weights	Object	当前生效的权重快照	{P: 0.57, D: 0.29, ...}
contributions	Object	各分项对总分的贡献值 (W′×N)	{P: 0.45, D: 0.10, ...}
is_rebalanced	Boolean	是否触发了权重重分配	TRUE
4. 约束条件与边界处理 (Constraints)
为了保证算法在极端情况下的稳定性，必须执行以下约束：
归一化截断 (Clamping)：
若输入值 $x_i > L_{max}$，归一化结果 $N_i$ 强制置为 1.0。严禁出现 $>1.0$ 的值参与加权，否则会破坏权重的数学意义，导致最终得分溢出。
全系统离线熔断：
若 status_flags 显示所有子系统均离线（$W_{sum} = 0$），算法应直接返回 fusion_score = 0 并抛出“数据源完全丢失”的异常状态码，严禁执行除零运算。
微震瞬时性处理：
微震是离散事件。算法需维护一个 时间衰减窗口。当大能量事件发生后，其归一化值 $N_e$ 瞬间置为 1，随后随时间（如 10秒内）线性衰减至 0。防止微震信号“一闪而过”，导致融合指标来不及反应。
5. 算法测试用例 (Test Cases)
用例 ID	测试场景	输入模拟	预期计算过程	预期结果
TC-ALG-01	标准工况	矿压: 满量程50%微震: 0变形: 0压裂: 0全在线	Np​=0.5,Nothers​=0Wp​=0.4Score=0.5×0.4	0.2
TC-ALG-02	高危截断	矿压: 满量程120% (超限)微震: 满量程50%全在线	Np​=1.0 (被截断)Ne​=0.5Score=1.0×0.4+0.5×0.3	0.55
TC-ALG-03	离线重分配	矿压: 满量程100%微震: 掉线 (W=0.3)变形: 0压裂: 0	有效权重和 Wsum​=0.4+0.2+0.1=0.7矿压新权重 Wp′​=0.4/0.7≈0.57Score=1.0×0.57	0.57(比用原权重算的 0.4 要高，符合逻辑)

(2)综合指标计算
1.功能描述 (Functional Description)
A.核心定位 
本模块是系统的**“高级分析师”与“阅卷老师”。 在前序环节中，我们完成了数据的清洗、归一化和初步加权融合。本模块的核心任务是利用这些基础数据，结合特定的工况评价模型**，计算出直观反映工作面安全状态和工程效果的核心综合指标。
B.核心能力
状态量化评价：将复杂的岩层运动状态，浓缩为“顶板稳定系数”这样一个 0~100 的直观分数，让管理者一眼看懂顶板稳不稳。
工程效果验收：针对压裂施工，通过对比施工前后的风险等级和变形数据，自动计算“压裂有效率”和“矿压控制效果”，用数据回答“钱花得值不值”的问题。
分级预警支撑：不仅输出数值，还根据预设标准自动划分“优秀、良好、合格、不合格”等级，直接指导现场管理。
2. 业务逻辑 (Business Logic)
本模块包含三个独立的计算引擎，分别对应三个核心指标的算法逻辑。
A.顶板稳定系数计算引擎 (Roof Stability Engine)
该指标用于实时评估当前工作面顶板的整体稳定性。
输入参数：
$V_{sep}$：顶板离层标准化值（范围 0~1，来自标准化模块）。
$C_{v}$：支架压力波动系数（$C_v =σ/μ，统计过去 10 分钟内支架阻力的标准差与均值之比，反映受力平稳度）。
计算公式：

(注：若计算结果 <0，强制置为 0)
等级判定逻辑：
稳定 (Green)：I_{roof}>=80
基本稳定 (Yellow)：60 <= I_{roof} < 79
不稳定 (Red)：I_{roof} < 60
B. 压裂有效率计算引擎 (Fracturing Efficiency Engine)
该指标用于在压裂施工结束后，评估其对降低整体灾害风险的贡献度。
输入参数：
$R_{pre}$：压裂前风险等级得分（取压裂开始前 24h 内“加权融合风险指数”的平均值）。
$R_{post}$：压裂后风险等级得分（取压裂结束后 24h 内“加权融合风险指数”的平均值）。
计算公式：

等级判定逻辑：
有效：E_{frac} >= 30% （风险显著降低）
一般：10% < E_{frac} < 29% （风险有所缓解）
无效：E_{frac} < 10% （风险无明显变化，甚至恶化）
C.矿压控制效果指标计算引擎 (Strata Control Engine)
该指标侧重于从“围岩变形”角度评估卸压效果。
输入参数：
D_{pre}：压裂前巷道累计变形量（mm，统计前 3 天增量）。
D_{post}：压裂后巷道累计变形量（mm，统计后 3 天增量）。
计算公式：

等级判定逻辑：
优秀：I_{control} >= 70 （变形量减少 70% 以上）
良好：50 <= I_{control} < 69
合格：30 <= I_{control} < 49
不合格：I_{control} < 30
3. 输入输出 (Input & Output)
模块输入 (Inputs) 
模块需订阅上游实时数据流及历史统计数据：
变量名	来源模块	类型	说明
norm_roof_separation	标准化模块	Float (0~1)	顶板离层归一化值
pressure_fluctuation	统计服务	Float	支架压力波动系数 (Cv​)
fusion_risk_score	加权融合算法	Float (0~1)	实时融合风险指数
deformation_accum	标准化模块	Float (mm)	巷道累计变形量
frac_status	压裂台账模块	Enum	施工状态 (START/END) 用于触发前后对比
模块输出 (Outputs) 
计算结果封装为 JSON 对象，供前端看板和报表模块使用：
{
  "module": "COMPOSITE_CALC",
  "timestamp": "2026-02-01 12:00:00",
  "data": {
    "roof_stability": {
      "value": 85.4,
      "level": "STABLE",
      "text": "稳定"
    },
    "fracturing_efficiency": {
      "value": 35.2, // 百分比
      "level": "EFFECTIVE",
      "text": "有效",
      "is_valid": true // 仅在压裂后显示
    },
    "strata_control": {
      "value": 72.1,
      "level": "EXCELLENT",
      "text": "优秀"
    }
  }
}
4. 约束条件 (Constraints)
除零保护 (Division by Zero Protection)：
在计算“压裂有效率”时，若 R_{pre} ≈ 0（压裂前风险极低），则公式无意义。此时应强制返回 value: 0, level: "N/A", text: "样本无效"。
同理，计算“矿压控制效果”时，若D_{pre} ≈ 0，亦做同样处理。
负值处理 (Negative Value Handling)：
若压裂后风险反而升高（R_{post} > R_{pre}），计算结果为负数。系统应如实显示负值（如 -10%），并强制评级为“无效”。
时间窗口闭锁 (Time Window Latch)：
压裂效果类指标（有效率、控制效果）不是实时跳动的，而是在**“压裂结束后”**触发一次性计算，并将结果固化存入数据库，直到下一次压裂施工开始。
5. Web界面与操作流程
A.界面展示
仪表盘区 (Dashboard)：
顶板稳定系数：使用刻度仪表盘 (Gauge Chart) 展示。
绿色区间：80-100
黄色区间：60-79
红色区间：0-59
指针指向当前值，下方显示文字“稳定”。
工程验收卡片 (Evaluation Card)：
显示“压裂有效率”和“矿压控制效果”的进度条/子弹图。
如果评级为“不合格/无效”，显示红色警告图标。
B.交互流程
日常监控：用户查看大屏，关注仪表盘指针，只要在绿色区域即可安心生产。
压裂验收：
当压裂队报告施工结束，在系统录入“完工时间”。
系统自动截取前后数据进行计算。
用户在界面上看到“最新压裂评价：有效”，点击可查看前后对比的详细折线图。
6. 测试用例 (Test Cases)
用例 ID	测试场景	输入模拟	预期结果 (Pass Criteria)
TC-CALC-01	顶板系数-稳定	离层值=0.1, 波动系数=0.1	(1−0.04−0.06)×100=90。等级：稳定。
TC-CALC-02	顶板系数-不稳定	离层值=0.8, 波动系数=0.5	(1−0.32−0.3)×100=38。等级：不稳定。
TC-CALC-03	压裂有效率-负增长	前风险=0.4, 后风险=0.5	(0.4−0.5)/0.4=−25%。等级：无效。
TC-CALC-04	除零异常边界	前风险=0.0	系统不报错，返回结果为 N/A 或 0，提示“前置风险过低，无法评估”。


(3) 融合结果验证
1. 功能描述 (Functional Description)
A. 核心定位
本模块是保障算法科学性的最后一道防线。
任何算法模型在投入使用后都可能面临“水土不服”的问题。本模块通过对比人工经验、监测历史波动及参数敏感度，对前序“加权融合”与“综合计算”的输出结果进行实时体检。
B.核心能力
准确性校验 (Accuracy Check)：定期“通过图灵测试”，即判断算法的评价结果是否与现场专家的判断一致。
稳定性监测 (Consistency Check)：防止算法出现“心电图式”的剧烈跳动，确保评价结果在时间上的连续合理性。
鲁棒性分析 (Sensitivity Check)：确保算法不会因为某一个非关键指标的微小波动而产生过激反应（蝴蝶效应）。
闭环优化 (Optimization Loop)：一旦发现质检不合格，自动触发报警并提示工程师调整权重参数。
2. 业务逻辑 (Business Logic)
本模块包含四个串行执行的验证逻辑，通常以**“天”或“周”**为周期触发，也可人工强制触发。
A. 对比验证逻辑 (Comparative Verification)
目的：计算算法的“拟人度”。
输入：
L_{algo}：算法输出的日报风险等级（自动）。
L_{human}：现场专家填报的当日风险等级（人工录入）。
逻辑：
选取最近 N 天（如 30天）的数据样本。
统计两者等级一致（L_{algo} == L_{human}）的天数 $D_{match}$。
计算准确率：
判定：
若 Acc < 90%，标记为 “模型失准”，系统生成一份差异报告，列出所有不一致的日期，供专家复盘。
B. 一致性验证逻辑 (Consistency Verification)
目的：识别并过滤算法的“异常抖动”。
输入：融合风险指数的时间序列I(t)。
逻辑：
计算相邻两个时间窗口（如今日与昨日）的变异系数或均方根误差 (RMSE)。
检测是否存在 “瞬时尖峰”：即在无微震大事件且矿压平稳的情况下，风险指数 I(t) 突然在 1分钟内从 0.2 跳变到 0.8 又回落。
判定：
若存在非物理性突变，标记为 “算法噪点”，提示检查“加权融合算法”中的防抖逻辑是否失效。
C. 敏感性验证逻辑 (Sensitivity Analysis)
目的：确保权重配置合理，防止“一票否决”现象泛滥。
逻辑 (OAT法 - One-at-a-Time)：
保持其他指标不变，人为将某一指标 x_i 增加 10%。
观察最终融合结果 I_{fusion} 的变化幅度 ∆I。
计算敏感度系数。
判定：
若某非关键指标（如变形）的 S_i > 2.0（即输入变10%，结果变20%），说明该指标权重过高，容易导致误报，建议下调权重。
D. 验证结果闭环处理 (Result Handling)
系统根据上述验证结果，输出决策建议：
场景 A：准确率 < 90%。
动作：系统推送“权重推荐调整方案”。例如：“建议将微震权重从 0.3 上调至 0.35”。
场景 B：一致性差（噪点多）。
动作：系统自动增大前序模块的“滑动平均窗口”长度（如从 30s 调整为 60s）。
场景 C：敏感度异常。
动作：高亮显示权重配置表中的异常项，强制要求管理员确认。
3. 输入输出 (Input & Output)
A. 模块输入 (Inputs)
算法侧数据：
fusion_result_history: 历史融合风险指数序列。
current_weights: 当前生效的权重配置。
人工侧数据：
human_evaluation_log: 专家每日填报的安全评估表（等级：安全/关注/危险）。
B. 模块输出 (Outputs)
输出一份算法体检报告：
JSON
{
  "module": "ALGO_VERIFICATION",
  "report_period": "2026-02-01 ~ 2026-02-28",
  "data": {
    "accuracy": {
      "value": 88.5, // 百分比
      "status": "WARNING", // <90% 触发警告
      "mismatch_dates": ["2026-02-14", "2026-02-20"]
    },
    "sensitivity": {
      "highest_factor": "MICROSEISMIC",
      "score": 1.2, // 处于合理区间
      "status": "PASS"
    },
    "consistency": {
      "noise_count": 0,
      "status": "PASS"
    },
    "action_suggestion": "微震事件导致多次误报，建议微调微震权重或提高归一化上限。"
  }
}
4. 约束条件 (Constraints)
人工数据滞后性：
准确率验证通常是T+1模式（次日验证），因为人工评估结果通常在班后会上才录入。
样本量约束：
进行对比验证时，有效样本数 N 至少为 7天。若系统刚上线不足 7 天，跳过准确率验证，仅执行一致性验证。
全真模拟环境：
敏感性验证（调整参数试算）必须在沙箱环境或内存副本中进行，严禁直接修改正在运行的生产环境参数，以免引起现场误报警。
5. Web界面与操作流程
A.界面展示
算法健康度看板：
一个巨大的环形图显示 “算法准确率 88.5%”。
下方显示**“人机对比趋势图”**：两条折线，一条是算法评估曲线，一条是人工评估曲线。重合度越高越好。
权重调优沙盘：
提供“模拟演练”功能。用户拖动权重滑块，界面实时显示历史准确率会如何变化（回测）。
B. 操作流程
录入：专家每天在系统录入“今日评估：安全”。
报警：月底系统提示“本月算法准确率仅 85%，请优化”。
分析：点击进入详情，发现 14 号算法报了“危险”，但专家评估“安全”。
复盘：查看 14 号数据，发现是某传感器故障导致的误报。
调优：在沙盘中模拟调低该传感器权重，发现准确率提升至 92%。
应用：点击“应用新权重”，系统更新参数。
6. 测试用例 (Test Cases)
用例 ID	测试场景	输入模拟	预期结果 (Pass Criteria)
TC-VER-01	准确率计算	过去10天，算法与人工有9天一致	准确率输出 90%，状态为 PASS。
TC-VER-02	敏感性高危	将微震输入值微调 1%	输出结果跳变 15%。判定：敏感性异常，提示权重不合理。
TC-VER-03	一致性异常	输入一段正弦波数据	算法输出结果出现大量锯齿状毛刺。判定：一致性失败，建议增加滤波。
TC-VER-04	参数建议触发	准确率 80%	系统自动生成一份 json 格式的权重调整建议书。

5.3 可视化模块
5.3.1 压裂设计可视化
(1)钻场与钻孔分布展示
1.功能描述：多维空间拓扑与工程信息映射系统
本模块的核心目标是在 2D 平面图和 3D 立体空间中，将 28、25、14、7、1 联巷 5 个钻场的静态位置与 30 个（5 钻场 × 6 钻孔） 压裂钻孔的动态轨迹进行数字化重构。
A.数字化高保真地质底图重构
空间建模：
基于 11223 工作面回风顺槽和运输顺槽的 CAD 测量数据，生成 1:1 的数字底图。底图需包含巷道中轴线、煤层顶底板边界以及关键的采掘位置信息。
多层级图层管理：
开发人员需实现类似 CAD 的图层切换功能（Layer Controller），支持独立开关“地质层位”、“设计钻孔线”、“实钻轨迹线”、“巷道骨架”等图层。
B.钻场（Drilling Site）空间节点管理
物理点位标识：在 28、25、14、7、1 联巷的精确开孔坐标处，使用立体模型（如发光球体或三角台）进行标记。
父子关联展示：钻场作为“父节点”，必须能逻辑关联其名下的 6 个钻孔。当鼠标悬停在钻场上时，系统应通过“光晕”或“连线”效果，视觉化呈现该钻场控制的 6 个钻孔覆盖区域。
C.钻孔（Borehole）全生命周期可视化
多态轨迹渲染：
设计态：以虚线形式展示设计说明书中的 1-6 号孔路径。
施工态：根据 borehole_trajectory 表实时计算实钻轨迹，以彩色实线渲染。 
关键参数透视：系统需直观展现钻孔的物理特征：
孔径可视化：虽然孔径统一为 96mm，但在 3D 模型中应通过管径渲染技术，让用户感知其空间占比。
控制层位展示：通过半透明色块展示钻孔在顶板岩层中穿行的层位高度（如：煤层上方 15m 处），辅助判断压裂是否偏离目标岩层。
D.深度交互与参数探测系统
参数瞬时抓取：用户通过点击操作，系统应能瞬间穿透数据库，抓取该钻孔的所有核心参数：
钻场详情：名称、安装位置（坐标）、包含孔数、施工状态。
钻孔详情：编号、孔深（长度）、方位角、倾角、孔径（96mm）、计划压裂段数。
视口操控矩阵：支持自由缩放（Zoom）、平移（Pan）、全向旋转（Rotate），并具备 2D 俯视（平面图）与 3D 自由视角（立体图）的无缝切换。
2.业务逻辑：三维空间重构与数据驱动引擎
Step 1：地质环境基础底图的动态重构
坐标系初始化：开发人员需首先确立场景的基准坐标系。将统一数据库中 working_face 表的大地坐标（E, N, Z）转换为 WebGL 引擎（如 Three.js）或 GIS 引擎的局部坐标。
巷道骨架生成：从 roadway 表读取回风顺槽和运输顺槽的中心线坐标，根据设计断面的宽度与高度，拉伸（Extrude）生成巷道的立体模型。
煤层位标渲染：根据地质柱状图数据，在 Z 轴方向渲染煤层（3#煤）的顶底板透明包络体，作为钻孔层位控制的参考背景。
Step 2：钻场（Drilling Site）节点的精准定位与层级构建
站点部署逻辑：遍历 drilling_site 表，在 28、25、14、7、1 联巷 的指定坐标点生成“钻场实体”（通常使用发光圆柱或特定模型表示）。
父子关系绑定：基于 drilling_site.id = borehole.drilling_site_id 建立内存中的树状数据结构。
实现细节：当系统加载钻场时，必须预加载其名下的 6 个钻孔元数据，以便在点击时实现“秒开”详情，而非重复查库。
Step 3：钻孔（Borehole）多态轨迹渲染算法
轨迹计算引擎：
设计线渲染：读取 borehole 表的开孔坐标、设计方位角、设计倾角及设计长度，计算出一条直线段（虚线展示）。
实钻线拟合：读取 borehole_trajectory 表，使用“最小曲率法”或“割线法”对不连续的测点进行样条曲线（Spline）拟合，生成真实的钻孔空间曲线。
管径特征模拟：
关键点：虽然数据中孔径统一为 96mm，但开发人员在 3D 渲染时应根据当前视角缩放比例（Zoom Level）动态调整线宽，或直接生成直径为 96mm 的管状模型（Cylinder Geometry），并渲染其控制层位（如：在轨迹周围生成半透明的压裂扰动影响圈）。
Step 4：交互触发与属性穿透查询
碰撞检测（Raycasting）：实现 3D 场景中的拾取逻辑。
点击钻场：触发 SELECT site_name, location FROM drilling_site，并在 UI 层统计该站点下所有钻孔的施工进度。
点击钻孔：触发属性面板展示。必须一次性从 borehole 表取出：编号、设计长度、孔径(96mm)、分段数。
属性联动：点击左侧列表中的钻孔编号，3D 视角需自动平移（Tween Animation）至该钻孔位置并使其高亮。
Step 5：多维视角变换与视口控制
2D/3D 切换逻辑：
2D 模式：锁定 Z 轴，投影至 E-N 平面，生成标准的“钻孔布置平面图”，自动标注钻孔间距。
3D 模式：开启 6 自由度摄像机，支持围绕钻场旋转（Orbit Control），观察钻孔在顶板岩层中的上下起伏。
视域裁剪（Clipping）：支持沿巷道方向的剖面裁剪，让工作人员能看清钻孔在特定断面上与煤层顶板的垂直距离。
3.输入输出：
输入：后台从统一数据库抓取的原始数据集
开发人员需通过 SQL 关联查询，将静态的设计参数从 drilling_site 和 borehole 表中提取出来。
输入 A：钻场基础信息集 (SQL 查询结果)
用途：用于在底图上标记 28、25、14、7、1 联巷的物理位置。

字段名 (Field)	示例值	说明
site_name	28联巷钻场	钻场唯一标识名称
coord_e (X)	35400.521	大地坐标东坐标 (控制水平位置)
coord_n (Y)	28000.154	大地坐标北坐标 (控制巷道纵向位置)
coord_z (Z)	-610.25	巷道标高 (控制 3D 深度位置)
输入 B：钻孔设计参数集 (关联查询结果)
查询逻辑：WHERE drilling_site_id = [ID]
用途：用于渲染钻孔形态及详情弹窗。
字段名 (Field)	示例值	业务逻辑处理要求
borehole_no	1#	钻场内排序编号
diameter	96	单位 mm，前端需据此渲染线粗
design_length	550	延伸总长度
azimuth	270.5	设计方位角 (控制投影方向)
dip_angle	14.2	设计倾角 (控制 Z 轴起伏)
segments	12	压裂段数，用于标记轨迹上的切分点
输出：前端渲染引擎消费的数据规约
输出不再仅仅是文本，而是结构化的渲染对象模型（Render Object Model），通常以 API 响应体或内存对象的形式存在。
输出 A：3D 场景图节点 (Scene Graph Node) 这是传给 WebGL/Three.js 引擎的指令，用于生成可见实体。
实体类型：Point (钻场) + TubeGeometry (钻孔管线)
渲染规约：
对象：钻场 (Site_Entity)
Position: Vector3(x, y, z)
Label: "28联巷钻场"
Model: drilling_rig_icon
对象：钻孔 (Borehole_Entity)
Path: LineCurve3 (由开孔点和矢量计算得出)
Radius: 0.048 (将 96mm 孔径转换为 3D 场景中的 0.048米半径)
Material: MeshPhongMaterial (根据状态显示灰色虚线或蓝色实管)
输出 B：UI 交互面板数据 (Pop-up Data) 当工作人员点击地图上的钻孔时，界面展示给用户的最终内容。
展示实例：
钻孔详情卡片
所属位置：11223 工作面 - 28 联巷钻场
钻孔编号：11223-HF-28-01
物理参数：孔径 96mm | 长度 550m
设计参数：控制层位：顶板 15m | 压裂段数：12 段
施工状态：[已完工] 待压裂
4.约束条件：
·  坐标转换误差 (Precision)：
开发人员必须在后台建立 CoordinateTransformer 类。
硬性指标：大地坐标（8位有效数字）转换为本地渲染坐标（浮点数）时，在 11223 工作面 1000m 范围内，相对位移偏差不得超过 0.001m。
·  渲染流畅度 (Performance)：
场景容量：系统需支持同时加载 5 个钻场及所有 30 条实钻轨迹（包含数千个轨迹点）。
指标：在主流浏览器（Chrome 100+）下，开启抗锯齿后，平移缩放的响应延迟必须 < 16ms (即维持 60fps)。
·  交互命中率 (Hit Testing)：
由于钻孔孔径仅为 96mm，在缩放比例较小时极难选中。
技术要求：开发人员需为钻孔轨迹建立 “隐形碰撞体（Invisible Hitbox）”，其有效判定半径应设为真实孔径的 5-10 倍，确保鼠标能精准拾取。
·  层级显示策略 (LOD)：
远景：仅显示钻场名称标签和巷道轮廓。
近景：自动展开钻孔 96mm 管径模型，并显示每段压裂的编号。
不要尝试用一个 SQL 查出所有东西。第一步只查钻场坐标；第二步在用户点击或缩放时，再按需（Lazy Loading）加载具体的钻孔轨迹和 96mm 参数。这样可以极大优化首屏加载速度，保证“无卡顿”的约束条件。
5. Web 界面显示内容 (Web Interface Display)
界面应采用“全景底图 + 浮动面板 + 交互图层”的布局，使工作人员在处理海量空间数据时仍能保持逻辑清晰。
A.空间主视图区 (Main Spatial View)
11223 工作面三维底图：
巷道渲染：半透明灰色渲染 11223 回风顺槽，标注里程刻度。
钻场标记：在 28、25、14、7、1 联巷 位置显示发光的蓝色几何体（如圆柱或球体），作为点击热点。
钻孔轨迹渲染：
设计态 (Design Trace)：灰色虚线，表示施工设计路径。
实钻态 (Actual Trace)：深蓝色立体管状线，管径视觉效果需匹配 96mm 特征。
状态高亮：选中钻孔时，线条变为亮橙色并伴有呼吸灯效果。
B. 交互面板与图层控制 (Interaction & Layer Control)
图层切换器 (Layer Legend)：
可勾选开关：地质层位（煤层/顶板）、设计钻孔、实钻轨迹、孔号标签。
属性详情抽屉 (Property Drawer)：
钻场视图：显示所属联巷名称、中心点坐标、孔口标高、钻孔总数（1-6号）。
钻孔视图：分条目展示：
基础：编号（如：11223-28-01）、孔径 (96mm)。
几何：设计长度 (m)、实钻长度 (m)、控制层位（距煤层高度）。
工艺：计划压裂段数 (Segments)。
C. 视角控制工具栏 (View Navigation)
模式切换：【2D平面】/【3D全景】/【剖面透视】切换按钮。
辅助工具：【测距工具】（计算孔间距）、【截图】（生成设计校核报告）。
6.工作人员查看数据流程
第一步：全局浏览与移动（Move）
进入界面：打开 11223 可视化模块，系统自动加载全量底图。
平移操作：鼠标左键按住不放并拖动，即可在地图上自由移动。
操作目的：沿着回风顺槽扫描查看从 1 联巷到 28 联巷的整体分布。
第二步：细节放大与缩小（Zoom）
滚动缩放：滚动鼠标中键（滚轮）进行放大或缩小。
放大：拉近镜头，观察特定钻孔的轨迹细节，甚至能看清 96mm 管径在岩层中的起伏。
缩小：拉远镜头，总览 11223 工作面全长，评估钻孔群的整体覆盖范围。
第三步：全方位旋转观测（Rotate）
3D 旋转：在 3D 视图模式下，按住鼠标右键（或 Ctrl+左键）并移动鼠标，进行 360 度视角旋转。
操作目的：从侧面或俯瞰角度观察钻孔是否精准停留在“顶板 15m”的设计层位。
第四步：点击交互查数（Select）
点选操作：点击地图上的任意蓝色钻场或蓝色钻孔线。
选钻场：查看该联巷内 6 个钻孔的总体汇总信息。
选钻孔：屏幕右侧自动弹出详情卡片，快速核对**“孔径：96mm”、“长度：550m”、“压裂段数：12”**等核心参数。
第五步：一键维度切换（Switch）
视口切换：点击下方【2D】按钮，系统立即切换到标准的 CAD 布局模式，方便测量钻孔间的水平间距。点击【3D】按钮，恢复至立体实景模式。

给开发人员的实现重点：
1.交互反馈：鼠标悬停在钻孔上时，该钻孔应立即变色或描边高亮，告知工作人员该对象可点击。
2.平滑动画：在放大、缩小或切换钻场时，镜头移动应带有平滑过渡效果（Tween），避免画面闪烁或跳跃。
3.隐形触控区：考虑到 96mm 钻孔在远距离非常细，开发人员需为钻孔设置一个较大的“隐形点击框”，确保工作人员能轻松点中。
(2)钻孔轨迹可视化
1. 功能描述：三维空间轨迹动态重构与偏差预警系统
本模块是压裂工程的“数字眼睛”，通过编程手段将数据库中的离散测点转化为连续的三维空间曲线，实现对 11223 工作面地下钻孔形态的实时监控。
A.实钻轨迹的高保真参数化建模
动态管道渲染：开发人员需通过编程（如使用 Three.js 的 TubeGeometry）实时读取 borehole_trajectory 表。根据测深、倾角、方位角计算出的空间坐标点阵，自动生成一段直径为 96mm 的三维管状实体。
实时生长效果：系统需支持“动态追踪”，每当数据库增加一条新的轨迹记录，前端实钻轨迹应在 3D 空间中自动向前延伸，实时反映当前的钻进深度。
B.“设计 vs 实钻”双线对比展示
双态并存可视化：
设计线（静态参考）：以灰色虚线展示 borehole 表中预设的设计轨迹，作为施工的“模板”。
实钻线（动态实体）：以蓝色高亮实心管展示真实轨迹。
视觉差分析：通过双线重合度的直观对比，工作人员可直接观测钻孔是否按预定路线行进。
C.空间偏差智能预警与变色逻辑
偏差实时计算：模块需自动计算实钻轨迹点到设计中心线的垂直距离（偏差值）。
色码预警系统：
正常（绿色/蓝色）：偏差 $\le 2m$ 时，轨迹显示为正常色。
预警（橙色/红色）：当偏差 $> 2m$ 或钻孔偏离目标层位（如扎入煤层或钻入顶板过深）时，该段管线自动变为红色高亮，并触发 UI 报警提醒。
D.关键层位控制与垂直深度透视
剖面层位追踪：在 3D 场景中引入“层位参考面”（煤层顶板），动态展示钻孔轨迹与煤层顶线的垂直距离。
关键点自动标注：在轨迹的关键节点（如每 100m 处或方位角剧烈变化处）自动悬浮显示该点的“测深、倾角、方位角、标高”标签。
E.交互式轨迹探测与数据穿透
轨迹拾取交互：支持工作人员点击轨迹上的任意位置。
瞬时参数反馈：点击后通过射线碰撞技术（Raycasting）精确定位点位，弹出半透明浮窗，实时显示：
该点对应的实际测深。
该点在空间中的 X、Y、Z 绝对坐标。
该点的施工状态（已压裂/未压裂）。
2. 业务逻辑：三维轨迹重构与动态监控引擎
Step 1：高精度空间坐标系平移与对齐
坐标预处理：由于数据库中的大地坐标（E, N, Z）数值高达数十万，直接进入 3D 引擎会导致浮点数精度丢失而出现画面抖动。
开发实现逻辑：
系统启动时，选取 11223 工作面中心点或 28 联巷开孔点作为逻辑原点 (0, 0, 0)。
所有从 borehole_trajectory 读取的坐标点，必须统一减去该原点偏移量（Offset），转换后再进行渲染。
Step 2：钻孔轨迹拟合算法（从点到线的进化）
实钻轨迹重构：开发人员不能简单地用直线连接测点（会产生生硬折角）。
核心算法逻辑：
最小曲率法 (Minimum Curvature Method)：读取测深、倾角、方位角，通过球面三角学公式计算出空间平滑曲线。
样条曲线插值 (Spline Interpolation)：在两个真实测点之间，利用编程库（如 Three.js 的 CatmullRomCurve3）自动生成 10-20 个插值点。
结果：生成一条符合钻杆物理特性的平滑 3D 路径（Path）。
Step 3：参数化管径渲染逻辑 (96mm 实体化)
管状几何体生成：
调用 TubeGeometry 函数，将上一步生成的 Path 作为路径。
设置 Radius = 0.048m（即 96mm 直径）。
逻辑控制：当距离视角较远时，减少管线分段数（Segments）以节省性能；推近视角时，增加分段数以展示圆润的 96mm 管壁。
Step 4：偏差计算与变色预警逻辑（核心监控逻辑）
设计对比算法：
程序需计算实钻轨迹上每一点到设计中心线（虚线）的最短矢量距离 $d$。
状态机判定：
IF d <= 2m：设置材质颜色为“工程蓝”。
IF d > 2m：设置该段 Mesh 的颜色为“警示红”，并向系统抛出异常信号。
层位触碰检测：对比轨迹 Z 轴坐标与煤层顶板标高，若轨迹进入煤层，则该段高亮闪烁。
Step 5：实时数据流驱动与动画生长
增量更新逻辑：
监听 borehole_trajectory 表，一旦有新数据存入（如新增 30m 实钻），前端代码不应刷新全图，而是动态追加几何体的顶点数组。
动画效果：新一段 96mm 管线以“生长”动画形式延展，提高工作人员的视觉感知度。
Step 6：射线碰撞交互拾取（数据穿透）
拾取逻辑：当工作人员点击屏幕时，利用 Raycaster（射线检测） 技术。
参数关联：
找到离射线最近的轨迹点索引。
反查数据库对应的测深、方位角、倾角信息。
UI 触发：将这些数据传递给浮窗组件进行展示。
3. 输入输出说明及实例
输入：多源数据提取 (Backend Data Fetching)
开发人员需从统一数据库中抓取两类数据：一是设计基准数据，二是实钻轨迹点集。
输入 A：钻孔静态设计参数 (来自 borehole 表)
用途：用于确定钻孔的起点（孔口位置）及渲染灰色设计虚线。
字段名 (Field)	示例值	说明
actual_coord_e	35420.55	实钻孔口东坐标 (E) -> 对应 3D 空间起始 X
actual_coord_n	28010.2	实钻孔口北坐标 (N) -> 对应 3D 空间起始 Y
actual_coord_z	-615.3	实钻孔口标高 (Z) -> 对应 3D 空间起始 Z
design_length	550	设计总深度，用于限制设计虚线的延伸
borehole_diameter	96	孔径参数，直接决定 3D 管柱的粗细
输入 B：实钻轨迹动态测点集 (来自 borehole_trajectory 表)
查询逻辑：WHERE borehole_id = ? ORDER BY measured_depth ASC
用途：通过点阵拟合生成蓝色的 3D 实钻管线。
测项 (Item)	示例值 (第 n 点)	开发处理要求
measured_depth	120	当前测点的深度，用于计算轨迹长度
dip_angle	14.5	倾角，用于计算 Z 轴偏移
grid_azimuth	271.2	方位角，用于计算 XY 平面偏转
coord_e/n/z	35435.2, 28012.1, -618.5	直接提供的空间坐标点（若数据库已有计算值则直接使用）
输出：前端渲染指令与 UI 展示数据 (Data Presentation)
输出分为“渲染引擎消费的几何对象”和“工作人员可见的 UI 文本”。
输出 A：3D 渲染对象规约 (Render Schema) 这是程序内部生成的对象模型，用于驱动 Three.js 等引擎绘图。
轨迹管道 (Tube Entity)：
Path (路径)：由输入 B 的点阵经过样条插值生成的连续曲线 CatmullRomCurve3。
Geometry (几何)：TubeGeometry(path, segments: 128, radius: 0.048)。
注：96mm 直径需转换为 0.048 米半径进行渲染。
Material (材质)：
正常段：Color(0x0000FF) (蓝色)
异常段（偏差 > 2m）：Color(0xFF0000) (红色高亮)
输出 B：交互探测浮窗 (Interaction Tooltip) 当工作人员移动鼠标并点击轨迹上的某一点时，界面实时展示的内容。
输出内容实例：
[轨迹实时探测]
所属孔号：11223-HF-28-01
当前测深：210.50 m
空间坐标：X:35450.2 / Y:28015.4 / Z:-620.1
姿态参数：倾角 14.8° | 方位 271.5°
轨迹偏差：1.45 m (正常)
4. 约束条件：精度、性能与交互底线（开发技术规约）
A.空间计算精度约束 (Spatial Precision)
坐标归一化误差：由于 3D 引擎无法处理大地坐标（如 X=35420.5），开发人员必须在进入渲染前进行偏移量减法。要求：转换后的相对坐标在 11223 工作面（1000m 范围）内的浮点数精度偏差 <0.001m，严禁出现由于精度问题导致的画面闪烁或模型抖动。
轨迹拟合准确度：实钻轨迹必须采用“最小曲率法”进行插值拟合。要求：拟合生成的连续管线与原始离散测点（如每 30m 一个点）的路径重合误差< 0.01m。
B.视觉呈现与真实感约束 (Visualization Quality)
管径比例一致性：钻孔直径必须严格锁定为 96mm（渲染半径 0.048m）。无论视角拉近还是拉远，管子在 3D 空间中的物理尺寸必须恒定，严禁使用“固定像素宽度”的画线方式，以确保与巷道（4m宽）的比例感真实。
平滑度与段数 (Tessellation)：管状体（Tube）的横截面分段数不得少于 8 段，纵向路径平滑度必须满足视觉无棱角。
多层次细节 (LOD)：为了兼顾性能，必须实现 LOD 机制。
近景（<50m）：渲染精细的 96mm 圆柱管。
远景（>200m）：自动切换为粗线（Line），以降低显卡压力。
C.系统性能指标 (System Performance)
实时帧率 (FPS)：在 11223 工作面全场景（5 个钻场、30 条 600m 长轨迹、巷道模型、地质层位）全部开启时，主流办公电脑浏览器的渲染帧率必须 > 30fps。
首屏加载耗时：从获取数据到 30 条轨迹全部渲染完成，总耗时不得超过 3 秒。
内存占用控制：3D 模块运行时的显存（GPU Memory）占用应控制在 512MB 以内，防止因压裂期间数据积压导致浏览器崩溃。
D.交互触控约束 (Interaction Consistency)
有效点击命中 (Hit Testing)：由于 96mm 的管线在 3D 空间非常细，开发人员必须为轨迹设置 “隐形碰撞体”。
要求：点击判定的有效半径应设为 0.5m ~ 1m（约真实直径的 10 倍），确保工作人员即便在远距离也能轻松点中目标。
响应延迟 (Latency)：点击轨迹后，右侧详情面板刷新及 3D 高亮反馈的延迟必须 <200ms，做到即点即现。
E.数据同步与鲁棒性约束 (Data Integrity)
时序单调性：实钻轨迹必须严格按照 measured_depth（测深）递增顺序渲染，严禁出现乱序导致的“打结”或“回头”现象。
断点处理：若相邻两个测点距离 $> 100m$（判断为漏测），系统不得进行常规插值，必须改用黄色警戒虚线连接，以提示工作人员此处轨迹为预测值而非实测值。
5. Web 界面显示内容 (Web Interface Display)
界面布局采用“左侧资源树 + 中间 3D 视口 + 右侧详情面板 + 下方工具栏”的标准工业设计架构。
A.3D 全景监控区 (Main 3D Workspace)
钻孔实体渲染：
实钻轨迹 (Actual)：深蓝色高亮管状体，管径视觉效果精确对应 96mm。管壁伴有金属质感，便于在复杂光影下观察起伏。
设计轨迹 (Design)：灰色半透明虚线管，作为背景参考，如同“预设好的轨道”。
异常警示段：当实钻偏离设计线 $>2m$ 时，该段管线由蓝转红，并伴有红色呼吸闪烁效果。
地质环境参考：
巷道模型：半透明浅灰色长方体，标明“回风顺槽”及其里程。
煤层顶板面：绿色半透明网格面（Grid），代表煤层顶板。工作人员可直观看到 96mm 钻孔是否在顶板上方 15m 的“安全层位”内。
B.浮动控制与信息面板 (Data Panels)
左侧：联巷资源树：
按 28、25、14、7、1 联巷 分组，点击可快速聚焦（Fly-to）。
下方：视角工具栏：
提供【2D/3D 切换】、【复位】、【全屏】及【背景透明度调节】滑块。
右侧：数据详情抽屉 (Data Drawer)：
显示当前选中钻孔的静态参数：编号、设计孔径 (96mm)、总长度。
显示实时计算参数：当前测深、最大偏差距离、层位安全状态。
6. 工作人员查看数据流程 (Simplified User Flow)
该流程经过极简化处理，确保工作人员只需使用鼠标即可完成所有核心查看任务。
第一步：全局巡视与目标定位 (Search & Move)
操作：进入模块后，左键按住并平移画面，或在左侧列表点击“14 联巷”。
视觉反馈：视口平滑滑行至 14 联巷钻场，6 个钻孔像扇面一样在巷道壁展开。
目的：快速找到当前正在施工或需要核查的钻孔位置。
第二步：细节放大与精细观察 (Zoom & Inspect)
操作：滚动鼠标轮（放大）。
视觉反馈：镜头推近至钻孔管线附近。此时可以看到蓝色 96mm 管体 的细节。
目的：近距离检查蓝色实钻轨迹是否被包裹在灰色设计虚线“模板”内。
第三步：多维旋转与层位复核 (Rotate)
操作：按住鼠标右键并左右上下移动。
视觉反馈：场景围绕钻孔旋转。
目的：切换到“正侧视”视角，重点查看钻孔在垂直方向（Z 轴）上的起伏。确认 96mm 管线没有“扎入”下方的绿色煤层，也没有“穿出”上方的岩层监控区。
第四步：点击交互与数据验证 (Select & Interrogate)
操作：直接点击轨迹上显示为“红色”的异常段。
视觉反馈：点击位置出现高亮光圈，右侧面板瞬间刷新。
目的：查看该位置的精确数值。
例如：“测深 350m 处，实际偏差 2.45m，方位角偏左 1.2 度。”
第五步：一键重置与状态清理 (Reset)
操作：点击界面右下角的【全景重置】按钮。
视觉反馈：视角快速拉远，回到 11223 工作面全局，异常高亮消失。
目的：结束当前查看任务，准备进行下一个联巷的巡查。
5.3.2 数据看板
(1)核心指标实时展示
1.功能描述：多维数据集中监控视口
本模块被定位为 11223 工作面的静态与动态数据集成视口。其核心任务是在不切换系统的前提下，为工作人员提供一个“一屏全览”的监控面板，将物理空间上分布的各类传感器数据进行逻辑聚合。
A.矿压监测数据 (KJ653 支架压力)
集中映射显示：界面需从 KJ653 系统中提取 11223 工作面范围内所有液压支架的压力数据。
关键指标解释：
平均工作阻力：展示当前工作面活跃支架组的平均压力值，用于反映顶板整体的受力均衡性。
单架压力详情：支持展示特定重点支架（如靠近联巷的支架）的左柱与右柱实时压力数值。
B.微震监测数据 (SOS 微震事件)
实时事件流展示：以列表形式展示最近发生的微震事件。
核心字段解释：
能量值 (Energy)：直接显示每次震动释放的焦耳数 (J)，用于衡量岩层破裂的强度。
发生时刻 (Event Time)：精确到秒的时间记录，方便与压裂进度进行时序对照。
今日统计汇总：在显著位置显示今日累计发生的微震次数以及今日释放的总能量值，反映全天岩层的活跃程度。
C.巷道变形数据 (围岩移动量)
多点位移监测：展示巷道内各测站（观测点）的物理形变数据。
数据维度解释：
累计位移量 (Cumulative Displacement)：展示自观测开始以来，顶底板或两帮移动的总毫米数 (mm)。
变形速率 (Rate of Change)：计算并展示过去 24 小时 内的位移变化速度（单位：mm/d）。这能让工作人员直观判断巷道目前是处于“缓慢蠕变”还是“剧烈收敛”状态
D.压裂参数台账 (施工记录同步)
单段施工快照：同步展示该工作面下，最近一个已压裂完成段的详细台账信息。
展示字段解释：
压裂顺序 (Order)：明确当前施工进行到了第几段（如：第 5 段）。
施工参数组合：
记录压力：该段施工过程中记录到的最大/起裂压力值 (MPa)。
记录流量：该段施工过程中的平均注水强度 (m³/h)。
实际注水量：该段最终累计注入岩层的总水量 (m³)。
工程进度感知：通过“已完成段数 / 总设计段数”的对比，展示整个钻孔乃至整个工作面压裂工程的物理完成度。
2.业务逻辑细化 (Business Logic Refinement)
该模块的底层逻辑专注于“多源异构数据的即时聚合”，确保用户在打开界面的一瞬间，看到的是 11223 工作面当前最真实、最直接的数值。
A.实时数据精准抓取逻辑 (Latest-Point Acquisition)
系统仅关注每一个数据源的“当前值”或“最后一条记录”，不回溯历史：
矿压 (KJ653)：后端仅从数据库中检索 11223 工作面支架压力表的最后一次巡检记录，提取所有在线支架的当前压力值，并实时计算当前瞬时的平均压力。
微震 (SOS)：仅抓取 microseismic_event 表中最新生成的一条记录，作为“最近事件”展示；同时执行当日（00:00至今）的简单汇总计算。
变形监测：仅提取各测点最后一次上报的累计位移数值，不进行与上一次数据的差值计算（即不计算速率）。
压裂台账：仅提取该钻孔中状态标记为“已完成”且**顺序号最大（即最近完成）**的一段施工参数。
B.空间上下文过滤逻辑 (Spatial Contextualization)
逻辑定义：通过 11223 工作面的唯一标识符（ID），建立空间索引。
过滤规则：
从设备映射表加载属于 11223 的支架编号、测站编号及传感器编号。
在数据查询时，强制加入 WHERE device_id IN (...) 约束。
结果：屏蔽矿井其他区域的干扰，确保数据的纯净性。
C.汇总统计逻辑 (Snapshot Aggregation)
虽然没有趋势分析，但系统会提供当下的累计快照：
今日统计：计算当日 00:00 至今的微震总频次和总能量。
施工进度：计算 已压段数 / 总段数 的静态比例。
3.输入输出说明 (Input & Output Specification)
输入：关联模块的标准化输出 (Input)
本模块的输入全部来自于前序处理模块，严禁直接读取传感器原始报文。
输入来源模块	核心输入项	单位	说明
数据时间对齐与空间标准化模块	aligned_strata_pressure	MPa	11223 面支架平均压力的标准化单点值
数据时间对齐与空间标准化模块	standardized_ms_energy	J	经过空间坐标纠偏与能量归一化的单次微震能量
数据时间对齐与空间标准化模块	aligned_deformation	mm	对应 11223 测点最新的累计位移标准化值
压裂参数展示模块（台账版）	segment_record_snapshot	多单位	包含：压裂顺序、记录压力、记录流量、注水量
系统配置模块	workface_id	-	唯一标识符 11223，用于在对齐后的数据库中执行检索
关键逻辑关联：
所有的“单位不统一”、“时间戳对不齐”、“坐标系不一致”问题，均已在数据时间对齐与空间标准化模块中处理完毕。
本模块接收到的数据已经是“干净”的，直接取值即可。
输出：前端实时快照对象 (Output)
后端将检索到的各维度标准化数据封装为一个 JSON 对象，发送给 Web 端进行 KPI 卡片渲染。
输出实例 (JSON 结构):
JSON
{
  "module": "CORE_INDICATOR_SNAPSHOT",
  "workface": "11223",
  "update_time": "2026-02-01 10:45:00",
  "indicators": {
    "strata_pressure": {
      "current_val": 32.5,  // 来自时间对齐模块的最新 MPa 值
      "unit": "MPa"
    },
    "microseismic": {
      "latest_energy": 1200, // 来自空间标准化模块的最新 J 值
      "daily_count": 12,      // 当日事件累计计数
      "unit": "J"
    },
    "deformation": {
      "total_offset": 142.8, // 来自时间对齐模块的累计 mm 值
      "unit": "mm"
    },
    "fracturing": {
      "order": 5,           // 压裂顺序
      "recorded_p": 22.4,   // 记录压力 (MPa)
      "recorded_q": 60.5,   // 记录流量 (m³/h)
      "actual_v": 45.2,     // 注水量 (m³)
      "status": "COMPLETED"
    }
  }
}
4.约束条件细化 (Detailed Constraints)
为了保证 11223 工作面核心指标展示的严肃性与准确性，开发人员在实现该模块时必须遵守以下五大类约束：
A.数据源依赖与一致性约束 (Data Source & Consistency)
强依赖关系：本模块的矿压、微震、变形数据必须且只能调用“数据时间对齐与空间标准化模块”的输出接口。严禁跳过该模块直接读取原始传感器数据库。
零二次加工原则：本模块仅负责“展示”，禁止在代码中对标准化后的数值进行任何数学运算（如单位换算、对数转换、多指标加权等）。
示例：若标准化模块输出压力为 32.51，本模块仅可进行格式化取整（如 32.5），不得修改数值本身。
B.实时性与时效性约束 (Real-time & Freshness)
刷新周期延迟：从“数据时间对齐模块”产生结果到本模块界面更新，全链路延迟必须 $\le 2$ 秒。
失效判定 (Stale Data)：
对于矿压/变形数据：若最新数据的时间戳距离当前系统时间超过 10 分钟，界面必须将该指标标记为“非实时（灰色显示）”。
对于压裂台账数据：若该钻孔施工已结束，应显示“施工已归档”标签，防止工作人员误判为正在施工。
D.容错性与鲁棒性约束 (Fault Tolerance)
模块解耦显示：
当 SOS 系统数据库宕机导致微震数据缺失时，矿压、变形、压裂卡片必须保持正常更新，严禁出现“全页加载失败”或弹出报错对话框。
缺失数据项应统一显示为 --，并标注“数据源离线”。
高并发抗压：看板需支持至少 20 名管理人员同时在线查看，且不影响数据拉取的实时性。
E.空间与安全约束 (Spatial & Security)
空间唯一性：由于 11223 工作面是唯一的空间上下文，后台 SQL 检索必须强制绑定 workface_id = '11223'。严禁因配置错误导致其他工作面（如 11221）的指标进入此看板。
只读性约束：本模块的所有交互操作仅限于“视图切换”和“查看”，严禁提供任何数据修改、删除或参数下发（控制泵机等）的功能。
5.Web 界面展示内容及操作流程 (UI & Workflow)
A.界面显示内容 (Display Layout)
界面采用“四宫格”静态卡片排布，确保关键信息一目了然：
指标卡 A (矿压)：大标题“支架平均阻力”，数值 32.5，单位 MPa。
指标卡 B (微震)：双行显示。第一行显示最新震动能量 1200 J；第二行显示今日频次 12 次。
指标卡 C (变形)：大标题“累计位移量”，数值 142.8，单位 mm。
指标卡 D (压裂)：表格化显示。表头：段号 | 压力 | 流量 | 水量。内容：5 | 22.4 | 60.5 | 45.2。
B.工作人员操作流程 (Operational Flow)
进入视口：工作人员通过主菜单点击“核心指标实时展示”。
数据巡检：
目视核对：检查各个卡片的数字是否在正常波动。
时效确认：查看卡片底部的小字时间戳，确认数据是最新对齐后的。
刷新交互：如果发现数据疑似卡顿，点击右上角的【强制刷新】按钮，触发业务逻辑重新向各标准化模块请求快照。
模块跳转：若需要查看该指标的 3D 轨迹或详细台账，点击卡片右上角的【详情箭头】，系统将跳转至关联的专业模块。
6. 测试用例 (Test Cases)
A.数据集成与实时性测试
用例 ID	测试项	操作步骤	预期结果
TC-CORE-01	多源数据同步更新	1. 打开 11223 核心指标展示界面。

2. 分别在矿压库、微震库、变形库插入一条标准化后的新数据。	界面四个指标卡片应在 2 秒内同步更新为最新数值，无延迟感。
TC-CORE-02	数据时效性判定	在数据库中手动修改矿压数据的时间点为 15 分钟前。	1. 矿压指标数值变为灰色或显示“非实时”。

2. 界面不显示错误，其他指标（如微震）仍正常更新。
TC-CORE-03	归一化数值核对	对比“数据时间对齐与空间标准化模块”输出值与本看板显示值。	看板显示的数值（MPa, J, mm）必须与标准化模块的输出完全一致，无任何计算偏差。
B.空间隔离与上下文测试
用例 ID	测试项	操作步骤	预期结果
TC-CORE-04	工作面数据隔离	在 11221 工作面（非目标区域）产生高能量微震事件。	11223 指标看板的微震数值应保持不变，不受非关联区域数据干扰。
TC-CORE-05	压裂钻孔关联	在台账模块中切换当前施工钻孔（如从 28 联巷切至 25 联巷）。	核心指标看板的“压裂参数”区块应自动更新为对应钻孔的最新段施工参数。
C.逻辑边界测试（约束条件验证）
用例 ID	测试项	操作步骤	预期结果
TC-CORE-06	无报警逻辑验证	模拟输入压力为 40 MPa（远超支架额定阻力）。	指标卡仅如实显示数字“40”，界面不得出现红色闪烁、警报框或声音提示。
TC-CORE-07	无趋势逻辑验证	点击矿压或变形指标卡片。	1. 界面不得展示历史折线图或速率曲线。

2. 确认后台未执行任何历史序列的数据检索。
TC-CORE-08	静态快照验证	观察位移数据 1 分钟。	数值仅随标准化模块更新而跳变，不展示任何类似“上升中”或“变化率”的描述。
D.容错性与交互测试
用例 ID	测试项	操作步骤	预期结果
TC-CORE-09	单系统离线测试	模拟 SOS（微震）系统数据库连接中断。	微震指标位显示“--”或“数据获取中”，矿压、变形、压裂指标仍能正常 30s 刷新。
TC-CORE-10	强制刷新功能	点击界面右上角的【强制刷新】按钮。	系统立即清除缓存，重新向各专项模块发起快照请求，数值完成一次瞬时更新。

(2) 异常报警提示
1功能描述 (Functional Description)
本模块是 11223 工作面安全监测平台的“神经中枢”，负责将枯燥的数据流转化为直观的危机信号。
A.多维监测数据实时研判引擎 (Real-time Rule Engine) 
系统需建立一个独立的高频规则执行器，毫秒级接收来自“标准化模块”的四路数据流，并执行以下具体监测任务：
矿压过载监测：实时比对当前支架阻力与额定工作阻力（如 38MPa）。系统需能区分“局部超限”（单架受力）与“整体来压”（大面积受力），识别顶板压死风险。
微震冲击监测：实时捕捉 SOS 系统上传的大能量事件（> 10^4 J）。系统需即时响应，不能有任何防抖延迟，确保冲击地压前兆被第一时间捕获。
变形突变监测：监控巷道顶底板及两帮的位移数据。重点识别数据的“阶跃式突增”，警示围岩突发崩塌风险。
压裂异常监测：在压裂施工期间，实时监控记录压力的稳定性。若施工状态显示“进行中”但压力长期低于有效作业门槛，提示“无效施工”或“管路泄漏”。
B.双级分层声光报警交互 (Dual-Level Notification) 
为了避免“报警疲劳”，系统严格区分风险等级，采用不同的打断策略：
红色危急报警 (Critical - 阻断式)：
适用场景：直接威胁人身安全或设备损坏的指标（如支架爆阀、强冲击）。
视觉表现：Web 界面背景泛红光呼吸闪烁，屏幕中央弹出模态对话框 (Modal)，锁定界面，直到用户处理。
听觉表现：播放高频、急促的蜂鸣警报音（循环播放直至确认）。
黄色一般预警 (Warning - 提示式)：
适用场景：指标偏高但未失控、设备离线等非紧急情况。
视觉表现：顶部状态栏亮起黄灯，右下角滑出 Toast 通知条，停留 5-10 秒后自动收起。
听觉表现：播放单次短促提示音（“滴-滴”）。
C.智能信号清洗与防抖 (Intelligent Debounce)
功能定义：解决工业现场传感器常见的“毛刺”问题。
执行逻辑：对于连续变化的模拟量（矿压、变形），系统需具备“持续性判定”能力。例如，只有当压力值连续 3 秒（可配置）高于阈值时，才触发报警。过滤掉因电磁干扰或人员误触造成的毫秒级尖峰。
D.报警全生命周期闭环管理 (Lifecycle Management) 
系统必须记录报警从产生到结束的完整过程，杜绝“响完就忘”：
触发 (Trigger)：自动生成唯一的报警 ID，记录触发时的快照数据。
推送 (Push)：通过 WebSocket 实时推送到所有在线客户端。
响应 (Ack)：提供“消音/确认”按钮。用户点击后，声音停止，弹窗关闭，但系统内部状态标记为“人工已确认，隐患未消除”，界面保留红框警示。
恢复 (Resolve)：当传感器数值回落至正常区间，系统自动关闭该报警，并记录持续时长。
E.场景化联动跳转 (Contextual Linkage)
功能定义：报警不仅是通知，更是处置的入口。
执行逻辑：当报警弹窗出现时，必须提供**“查看详情”**的深层链接。
例如：点击“微震报警”卡片，系统直接跳转至 [核心指标实时展示模块]，并自动高亮微震数据区域，帮助值班员立刻看到是哪一次震动引发了报警。
2.业务逻辑 (Business Logic)
本模块作为后台驻留服务（Daemon Service），独立于前端页面运行。其核心逻辑由规则引擎、防抖滤波器、状态机管理器和分发调度器四个组件构成。
A.多流并发规则引擎 (Multi-Stream Rule Engine) 
系统订阅“数据时间对齐与空间标准化模块”的输出流，针对每一帧到达的数据包，并行执行以下判定逻辑
矿压逻辑 (阈值区间判定)：
读取 aligned_strata_pressure。
CRITICAL (红)：若数值 > 38.0 MPa。
WARNING (黄)：若数值 ∈ (35.0, 38.0] MPa。
NORMAL (绿)：若数值 ≤ 35.0 MPa。
微震逻辑 (事件触发判定)：
读取 standardized_ms_energy (单次事件能量)。
CRITICAL (红)：若单次能量 > 10,000 J。
WARNING (黄)：统计过去 60 分钟内的事件总数，若频次 > 5 次。
注：微震属于离散事件，无需持续性判定，一旦满足条件立即触发。
变形逻辑 (速率判定)：
读取 aligned_deformation_rate (mm/d)。
CRITICAL (红)：若速率 > 50 mm/d（表明进入急剧变形期）。
压裂逻辑 (上下文状态判定)：
这不是简单的阈值比较，需结合施工状态。
IF construction_status == "FRACTURING" (正在施工中)
AND recorded_pressure < 10.0 MPa (远低于设计起裂压力)
THEN 触发红色报警（判定为“失压/泄漏”）。
逻辑保护：若状态为“STOPPED”或“PENDING”，即使压力为 0 也不报警。
B.智能信号防抖滤波 (Signal Anti-Jitter/Debounce) 
为了杜绝传感器波动造成的“闪断式”误报，对连续模拟量（矿压、变形）实施 T-S 时间窗滤波：
计时器机制：
当监测值 Vt​ 首次超过阈值时，不立即报警，而是启动一个计时器 Timer。
在接下来的 T 秒内（默认 T=3s），如果每一帧数据 Vt+n​ 都持续超过阈值，则计时器累加。
触发条件：当 Timer≥T，正式生成报警对象。
重置条件：若中间任何一帧数据回落到正常区间，计时器立即清零。
滞后回差 (Hysteresis)：
为了防止数值在 38.0 附近反复跳动导致报警不断启停，设置 0.5 MPa 的回差。
解除报警条件：数值必须回落到 37.5 MPa 以下，报警状态才会解除，而不是简单的 38.0。
C.报警生命周期状态机 (Lifecycle State Machine) 
系统维护每一个报警事件的状态流转，严禁状态跳跃：
NEW (新建态)：防抖逻辑通过，内部生成报警实例，写入数据库，但尚未推送到前端。
ACTIVE (激活/推送态)：
通过 WebSocket 向前端发送报警包。
前端UI开始闪烁，声音开始播放。
特征：隐患存在，且人工未介入。
ACKNOWLEDGED (确认/静音态)：
用户点击了“收到”按钮。
WebSocket 收到确认指令。
动作：前端停止声音播放，关闭模态弹窗，但保留顶部状态栏的红色角标。
特征：人工已感知，但隐患数据仍超限。
RESOLVED (恢复/归档态)：
传感器数值回落至正常区间（满足回差条件）。
动作：系统自动关闭报警，计算持续时长（Duration），将记录标记为“历史归档”，前端消除所有视觉警示。
D.优先级仲裁与分发 (Priority Arbitration) 
当多个报警同时发生时，系统遵循**“重灾优先”**原则：
仲裁逻辑：
若同时存在 CRITICAL (红) 和 WARNING (黄) 报警，前端仅弹出红色的模态框，黄色报警降级为后台列表记录或 Toast 提示。
防止多个弹窗重叠导致操作界面被完全遮挡。
通道隔离：
报警数据包走独立的高优先级消息队列（High-Priority Queue），不与普通的实时数据快照混用同一通道，确保即使网络拥堵，报警也能优先到达。
3. 输入输出规范 (Input & Output Specification)
本模块不直接采集物理信号，而是订阅上游模块处理完毕的标准化数据流。输出则是面向前端 WebSocket 和后台日志库的结构化报警对象。
A.输入数据规范 (Input Specification)
模块通过消息队列（如 Kafka/RabbitMQ）或内部服务接口，订阅以下四个维度的数据包。要求数据必须携带 timestamp 和 workface_id。

数据维度	数据维度	数据维度	数据类型	频率	业务含义与用途
矿压	数据时间对齐与空间标准化模块	aligned_strata_pressure	Float (MPa)	30s	判据：用于比对 35MPa/38MPa 阈值。要求：必须是剔除坏点后的有效值。
微震	数据时间对齐与空间标准化模块	standardized_ms_energy	Float (J)	触发式	判据：用于比对 104 J 冲击阈值。特性：高优先级，毫秒级到达。
微震	数据时间对齐与空间标准化模块	hourly_frequency_count	Integer	1min	判据：用于比对频次阈值（如 >5次/小时）。
变形	数据时间对齐与空间标准化模块	deformation_rate_24h	Float (mm/d)	30s	判据：用于比对 50mm/d 速率阈值。
压裂	压裂参数展示模块（台账版）	current_segment_record	Object	30s	判据：包含 status (施工中/停止) 和 pressure。逻辑：仅当状态为“施工中”且压力过低时报警。
心跳	系统监控服务	system_heartbeat	Boolean	10s	自检：若上游数据流停止超过 1分钟，触发“传感器离线”报警。

B.输出数据规范 (Output Specification)
当规则引擎判定异常成立，或报警状态发生流转（如用户点击确认）时，系统向前端推送标准 JSON 报警包。
输出对象结构 (JSON Schema):
JSON
{
  "protocol_version": "1.0",
  "message_type": "ALARM_NOTIFICATION",
  "payload": {
    // 1. 唯一标识与上下文
    "alarm_id": "ALM-11223-20260201-089",  // 格式：ALM-{工作面}-{日期}-{序列号}
    "workface_id": "11223",
    "trigger_time": "2026-02-01 10:30:45", // 报警产生的精确时间
    
    // 2. 报警分级与来源
    "source_module": "STRATA_PRESSURE",    // 枚举：STRATA, MICROSEISMIC, DEFORMATION, FRACTURING
    "level": "CRITICAL",                   // 枚举：CRITICAL(红/阻断), WARNING(黄/提示)
    "alarm_code": "SP_OVERLOAD_01",        // 错误码，用于国际化文本映射
    
    // 3. 核心数值证据 (让用户知道为什么报)
    "trigger_value": 42.5,                 // 当前实际值
    "threshold_value": 38.0,               // 设定的报警阈值
    "unit": "MPa",                         // 单位
    
    // 4. 人读文本与指导
    "title": "支架工作阻力严重超限",
    "message": "监测到11223工作面中部支架压力达到 42.5 MPa，持续时间超过 3秒。",
    "action_guide": "1. 立即停止采煤机割煤；2. 检查支架液压系统；3. 通知综采队处理。",
    
    // 5. 状态机标记
    "lifecycle_status": "ACTIVE",          // 枚举：NEW(新产生), ACTIVE(持续中), ACKNOWLEDGED(已确认), RESOLVED(已恢复)
    "duration_sec": 15                     // 已持续时长(秒)
  }
}
C.数据交互协议 (Interaction Protocol)
WebSocket 推送通道 (Server to Client)：
通道名：/topic/alarms/11223
策略：采用 QoS 1 (At least once) 策略，确保报警消息至少到达一次。若客户端断线重连，必须自动补发断线期间未恢复的报警。
HTTP 确认接口 (Client to Server)：
接口：POST /api/v1/alarms/{alarm_id}/acknowledge
作用：用户在界面点击“收到”后调用此接口。
参数：{ "operator_id": "user_007", "ack_time": "..." }
效果：服务器将该报警状态更新为 ACKNOWLEDGED，并广播给所有其他在线客户端（防止多人重复处理）。
4. 约束条件 (Constraints)
本模块的设计与实现必须严格遵守以下五大类“红线”约束，任何违背都可能导致严重的现场安全事故或管理混乱。
A.实时性与优先级约束 (Real-time & Priority)
毫秒级延迟：
从输入端接收到异常数据包，到输出端发出 WebSocket 报警指令，全链路内部处理耗时必须 < 500ms。
即使系统处于高负载（如大量历史报表导出时），报警服务的计算资源（CPU/内存）必须保留 独立预留通道，严禁被其他非核心任务抢占。
通信最高优先级：
在消息队列中，报警消息的 Topic 必须标记为 Priority Level 1。
若网络带宽拥堵，系统应自动丢弃低优先级的视频流或普通日志，优先确保报警数据包送达。
B.交互强制性约束 (Interaction Mandatory)
红色报警不可忽略：
对于 CRITICAL 级别的报警，前端严禁提供“一键关闭所有”或“不再提示”的选项。
必须强制使用模态对话框（Modal），遮罩层透明度不得低于 50%，阻断用户对底图的操作，直至用户点击“确认/静音”。
声音通道独占：
报警音效必须覆盖浏览器的其他音频。若当前正在播放教学视频或语音通话，触发红色报警时，必须强制暂停其他音频，全音量播放警报音。
C.防误报与防抖约束 (Anti-False Positive)
严禁裸数据触发：
除了微震（SOS）数据外，严禁直接使用单帧传感器数据触发报警。必须经过 T=3s（可配置）的时间窗平滑处理。
示例：压力从 30 跳到 40 仅持续 0.5 秒又变回 30，严禁报警，必须将其视为干扰信号丢弃。
频次熔断机制：
若同一设备在 1 分钟内产生超过 10 次状态翻转（报警-恢复-报警...），系统应自动进入“设备故障”模式，发送一条“传感器故障”报警，而不是发送 10 条业务报警，防止“狼来了”效应导致管理人员麻木。
D.数据一致性与追溯约束 (Consistency & Audit)
不可篡改日志：
所有的报警触发记录、确认操作（谁、什么时间、IP地址）、恢复记录，必须写入 WORM (Write Once Read Many) 存储或只读数据库表中。
系统管理员也无权物理删除或修改历史报警日志，以满足事故调查的法律合规性。
状态原子性：
报警状态流转（NEW -> ACTIVE -> ACKNOWLEDGED -> RESOLVED）必须是原子操作。严禁出现“前端显示报警已解除，但后台日志仍显示报警中”的状态不一致。
E.鲁棒性与故障导向安全 (Robustness & Fail-Safe)
上游断链报警：
若“数据时间对齐与空间标准化模块”超过 60秒 未发送任何心跳或数据包，本模块必须立即触发 “系统级通信中断” 的黄色预警，提示检查链路，而不是静默等待。
崩溃自愈：
报警服务进程必须配置 Keep-alive 守护。一旦进程意外崩溃，必须在 3秒 内自动重启，并重新读取最后时刻的缓存数据进行状态恢复。
5. Web界面与操作流程 (Web Interface & Operational Workflow)
本模块的界面设计遵循**“分级打断”**原则：对致命危险进行强制阻断，对一般隐患进行柔性提示。
A.界面布局与视觉表现 (Interface Layout & Visuals)
系统通过三个维度的 UI 组件构建全方位的报警网：
a.全局顶部状态栏 (Global Status Bar - 常驻入口)
组件位置：位于系统页面最顶部的右侧功能区。
组件形态：一个“铃铛”图标 + 数字角标。
状态映射：
正常态：铃铛呈灰色，无角标。
预警态 (Warning)：铃铛呈黄色常亮，角标显示未处理预警数（如 "3"）。
报警态 (Critical)：铃铛呈红色闪烁，角标显示未处理报警数。
交互：点击铃铛图标，向下滑出“报警通知中心”面板，列表展示所有当前活跃的报警详情。
b.红色危急报警交互 (Critical Alarm - 强阻断) 
当接收到 LEVEL = CRITICAL 的消息时：
视觉遮罩：全屏幕覆盖一层透明度 30% 的红色遮罩层，并带有 CSS3 呼吸动画（边缘泛红光），模拟警灯效果。
模态弹窗 (Modal)：屏幕正中央弹出高对比度的警示卡片。
标题区：醒目的“严重告警”字样及图标。
内容区：大字号显示异常值（如 “42.5 MPa”），并对比阈值（“> 38.0 MPa”）。
操作区：仅提供唯一的 [确认收到并消音] 按钮，颜色为深红色，防止误触关闭。
声音通道：浏览器强制播放高频蜂鸣警报音（循环，直到点击确认）。
c. 黄色一般预警交互 (Warning Alarm - 弱提示) 
当接收到 LEVEL = WARNING 的消息时：
消息通知条 (Toast)：在屏幕右下角滑出黄色卡片。
内容：简要描述（如“微震频次偏高：6次/小时”）。
行为：停留 10 秒后自动收起进入后台列表，不阻断用户对主界面的操作。
声音通道：播放单次“滴-滴”提示音。
d.关联模块联动高亮 (Contextual Highlighting)
若用户当前正处于 [核心指标实时展示模块] 页面：
触发报警的指标卡片（如矿压卡片）背景色瞬间变为红色，并持续闪烁。
该卡片的数据显示区域会出现“向上箭头”图标，指示数值超限。
B.交互操作流程 (User Interaction Workflow)
以下以“支架压力突增”为例，描述从发生到恢复的标准操作剧本：
阶段一：触发与强感知 (Trigger & Perception)
场景：井下顶板突然来压，中部支架压力瞬间飙升至 40MPa。
系统反应：
值班室音箱立即响起急促警报声。
大屏幕边缘泛起红光，中央弹出红色警告框：“11223工作面 支架压力严重超限！”。
用户行为：值班员的注意力被强制从手机或闲聊中拉回屏幕。
阶段二：确认与响应 (Acknowledgement)
用户行为：值班员快速查看弹窗数值，点击弹窗上的 [确认收到] 按钮。
系统反应：
警报声音停止（消音）。
中央弹窗关闭，屏幕红色遮罩消失。
关键变化：顶部状态栏的“铃铛”图标依然保持红色闪烁，提示隐患尚未消除，只是被人工知晓。
阶段三：诊断与处置 (Diagnosis & Action)
用户行为：值班员点击顶部红色的“铃铛”图标，展开列表，点击“查看详情”。
系统跳转：页面自动跳转至 [核心指标实时展示模块] 或 [矿压分布热力图]。
用户决策：通过热力图确认是局部来压还是整体来压，随即电话通知井下综采队采取“加快拉架”或“强行放顶”措施。
阶段四：恢复与归档 (Resolution)
场景：经过井下处理，支架压力回落至 34MPa（低于恢复阈值）。
系统反应：
顶部“铃铛”图标自动变回灰色。
后台日志数据库中，该条报警记录的状态由 ACKNOWLEDGED 变更为 RESOLVED，并自动计算持续时长（如 "Duration: 15min"）。
前端界面右下角弹出一条绿色通知：“11223工作面 矿压报警已解除”。
6. 测试用例 (Test Cases)
本模块的验收需严格执行黑盒测试与逻辑压力测试。
A.核心算法与规则引擎测试
用例 ID	测试标题	前置条件	操作步骤	预期结果 (Pass Criteria)
TC-ALM-001	矿压阈值边界精度测试	设定红色阈值=38.0 MPa	1. 模拟输入矿压值 37.9 (持续5秒)。2. 模拟输入矿压值 38.0 (持续5秒)。3. 模拟输入矿压值 38.1 (持续5秒)。	1. 无动作。2. 无动作（边界上不触发）。3. 触发红色报警，生成报警 ID。
TC-ALM-002	T-S 信号防抖有效性测试	设定防抖时间 T=3s	1. 输入矿压 40.0 (持续 1.0s)。2. 输入矿压 30.0 (恢复正常)。3. 输入矿压 40.0 (持续 3.5s)。	1. 系统保持静默，日志记录为“过滤毛刺”。2. 无动作。3. 在第 3.0s 时刻正式触发报警。
TC-ALM-003	微震事件瞬时触发测试	微震无防抖逻辑	1. 模拟输入单次微震能量 9000 J。2. 模拟输入单次微震能量 11000 J。	1. 触发黄色预警（若频次未超则无动作）。2. 立即触发红色报警，无任何延迟等待。
TC-ALM-004	压裂施工上下文逻辑测试	设定低压阈值=10MPa	1. 设置施工状态为 STOPPED，压力输入 5.0。2. 设置施工状态为 FRACTURING，压力输入 5.0。	1. 无动作（停机状态低压属正常）。2. 触发红色报警（施工中失压，判定为异常）。
B.交互流程与生命周期测试
用例 ID	测试标题	前置条件	操作步骤	预期结果 (Pass Criteria)
TC-ALM-005	红色报警强阻断交互测试	触发红色报警中	1. 尝试点击底层的“切换工作面”按钮。2. 点击报警弹窗上的“确认收到”按钮。	1. 点击无效，底层界面被红色遮罩层锁定。2. 声音停止，遮罩消失，顶部铃铛保留红色闪烁状态。
TC-ALM-006	报警自动恢复与回差测试	当前报警中，阈值38，回差0.5	1. 模拟输入数值从 39.0 降至 38.0。2. 继续降至 37.4。	1. 报警状态仍为 ACTIVE/ACK（未满足回差解除条件）。2. 报警自动结束，状态变更为 RESOLVED，顶部铃铛变灰。
TC-ALM-007	关联跳转功能测试	触发微震报警	1. 点击报警通知卡片。	1. 页面跳转至 [核心指标实时展示模块]。2. 微震指标卡片背景呈红色高亮显示。
C.性能与容错性测试
用例 ID	测试标题	前置条件	操作步骤	预期结果 (Pass Criteria)
TC-ALM-008	并发报警风暴测试	无	1. 编写脚本，同时模拟 4 大系统共 20 个设备同时超限触发报警。	1. 前端界面不卡顿、不崩溃。2. 弹窗合并显示（如“当前有 20 个异常”），而不是弹出 20 个窗口。3. 声音通道正常，无破音或重叠杂音。
TC-ALM-009	网络延迟与补发测试	客户端断网	1. 断开客户端网络。2. 后端触发报警。3. 恢复客户端网络。	1. WebSocket 重连成功后，客户端立即收到断网期间产生的活跃报警。
TC-ALM-010	上游数据中断自检测试	无	1. 停止“标准化模块”的数据发送服务超过 60s。	1. 报警模块自动触发“系统级异常：数据源离线”，提示检查服务器链路。
(3)数据趋势图与报表展示
1.功能描述：
本模块旨在为管理与技术人员提供深度的历史数据分析能力与自动化的行政汇报支持。通过可视化的手段，揭示监测指标的时间演化规律与空间分布特征，并自动生成标准化报表，辅助进行矿压规律总结与安全评价。
核心功能包括：
多维时间趋势分析：
支持用户自定义时间跨度（日/周/月/自定义），回溯各监测指标（矿压、微震、变形等）的历史走势。
多指标同图对比：支持在同一时间轴上叠加不同类型的指标（例如：将“支架工作阻力”与“微震频次”同图显示），以发现指标间的关联性（如：是否在大能量微震发生前，支架压力有明显增高趋势）。
空间分布可视化：
将枯燥的监测数据映射到 11223 工作面与巷道的平面图上。
热力图/散点图：直观展示顶板离层值在巷道不同位置的分布（识别离层高危区），以及微震事件在空间的散点分布（识别岩层破裂集中区）。
交互式图表操作：
图表支持无损缩放、平移拖拽。
支持“数据点查询”（Tooltip）：鼠标悬停即可显示该时刻/该位置的具体数值。
支持一键导出当前视图为 PNG 图片，方便直接插入 PPT 汇报。
自动化报表中心：
周期性生成：系统自动计算并在每日/每周/每月初生成对应的监测报表（日报、周报、月报）。
统计分析：自动统计最大值、平均值、报警频次、达标率等关键KPI。
数据钻取：在报表中点击汇总数据（如“昨日报警 5 次”），可直接跳转查看这 5 次报警的详细记录。
2.业务逻辑：
本模块属于“离线/准实时计算”场景，核心逻辑在于数据的聚合、映射与统计。
A.时间趋势图处理逻辑 (Time-Series Aggregation)
数据降采样 (Downsampling)：
为了防止前端渲染卡顿，当查询跨度较大（如 30 天）时，后台不能返回秒级数据。
逻辑：系统根据查询窗口大小，自动计算“聚合粒度”。
查“近 24 小时”：返回 5 分钟均值/极值。
查“近 30 天”：返回 1 小时或 日均值/极值。
双轴对齐逻辑：
当对比“压力 (MPa)”和“频次 (次)”时，系统自动启用双 Y 轴渲染，确保两条曲线在视觉上幅度协调，便于观察趋势相关性。
B.空间分布映射逻辑 (Spatial Mapping)
坐标转换：利用标准化模块提供的 $(x, y)$ 坐标，将数据点定位在工作面底图上。
视觉编码：
颜色 (Color)：代表数值大小（如：红色代表高压力/大能量，蓝色代表低压力/小能量）。
尺寸 (Size)：在微震散点图中，圆点越大代表震级越高。
C.报表生成与统计逻辑 (Reporting Engine)
日报逻辑 (Daily Report)：
统计窗口：昨日 00:00:00 至 23:59:59。
计算项：
极值统计：全天最大值、最小值及其发生时刻。
均值统计：全天算术平均值。
异常统计：统计“报警”状态的总触发次数和累计时长。
周报/月报逻辑 (Aggregation Report)：
基于“日报”的二次聚合，而非重新计算原始数据。
趋势分析：计算本周/本月指标的环比变化率（如：支架平均阻力环比上周增加 5%）。
达标率：$达标率 = \frac{\text{指标正常时长}}{\text{总监测时长}} \times 100\%$。
钻取逻辑 (Drill-down)：
报表前端展示的是“统计值”（Summary），点击后，前端携带 date_range 和 metric_type 向后台请求“明细列表”（Detail List）。
3.输入输出：
输入：模块需从历史数据库（Historical Database）中读取已归档的标准化数据：
监测指标历史表：包含 timestamp, device_id, value, coordinate_x, coordinate_y。
报警记录历史表：包含 alarm_id, trigger_time, level, duration。
工作面基础信息：巷道长度、支架数量、采煤进度（用于绘制背景底图）。
输出：
前端渲染数据 (JSON)：
Series Data：经过降采样的时间序列数组 [[timestamp, value], ...]。
Scatter Data：空间散点数组 [[x, y, value, size], ...]。
文件流 (File Stream)：
图片：.png (图表截图)。
文档：.pdf (排版好的报表) 或 .xlsx (原始统计数据)。
4约束条件：
性能约束：
单张图表的数据点渲染上限建议为 5000 点。超过此限制必须执行后端聚合或前端抽稀，防止浏览器崩溃。
报表生成时间（从点击下载到开始下载）应控制在 5秒 以内。
数据一致性：
趋势图中的统计数值（如平均值）必须与报表中的数值完全一致，严禁出现“图上看着是 30，报表里写 32”的情况。
导出格式规范：
PNG 图片分辨率至少为 1920x1080，确保文字清晰可见。
PDF 报表需包含自动生成的时间戳水印和“机密”标识。
存储周期：
明细数据（秒级）保留 3 个月，聚合数据（小时级）保留 5 年。
5. Web 界面与操作流程
界面布局
模块分为两个子页面：[趋势分析看板] 和 [报表管理中心]。
A. 趋势分析看板 (Trend Dashboard)
顶部筛选栏：选择指标类型（矿压/微震/变形）、选择时间范围（日期控件）、选择空间区域（支架号范围/巷道里程）。
主视图区：
Tab 1 - 时间趋势：大型折线图。支持拖拽缩放条（DataZoom）。
Tab 2 - 空间分布：工作面平面地图。叠加显示热力图或散点图。
工具栏：位于图表右上角，包含 [还原]、[导出PNG]、[切换图表类型] 按钮。
B. 报表管理中心 (Report Center)
左侧导航：日报 / 周报 / 月报 文件夹树。
右侧列表：按时间倒序排列的历史报表。
操作列：[预览]、[下载 PDF]、[下载 Excel]。
预览弹窗：显示报表概览，支持点击红色高亮的“报警次数”进行数据钻取，弹出报警详情列表。
用户操作流程
场景一：复盘上周矿压规律
进入 [趋势分析看板]。
指标选择“支架平均阻力”，时间选择“最近 7 天”。
系统渲染出一条波动曲线。
用户发现周三有一处波峰，鼠标框选该区域进行放大。
图表自动重绘为该时段的分钟级精细数据。
用户点击右上角 [导出 PNG]，保存图片用于周会汇报。
场景二：查阅并钻取日报
进入 [报表管理中心]，点击今日生成的“监测日报”。
在预览页看到“今日微震报警：3次（红色高亮）”。
点击数字“3”。
系统右侧滑出抽屉列表，显示这 3 次报警的具体时间、能量值和位置。
6. 测试用例 (Test Cases)
用例 ID	测试项	操作步骤	预期结果 (Pass Criteria)
TC-RPT-001	多指标对比测试	1. 在趋势图中同时勾选“支架压力”和“微震频次”。	1. 图表显示双 Y 轴。2. 两条曲线能够正确叠加显示，时间轴完全对齐。
TC-RPT-002	空间映射准确性	1. 模拟在 (X=100, Y=50) 处发生一次大能量微震。2. 查看空间分布散点图。	1. 散点图准确在坐标 (100, 50) 处显示一个大圆点。2. 鼠标悬停显示坐标值无误。
TC-RPT-003	报表统计精度	1. 导出某日 Excel 报表。2. 手动计算该日原始数据的平均值和最大值。	1. 报表显示的 AVG/MAX 值与人工计算结果误差为 0。
TC-RPT-004	数据钻取功能	1. 在报表预览页点击“报警次数: 5”。	1. 弹出详情列表。2. 列表包含且仅包含这 5 条报警记录，无遗漏或多余。
TC-RPT-005	图表导出测试	1. 调整图表缩放至特定细节区域。2. 点击导出 PNG。	1. 下载的图片内容与当前屏幕显示的细节一致（WYSIWYG），且清晰度满足文档插入要求。

5.4 压裂效果评价模块
5.4.1 数据对比分析
(1)矿压数据对比
1. 功能描述 (Functional Description)
本模块旨在通过长周期的监测数据（压裂前后各 1 个月），综合评估压裂工程对工作面及巷道围岩控制的影响。
多维数据源分析：不仅分析液压支架的工作阻力（区分前柱 P1、中柱 P2、后柱 P3），还同步分析巷道内的锚杆/锚索应力变化，实现“顶板-巷帮”的一体化效果评价。
长周期趋势追踪：将观测窗口锁定为压裂前 30 天与压裂后 30 天，重点捕捉压裂后应力环境的重构与稳定过程。
量化指标对比：通过计算波动系数、稳定时间等深度指标，量化卸压效果及围岩稳定性。
图表组合展示：采用柱状图直观对比统计特征，采用折线图还原时序变化规律。
2. 业务逻辑 (Business Logic)
核心逻辑包括数据清洗、指标算法与可视化映射三部分。
A. 数据筛选与窗口锁定 (Data Filtering)
时间窗口：
读取压裂完成时间 T_{end}。
前置窗口：[T_{end} - 30d, T_{end})。
后置窗口：(T_{end}, T_{end} + 30d]。
对象筛选：
支架数据：选取受压裂影响区域内的支架，分别提取 P1（前柱）、P2（中柱/如果存在）、P3（后柱）的监测序列。
应力数据：选取压裂区域对应巷道断面的锚杆应力计和锚索测力计数据。
B. 对比指标计算引擎 (Calculation Engine)
1. 支架压力指标 (Support Metrics)：
针对 P1, P2, P3 分别计算：
最大值 (P_{max})：窗口期内的峰值压力。
平均值 (bar{P})：窗口期内的算术平均值（剔除 <5MPa 的虚值）。
波动系数 (C_v)：反映顶板破碎或剧烈运动程度。

判定：C_v 越小，说明顶板受力越均匀稳定。
2. 锚杆/锚索应力指标 (Anchor/Cable Metrics)：
最大值 (S_{max}) & 平均值 (\bar{S})。
稳定时间 ($T_{stable}$)：从压裂结束时刻 $T_{end}$ 开始计时，直到应力变化率连续 3 天低于阈值 $\epsilon$（如 0.5 MPa/d）所经历的天数。
判定：$T_{stable}$ 越短，说明围岩越快达到新的平衡状态。
C. 可视化生成逻辑 (Chart Generation)
统计对比（柱状图）：X 轴为指标类型（如均值、最大值），Y 轴为数值，双柱并列（灰色代表压裂前，蓝色代表压裂后）。
趋势对比（折线图）：将“压裂前 30 天”的数据平移，与“压裂后 30 天”的数据叠加在同一张图上，对比曲线走势的差异。
3. 输入输出 (Input & Output)
输入数据 (Input)
参数名	来源模块	类型	说明
support_pressure_detail	数据标准化模块	List	包含 time, device_id, p1, p2, p3 的时序数据
anchor_stress_data	数据标准化模块	List	锚杆/锚索应力时序数据
fracture_event	压裂台账模块	Object	包含压裂时间、位置、关联的支架号及应力计ID

输出数据 (Output JSON)
JSON
{
  "comparison_summary": {
    "support_metrics": {
      "p1": { // 前柱
        "pre": {"max": 42.1, "avg": 35.2, "cv": 0.15},
        "post": {"max": 38.4, "avg": 30.1, "cv": 0.08}, // 波动系数降低，变稳
        "conclusion": "AVG_DECREASED"
      },
      "p2": { ... },
      "p3": { ... }
    },
    "anchor_metrics": {
      "cable_01": {
        "pre": {"max": 120, "avg": 110},
        "post": {"max": 105, "avg": 98, "stable_time_days": 5},
        "conclusion": "STABLE_FAST"
      }
    }
  },
  "chart_data": {
    "bar_chart": { ... }, // 柱状图数据结构
    "line_chart_p1": {    // 折线图数据结构
       "pre_series": [[-30, 35], [-29, 36]...],
       "post_series": [[0, 30], [1, 29]...]
    }
  }
}
4. 约束条件 (Constraints)
数据完整性约束：由于对比周期长达 1 个月，若期间存在超过 5 天的传感器离线或停采检修，系统应在报表中显著标注“样本数据不连续，统计结果仅供参考”。
P值区分约束：必须严格区分 P1/P2/P3 通道，不可混淆计算。通常 P3（后柱）更能反映切顶后的采空区侧向压力变化。
稳定判定阈值：计算“稳定时间”时，阈值 ϵ 需支持配置（默认为 0.5 MPa/d），以适应不同地质条件的矿井。
5. Web 界面与操作流程
A. 界面布局
筛选区：选择【压裂事件】（关联时间 T），勾选【对比数据项】（P1 / P2 / P3 / 锚杆 / 锚索）。
上半区 - 统计概览 (Statistical Summary)：
分组柱状图：展示“压裂前后 P1 阻力均值对比”、“压裂前后波动系数 C_v 对比”。
关键数字卡片：显示“应力稳定时间：5天”、“平均卸压率：14.5%”。
下半区 - 趋势详情 (Trend Details)：
双层折线图：
上层：支架工作阻力 P1/P3 随时间变化曲线（前后 30 天）。
下层：对应区域锚索应力随时间变化曲线。
B. 操作流程
用户进入“数据对比分析”页面。
选择“2208 运输顺槽切顶压裂”记录。
系统自动加载前后各 1 个月的数据。
用户点击“查看 P3 后柱对比”，图表区刷新，发现压裂后 P3 的 C_v 值从 0.25 降至 0.10（表明周期来压不明显，切顶效果好）。
用户点击“查看锚索应力”，看到曲线在压裂后第 7 天趋于平直（稳定时间 = 7天）。
点击“导出分析报告”。
6. 测试用例 (Test Cases)
用例 ID	测试场景	输入模拟	预期结果 (Pass Criteria)
TC-CMP-01	波动系数验证	压裂前：压力在 20-50MPa 剧烈跳动 (Cv​大)。压裂后：压力维持在 30-35MPa (Cv​小)。	1. 柱状图显示压裂后 Cv​ 值显著降低。2. 结论判定为“顶板稳定性提升”。
TC-CMP-02	应力稳定时间计算	压裂后应力数据：第1-3天日增 2MPa，第4天起日增 <0.2MPa。	计算出稳定时间 Tstable​=4 天。
TC-CMP-03	长周期数据缺失	压裂前 1 个月中，有 15 天数据为空。	系统在图表上方显示黄色警告条：“压裂前数据缺失率达 50%，对比结果可能失真”。
TC-CMP-04	P1/P3 差异化分析	P1 均值下降 10%，P3 均值下降 40%。	报表正确反映两者的差异，提示“后柱卸压效果优于前柱”。

(2)微震数据对比
1. 功能描述 (Functional Description)
本模块旨在利用微震监测数据，从微观破裂的角度量化评估水力压裂对岩体结构的影响。通过对比压裂前后的微震活动性，判断压裂是否成功诱导了顶板断裂或应力转移。
长周期活动性追踪：以压裂事件为时间锚点，自动截取前 1 个月（背景期）与后 1 个月（响应期）的微震数据流。
多维指标量化：从频次（活动密集度）、能量（破裂强度）两个维度进行统计对比，计算变化率。
空间演化可视化：通过空间散点图与核密度分析，直观展示压裂前后微震事件集中区域（震源）的迁移规律，验证裂缝扩展范围。
2. 业务逻辑 (Business Logic)
核心逻辑在于数据的时空筛选、统计聚合以及空间特征提取。
A. 数据筛选与清洗 (Data Filtering)
时间窗口：
读取压裂完成时间 $T_{end}$。
背景期 (Pre-Frac)：[$T_{end} - 30d$, $T_{end}$)。
响应期 (Post-Frac)：($T_{end}$, $T_{end} + 30d$]。
空间围栏：仅保留距离压裂中心点一定半径（如 $R \le 200m$）内的微震事件，剔除远场无关事件（如掘进放炮）。
能级过滤：支持设定最小能量阈值（如 $E_{min} \ge 100J$），过滤系统底噪。
B. 对比指标计算引擎 (Calculation Engine)
1. 频次指标 (Frequency Metrics)：
日均事件数 ($\bar{F}_{day}$)：$\text{Total Events} / 30$。
周均趋势：按 7 天滑动窗口计算频次曲线，观察是否呈现“先增后减”的卸压特征。
2. 能量指标 (Energy Metrics)：
总能量释放 ($\sum E$)：响应期总能量 vs 背景期总能量。
平均能量 ($\bar{E}$)：$\sum E / \text{Total Events}$。反映单次破裂的平均强度。
最大能量 ($E_{max}$)：对比期间发生的最大一次震动，用于评估冲击风险。
3. 空间分布特征 (Spatial Distribution)：
高能集中区：识别能量 $> 10^3J$ 的事件坐标，计算其几何中心（Centroid）。
分布迁移：对比前后几何中心的垂直高度（Z轴）变化，判断破裂带是否向高位顶板发育。
C. 可视化生成逻辑 (Visualization)
统计对比 (柱状图)：
频次对比：双柱展示（灰：前，蓝：后）。
能量对比：堆叠柱状图，区分小能量、中能量、大能量事件占比。
空间对比 (散点图)：
生成两张并列的 $X-Y$ 或 $X-Z$ 平面图。
X轴/Y轴：工作面坐标。
散点颜色：代表能量大小（冷色低，暖色高）。
散点大小：代表震级。
3. 输入输出 (Input & Output)
输入数据 (Input)
参数名	来源模块	类型	说明
ms_event_list	数据标准化模块	List	包含 time, energy, magnitude, x, y, z 的事件列表
fracture_info	压裂台账模块	Object	包含压裂时间、中心坐标 (Xf​,Yf​,Zf​)
filter_params	前端交互	Object	筛选半径、能量阈值

输出数据 (Output JSON)
JSON
{
  "comparison_summary": {
    "frequency": {
      "pre_daily_avg": 12.5,
      "post_daily_avg": 8.2,
      "change_rate": "-34.4%" // 频次降低，卸压有效
    },
    "energy": {
      "pre_total": 450000,
      "post_total": 320000,
      "pre_max": 8900,
      "post_max": 4500 // 最大能量显著降低
    },
    "spatial_feature": {
      "fracture_height_pre": 15.5, // 平均震源高度
      "fracture_height_post": 28.4 // 裂缝向上发育
    }
  },
  "chart_data": {
    "bar_freq": { "categories": ["Pre", "Post"], "values": [375, 246] },
    "scatter_pre": [[100, 200, 500], [105, 205, 1200]...], // [x, y, energy]
    "scatter_post": [[102, 201, 300], [110, 210, 400]...]
  }
}
4. 约束条件 (Constraints)
非天然震动剔除：必须结合爆破记录表，剔除固定时间窗口（如放炮前后 30 分钟）内的微震事件，防止人工爆破震动干扰压裂效果评估。
传感器一致性：若对比期间 SOS 微震系统发生过检修或测站调整（导致灵敏度变化），需在报告中进行数据校正或标注。
样本量阈值：若某个月份微震事件总数 < 10 个（样本过少），则不进行平均值和分布分析，直接提示“样本不足，无法统计”。
5. Web 界面与操作流程
A. 界面布局
顶部信息栏：显示当前分析的压裂工程名称，以及“分析窗口：2026-01-01 ~ 2026-03-01”。
左侧：统计对比区：
频次/能量仪表盘：使用红绿箭头展示变化率（如：📉 总能量下降 28%）。
对比柱状图：展示日均频次、最大能量的直观对比。
右侧：空间演化区：
双屏地图：左侧显示“压裂前分布”，右侧显示“压裂后分布”。
支持切换视图：俯视图 ($X-Y$) / 侧视图 ($X-Z$)。
B. 操作流程
用户选择“30 联巷切顶压裂”记录。
系统自动加载前后 1 个月数据。
用户观察柱状图，发现压裂后频次虽有增加，但单次平均能量显著下降（说明大事件被分解为小事件，是好的迹象）。
用户切换到“侧视图 ($X-Z$)”，发现压裂后微震点主要集中在顶板上方 20-30 米处，确认人工裂缝已成功切断基本顶。
点击“生成微震评估报告”。
6. 测试用例 (Test Cases)
用例 ID	测试场景	输入模拟	预期结果 (Pass Criteria)
TC-MS-01	能量释放验证	压裂前：偶发 104J 大能量事件。压裂后：全是 <103J 的小事件，总能量持平。	1. 平均能量大幅下降。2. 结论判定为“冲击风险降低”。
TC-MS-02	空间高度发育验证	压裂前震源高度 Z≈10m。压裂后震源高度 Z≈30m。	1. 系统计算出震源质心高度提升 20m。2. 判定“裂缝发育充分”。
TC-MS-03	干扰数据过滤	数据中包含每日 10:00 的规律性高能事件（放炮）。	开启“爆破过滤”功能后，统计结果中自动剔除这些噪点。
TC-MS-04	无响应处理	压裂前后频次、能量、位置几乎无变化。	评价结果显示“未观测到明显微震响应”，建议检查压裂施工参数。
(3)变形数据对比
1. 功能描述 (Functional Description)
本模块旨在通过定量对比水力压裂前后的巷道表面位移数据，评估压裂切顶卸压对巷道维护状况的改善效果。
围岩稳定性量化：通过分析两帮移近量、顶板下沉量及底鼓量的变化，判断压裂是否有效减缓了巷道收敛。
长周期变形追踪：锁定压裂前后各 1 个月的时间窗口，从“累计变形量”和“瞬时变形速率”两个维度进行深度剖析。
稳定趋势判别：自动计算变形速率衰减至安全阈值所需的时间，直观反映围岩从活跃期过渡到稳定期的快慢。
多图表联动展示：通过柱状图对比极值与均值，通过折线图还原变形演化全过程。
2. 业务逻辑 (Business Logic)
核心逻辑包括数据的空间关联、时序切片、速率计算及稳定判据。
A. 数据筛选与对象锁定 (Data Filtering)
时间窗口：
读取压裂完成时间 $T_{end}$。
基准期 (Pre-Frac)：[$T_{end} - 30d$, $T_{end}$)
观察期 (Post-Frac)：($T_{end}$, $T_{end} + 30d$]。
空间筛选：
根据压裂钻孔位置，筛选出影响半径内（如 50m 范围）的巷道表面位移监测站。
数据类型包含：rib_convergence (两帮移近)、roof_subsidence (顶板下沉)、floor_heave (底鼓，如有)。
B. 对比指标计算引擎 (Calculation Engine)
1. 变形量指标 (Displacement Metrics)：
区间增量 (∆L)：统计窗口期内的累计变形量。
最大变形量 (L_{max})：窗口期内记录到的最大绝对位移值。
平均变形量 (bar{L})：窗口期内各采样点位移的算术平均值。
2. 变形速率指标 (Velocity Metrics)：
首先计算每日变形速率 
最大变形速率 (V_{max})：反映围岩剧烈活动的峰值强度。
日均变形速率 (bar{V})：反映围岩持续活动的平均强度。
3. 稳定时间 ($T_{stable}$)：
定义：从 T_{end} 开始，直到连续 $N$ 天（如 3 天）变形速率 V < V_{limit}（如 1mm/d）所经历的天数。
逻辑：若观察期结束仍未稳定，标记为“未稳定”。
C. 可视化生成逻辑 (Visualization)
总量对比 (柱状图)：
两帮/顶底板对比：分组柱状图，展示压裂前后 $L_{max}$ 和 $\bar{V}$ 的差异。
趋势演化 (折线图)：
双Y轴图表：左轴为累计变形量 (mm)，右轴为变形速率 (mm/d)。
时序拼接：将压裂前 30 天与后 30 天连贯展示，并在 $X=0$ 处标注“压裂施工点”。
3. 输入输出 (Input & Output)
输入数据 (Input)
参数名	来源模块	类型	说明
deformation_series	数据标准化模块	List	包含 time, station_id, rib_val, roof_val 的时序数据
fracture_event	压裂台账模块	Object	包含压裂时间、位置
threshold_params	配置/前端	Object	稳定判据阈值 (默认为 1mm/d)

输出数据 (Output JSON)
JSON
{
  "comparison_summary": {
    "rib_convergence": { // 两帮移近
      "pre": { "max_amount": 120.5, "avg_rate": 5.2 }, // 压裂前速率快
      "post": { "max_amount": 145.2, "avg_rate": 1.1, "stable_time": 6 }, // 压裂后速率显著降低，6天稳定
      "conclusion": "RATE_DECREASED" // 评价：变形速率减缓
    },
    "roof_floor": { // 顶底板
      "pre": { "max_amount": 50.1, "avg_rate": 2.0 },
      "post": { "max_amount": 65.4, "avg_rate": 0.8, "stable_time": 4 },
      "conclusion": "STABLE"
    }
  },
  "chart_data": {
    "bar_comparison": { ... },
    "line_trend": {
      "time_axis": [-30, -29, ... 0, ... 30],
      "rib_rate_series": [5.1, 5.3, ... 1.2, 0.9 ...]
    }
  }
}
4. 约束条件 (Constraints)
人为干扰过滤：巷道监测数据常受人为因素（如撞击传感器、重新挂线）影响产生数据突变。算法需具备**“阶跃剔除”**功能，将瞬间变化超过 50mm 的点识别为异常并平滑处理。
采动影响分离：若对比期间工作面推进经过该监测站，变形量会自然剧增。报告中需标注“受采动叠加影响”，避免将采动变形误判为压裂失效。
基准统一：对比“变形量”时，压裂后的累计值应扣除压裂时刻的初始值（归零处理），或者仅对比“增量”，否则单纯对比绝对值（压裂后肯定大于压裂前）没有意义。
5. Web 界面与操作流程
A. 界面布局
筛选栏：选择【压裂事件】，选择【监测测站】（如：200m 处测站）。
左侧：关键指标卡 (KPI Cards)：
显示“两帮移近速率下降：78%”。
显示“顶底板稳定时间：4 天”。
右侧：图表分析区：
Tab 1 - 速率对比柱状图：直观展示压裂前后日均速率的落差。
Tab 2 - 累计变形曲线：展示巷道收敛趋势，压裂后曲线斜率应明显变缓。
B. 操作流程
用户进入“变形数据对比”页面。
选中最近一次的“回风巷切顶压裂”。
选择受影响的“#3 表面位移监测站”。
系统加载数据，用户发现压裂前（灰色区域）两帮变形曲线陡峭（速率 5mm/d），压裂后（蓝色区域）曲线迅速平缓（速率 0.5mm/d）。
用户查看“稳定时间”指标，显示为 6 天，符合预期。
点击导出图片，用于工程周报。
6. 测试用例 (Test Cases)
用例 ID	测试场景	输入模拟	预期结果 (Pass Criteria)
TC-DEF-01	卸压有效性验证	压裂前速率 10mm/d；压裂后速率降至 2mm/d。	1. 计算出速率降低 80%。2. 结论判定为“巷道稳定性显著提升”。
TC-DEF-02	稳定时间计算	压裂后数据：第1-5天速率>1mm/d，第6天起连续<1mm/d。	计算出 Tstable​=5 天。
TC-DEF-03	异常突变处理	数据中某一天变形量突然增加 100mm（撞击），次日恢复。	算法自动识别并剔除该噪点，不影响平均速率计算。
TC-DEF-04	压裂失效/恶化	压裂后变形速率不降反升（如从 5mm/d 升至 15mm/d）。	1. 界面显示红色警告“变形加速”。2. 建议核查是否压裂导致围岩破碎失稳。

5.4.2 评价指标计算
（1） 顶板稳定性指标
1. 功能描述 (Functional Description)
本模块旨在构建一个多源融合的数学模型，用于对压裂施工后的顶板状态进行“一票定音”式的量化评分。
多维融合计算：打破单一指标的局限性，将顶板离层（位移）、支架压力（受力）、微震能量（破裂）三个维度的监测数据进行标准化处理和加权融合。
量化评分机制：基于预设的权重体系，计算出 0~100 分的“顶板稳定系数”，分数越高代表顶板越安全。
智能分级预警：根据计算结果自动匹配“稳定、基本稳定、不稳定”三个安全等级，并生成相应的颜色预警标识。
2. 业务逻辑 (Business Logic)
核心逻辑在于数据的归一化标准化与加权扣分模型。
A. 基础数据准备 (Data Preparation)
时间窗口：默认为压裂施工结束后的 7天 或 30天（可配置，与数据对比模块保持一致）。
数据源获取：
顶板离层 (D)：提取窗口期内的最大离层值 D_{max} (mm)。
支架压力 (P)：提取窗口期内支架工作阻力的标准差 σ_P 和平均值 μ_P (MPa)。
微震能量 (E)：提取窗口期内微震事件的平均能量 bar{E} (J)。
B. 归一化标准化 (Normalization)
需将不同量纲的物理量转化为无量纲的“风险系数” (值域建议控制在 [0, 1] 之间，若超限需截断)：
顶板离层标准化值 (N_{sep})：

注：L_{sep_limit} 为离层允许值，默认配置为 50mm。
支架压力波动系数 (N_{pres})：

注：即变异系数 (C_v)，反映压力的离散程度。
微震能量标准化值 (N_{ms})：

注：L_{energy_limit} 为微震能量预警值，默认配置为 1000J。
C. 综合得分计算 (Scoring Formula)
采用“倒扣分制”，即风险越高，扣分越多：

边界约束：若计算结果 S < 0，强制置为 0（极度不稳定）。
D. 等级判定 (Classification)
稳定：S>=80 （特征：变形小，受力稳，微震弱）
基本稳定：60<S< 79 （特征：轻微变形，偶有波动）
不稳定：S < 60 （特征：变形明显，离散大，能量高）
3. 输入输出 (Input & Output)
输入数据 (Input)
参数名	来源模块	类型	说明
roof_separation_max	数据对比模块	Float	压裂后顶板离层最大值 (mm)
support_pressure_stats	数据对比模块	Object	包含压裂后压力的 std_dev 和 avg (MPa)
ms_avg_energy	数据对比模块	Float	压裂后微震平均能量 (J)
config_limits	配置中心	Object	{sep_limit: 50, energy_limit: 1000}

输出数据 (Output JSON)
JSON
{
  "stability_evaluation": {
    "score": 85.4,  // 计算结果
    "level": "STABLE", // 稳定/基本稳定/不稳定
    "color_code": "#28a745", // 绿色
    "factors": { // 因子详情，用于回溯扣分原因
      "norm_separation": 0.12, // (6mm / 50mm)
      "norm_pressure": 0.15,   // (5MPa / 33MPa)
      "norm_energy": 0.20      // (200J / 1000J)
    },
    "description": "顶板状态稳定，各项指标均在安全范围内。"
  }
}
4. 约束条件 (Constraints)
参数热更新：计算公式中的默认阈值（50mm, 1000J）必须支持管理员在后台进行调整，以适应不同地质条件的巷道（例如软岩巷道可能允许更大的变形）。
缺失值处理：若某类传感器（如顶板离层仪）未安装或离线，导致 N_{sep} 无法计算，算法应具备**“降级计算”**能力（例如：将该项权重按比例分配给剩余两项，或直接返回“数据不足无法评估”）。
异常值熔断：若 N_{sep} 或 N_{ms} 计算结果 $> 1.0$（即实际值超过了允许值），则该项标准化值按 1.0 封顶计算，防止权重乘积过大导致负分过低，但同时应触发“单项超限报警”。
5. Web 界面与操作流程
A. 界面布局
核心仪表盘：
界面中央展示一个半圆形的刻度仪表盘 (Gauge Chart)。
指针指向当前分数（如 85）。
刻度带分为三段颜色：红 (0-59)、黄 (60-79)、绿 (80-100)。
因子雷达图：
仪表盘旁展示一个小型的雷达图，三个顶点分别为“离层”、“矿压”、“微震”。
面积越小代表风险越小（即 N 值越小）。
详细数据表：
列出计算公式中各项的实际值与标准值的对比。
B. 操作流程
用户在“压裂效果评价”页面，完成前序的数据对比分析。
系统基于对比数据，自动触发“指标计算”。
页面右上角的“顶板健康度”卡片自动刷新，指针转动至 85分 位置。
用户看到雷达图中“微震”一角略微突出，点击查看详情，发现平均能量为 400J（接近警戒线一半），系统提示“需持续关注微震活动”。
6. 测试用例 (Test Cases)
用例 ID	测试场景	输入模拟	计算过程与预期结果 (Pass Criteria)
TC-IDX-01	稳定状态验证	离层=5mm压力 σ=3,μ=30均能=100J	Nsep​=0.1,Npres​=0.1,Nms​=0.1S=(1−0.04−0.03−0.03)×100=90结果：稳定
TC-IDX-02	不稳定状态验证	离层=40mm压力 σ=10,μ=30均能=800J	Nsep​=0.8,Npres​=0.33,Nms​=0.8S=(1−0.32−0.099−0.24)×100=34.1结果：不稳定
TC-IDX-03	边界超限处理	离层=60mm (超限)	Nsep​=60/50=1.2→ 截断为 1.0。确保分数不会因单项过大而失真，同时系统标记该项异常。
TC-IDX-04	阈值配置验证	修改能量预警值为 2000J	输入均能=1000J。旧结果 Nms​=1.0 (高危)。新结果 Nms​=0.5 (中等)。验证参数修改生效。

(2) 压裂有效率
1. 功能描述 (Functional Description)
本模块旨在通过对比压裂施工前后的综合风险状态，计算“压裂有效率”这一核心KPI，量化评估工程的投入产出比。
全维风险量化：将顶板离层、支架压力、微震活动、巷道变形四大类监测数据，通过“区间打分法”转化为统一的风险得分。
前后差异对比：分别计算“压裂前综合风险得分”与“压裂后综合风险得分”，通过差值比率直观反映压裂对灾害风险的削减程度。
效果自动分级：根据计算出的有效率百分比，自动判定工程效果为“有效、一般”或“无效”。
2. 业务逻辑 (Business Logic)
核心逻辑包含区间映射打分、加权综合及效率判定三个步骤。
A. 分项风险得分计算 (Sub-Risk Scoring)
系统需针对压裂前（背景期）和压裂后（响应期）的数据分别进行打分。打分采用分段阶梯函数（具体阈值需支持后台配置，以下为默认标准）：
1. 顶板离层风险 ($S_{sep}$)：
<=10mm：0 分 (安全)
10~30mm：30 分 (关注)
30~50mm：60 分 (预警)
>50mm：100 分 (危险)
2. 支架压力风险 ($S_{pres}$) (依据工作阻力利用率或均值)：
<=30MPa：0 分
30~35MPa：30 分
35~40 MPa：60 分
> 40 MPa：100 分
3. 微震风险 ($S_{ms}$) (依据日均能量或频次)：
<=1000 J：0 分
1000~5000 J：30 分
5000~10000 J：60 分
> 10000 J：100 分
4. 巷道变形风险 (S_{def}) (依据日均变形速率)：
<=1 mm/d：0 分
1~5 mm/d：30 分
5~10 mm/d：60 分
> 10 mm/d：100 分
B. 综合风险得分计算 (Composite Risk Score)
公式如下：
分别计算出压裂前得分 R_{pre} 和压裂后得分 R_{post}。
C. 压裂有效率计算 (Efficiency Calculation)

D. 等级划分 (Classification)
有效：E>=30% （风险削减显著）
一般：10%<=E < 29% （风险略有降低）
无效：E < 10% （风险未变或升高）
3. 输入输出 (Input & Output)
输入数据 (Input)
参数名	来源模块	类型	说明
pre_frac_stats	数据对比模块	Object	包含压裂前各指标的统计值(max/avg)
post_frac_stats	数据对比模块	Object	包含压裂后各指标的统计值(max/avg)
scoring_rules	配置中心	Object	各指标的区间阈值及对应分数

输出数据 (Output JSON)
JSON
{
  "efficiency_evaluation": {
    "efficiency_rate": 45.5, // 压裂有效率 (%)
    "level": "EFFECTIVE",    // 有效/一般/无效
    "scores": {
      "pre_risk_score": 76.0,  // 压裂前综合分
      "post_risk_score": 41.4, // 压裂后综合分
      "details": {
        "separation": {"pre": 60, "post": 30}, // 单项得分对比
        "pressure":   {"pre": 60, "post": 30},
        "ms":         {"pre": 100,"post": 60},
        "deformation":{"pre": 60, "post": 30}
      }
    },
    "conclusion": "压裂施工有效，综合风险降低 45.5%。"
  }
}
4. 约束条件 (Constraints)
前置风险过低处理：若压裂前综合风险得分 $R_{pre} \le 10$ 分（即本身就没什么风险），此时计算有效率意义不大（分母过小会导致结果失真）。系统应直接返回“无需评估”或“背景风险低”，不强制计算百分比。
负效率处理：若 $R_{post} > R_{pre}$（压裂后风险反而升高），计算结果为负数（如 -20%）。系统应强制归类为“无效”，并用红色高亮提示“风险恶化警报”。
数据对齐：计算 $R_{pre}$ 和 $R_{post}$ 时，必须保证使用的“区间打分标准”完全一致，严禁使用不同的标准进行对比。
5. Web 界面与操作流程
A. 界面布局
效率计分卡：
左侧显示巨大的百分比数字（如 45.5%），背景色根据等级变化（绿/黄/红）。
右侧显示结论标签：“矿压控制效果良好”。
风险雷达对比图：
绘制两个重叠的雷达图（四边形）。
<span style="color:gray">灰色区域</span>代表压裂前风险，<span style="color:blue">蓝色区域</span>代表压裂后风险。
直观展示蓝色区域是否被灰色区域完全包裹（即风险全方位收缩）。
得分明细表：
展示“指标值 -> 风险分 -> 权重分”的计算过程。
B. 操作流程
用户进入“压裂效果评价”页面，点击【计算压裂有效率】。
系统读取前后各 30 天数据，依据内置规则打分。
界面展示雷达图，用户清晰看到“微震”和“离层”两个维度的风险面积显著缩小。
用户确认结果为“有效”，点击【生成验收报告】。
6. 测试用例 (Test Cases)
用例 ID	测试场景	输入模拟	计算过程与预期结果 (Pass Criteria)
TC-EFF-01	效果显著验证	前：离层60(分值100), 压42(100), 微震1.2W(100), 变8(60)后：离层20(30), 压32(30), 微震4K(30), 变3(30)	Rpre​=30+20+30+12=92Rpost​=9+6+9+6=30E=(92−30)/92≈67.4%结果：有效
TC-EFF-02	效果一般验证	Rpre​=80,Rpost​=65	E=(80−65)/80=18.75%结果：一般
TC-EFF-03	风险恶化验证	Rpre​=50,Rpost​=60	E=(50−60)/50=−20%结果：无效 (风险升高)
TC-EFF-04	分母极小边界	Rpre​=5	系统提示“压裂前风险极低，不进行有效率计算”。
(3) 矿压控制效果指标
1. 功能描述 (Functional Description)
本模块旨在计算“矿压控制效果指标”，这是一个复合型 KPI，用于从围岩形变（巷道）和支架受力（工作面）两个维度，双向评估水力压裂工程的最终成效。
双控评估：算法同时考量了压裂对“软指标”（巷道变形量的减少）和“硬指标”（支架压力峰值的削减）的贡献，权重各占 50%。
量化归一：将复杂的岩层控制效果转化为一个 0~100 分的直观数值，分数越高，说明卸压护巷效果越好。
分级验收：依据得分自动判定工程验收等级（优秀/良好/合格/不合格），直接支撑工程结算与绩效考核。
2. 业务逻辑 (Business Logic)
核心逻辑在于基准值的聚合计算、变化率的合成以及等级的映射。
A. 基础数据聚合 (Data Aggregation)
需要分别获取压裂前（基准期）和压裂后（观察期）的极值数据：
巷道变形分量：
D_{rib}：两帮移近量最大值 (Max Rib Convergence)。
D_{roof}：顶底板移近量最大值 (Max Roof-Floor Convergence)。
聚合变形量 (D)：取两者的算术平均值。

支架压力分量：
P_{max}：支架工作阻力最大值 (Max Support Resistance)。
B. 变化率与指标计算 (Calculation Formula)
变形减少率 (η_{def})：

压力降低率 (η_{pres})：

矿压控制效果指标 (I_{control})：

C. 物理含义与边界处理
正收益：若 D_{post} < D_{pre} 且 P_{post} < P_{pre}，则 η> 0，指标得分为正。
负收益 (恶化)：若压裂后变形或压力不降反升（如 P_{post} > P_{pre}），则η < 0，会导致最终得分降低甚至出现负分。
边界锁存：若计算出的 I_{control} > 100（理论上极少出现，除非压裂前数据异常小），强制置为 100；若 I_{control} < 0，强制置为 0，并标记为“严重失效”。
D. 等级划分标准 (Grading Standard)
优秀：I_{control} >= 70
物理特征：巷道收敛显著减缓（减少 >= 50%），周期来压强度大幅降低（降低 >= 50%）。
良好：50 <= I_{control} < 69
物理特征：各项指标改善幅度在 30%~49% 之间。
合格：30 <= I_{control} < 49
物理特征：各项指标改善幅度在 10%~29% 之间，勉强达标。
不合格：I_{control} < 30
物理特征：改善幅度 < 10%，或指标出现恶化（负增长）。
3. 输入输出 (Input & Output)
输入数据 (Input)
参数名	来源模块	类型	说明
pre_deformation	数据对比模块	Object	{rib_max: 120, roof_max: 80} (mm)
post_deformation	数据对比模块	Object	{rib_max: 50, roof_max: 40} (mm)
pre_pressure_max	数据对比模块	Float	压裂前支架压力峰值 (45.0 MPa)
post_pressure_max	数据对比模块	Float	压裂后支架压力峰值 (22.0 MPa)

输出数据 (Output JSON)
JSON
{
  "control_effect_evaluation": {
    "score": 53.6,
    "level": "GOOD", // 优秀/良好/合格/不合格
    "sub_metrics": {
      "deformation_reduction": 54.17, // 变形减少率 (%)
      "pressure_reduction": 51.11     // 压力降低率 (%)
    },
    "raw_data_snapshot": {
      "avg_def_pre": 100.0, // (120+80)/2
      "avg_def_post": 45.0, // (50+40)/2
      "p_max_pre": 45.0,
      "p_max_post": 22.0
    },
    "conclusion": "评价为[良好]。巷道变形控制效果显著(>50%)，但支架压力改善略低，整体符合预期。"
  }
}
4. 约束条件 (Constraints)
分母非零保护：压裂前数据 (D_{pre}, P_{pre_max}) 作为分母，必须大于 0。若数据库中压裂前数据缺失或为 0，算法应抛出 CalculationError，提示“缺乏基准数据，无法评估”。
单位统一性：
变形量必须统一为 mm。
压力值必须统一为 MPa。
严禁将锚杆应力（MPa）误混入变形量计算。
权重可配置：目前的 0.5 : 0.5 权重应作为系统配置项。在某些“强矿压、弱变形”的坚硬顶板条件下，管理员可能需要调整为 支架压力(0.7) + 巷道变形(0.3)。
5. Web 界面与操作流程
A. 界面布局
成绩单卡片 (Score Card)：
左侧显示大号得分（如 75 分），配以等级印章（如“优秀”）。
右侧显示两个进度条，分别代表“变形改善率”和“压力改善率”。
效果对比直方图：
图表 A：巷道变形对比。柱状图显示压裂前后的 D 值，上方标注下降百分比（如 downarrow 58%）。
图表 B：支架压力对比。柱状图显示压裂前后的 P_{max} 值，上方标注下降百分比（如 downarrow 51%）。
详细计算过程：
展开显示公式代入数值的过程，方便技术人员核对。
B. 操作流程
用户在评价页面点击【计算矿压控制效果】。
系统自动提取压裂前后各 30 天的极值数据。
界面弹出计算结果，显示得分为 25 分，等级为 不合格。
用户查看详情发现：虽然“支架压力”降低了 40%，但“巷道变形量”反而增加了 10%（可能是受邻近采动叠加影响）。
用户点击【人工修正】，备注“受 11225 工作面回采动压影响”，并手动调整评价结论。
6. 测试用例 (Test Cases)
用例 ID	测试场景	输入模拟	计算过程与预期结果 (Pass Criteria)
TC-CTL-01	优秀等级验证	变形：100mm → 40mm (↓60%)压力：40MPa → 18MPa (↓55%)	I=(0.6×0.5+0.55×0.5)×100=57.5修正：按公式计算为 57.5?不对，按公式：(0.6×0.5+0.55×0.5)=0.575×100=57.5。等等，用例逻辑需修正：变形减少 60% (≥50)，压力减少 55% (≥50)。得分 57.5 属于“良好”。注意：需求中“优秀”定义为 ≥70 分。这意味着单项减少率必须很高，例如 70%。若输入：变形 ↓80%, 压力 ↓70%。得分：(0.8×0.5+0.7×0.5)×100=75。结果：优秀。
TC-CTL-02	合格等级验证	变形：100 → 80 (↓20%)压力：40 → 30 (↓25%)	I=(0.2×0.5+0.25×0.5)×100=22.5结果：不合格 (<30)。注：此测试揭示了如果不达到30%的减少率，很难及格。
TC-CTL-03	负增长处理	变形：100 → 120 (恶化 ↑20%)压力：40 → 20 (↓50%)	ηdef​=−0.2,ηpres​=0.5I=(−0.1+0.25)×100=15结果：不合格。
TC-CTL-04	零基准异常	Dpre​=0	系统报错 DivisionByZero，提示“无压裂前变形数据”。

5.4.3 评价报告生成
(1)自动生成评价报告
1. 功能描述 (Functional Description)
本模块是压裂效果评价子系统的“最终产出端”。旨在将零散的监测数据、对比图表及量化指标，通过预设的文档模板引擎，一键组装成标准化的工程验收报告。
智能化组装：自动抓取钻孔台账、矿压/微震/变形对比图表、各项评价指标得分，无需人工复制粘贴。
逻辑化结论：基于评价指标的等级（如“优秀”、“无效”），内置专家规则库，自动生成初步的“结论与建议”文本，供工程师参考修订。
多格式兼容：支持生成 PDF（用于存档/不可篡改）和 Word（用于人工精修）两种格式。
2. 业务逻辑 (Business Logic)
核心逻辑分为模板映射、数据填充与智能文案生成三部分。
A. 报告结构定义 (Report Structure)
系统内置标准模板，包含以下七大章节：
封面 (Cover)：
动态填充：报告名称（如《11223工作面28联巷切顶压裂效果评价报告》）、评价对象、起止时间、编制人（当前用户）、生成日期。
目录 (TOC)：
自动生成，带页码跳转链接。
第一章 压裂施工概况 (Overview)：
从“压裂参数展示模块”抓取：钻孔编号列表、压裂总段数、施工起止时间。
统计表：累计注水量 ($m^3$)、平均施工压力 (MPa)、最大施工压力 (MPa)。
第二章 数据对比分析 (Comparison Analysis)：
图文混排：依次插入 5.4.1 模块生成的“矿压对比柱状图”、“微震频次变化图”、“巷道变形曲线图”。
自动描述：例如插入文本“压裂后，支架平均工作阻力由 38MPa 下降至 32MPa，降幅 15.8%。”
第三章 评价指标计算 (Indicator Evaluation)：
展示 5.4.2 模块的三个核心指标得分：
顶板稳定系数：85 (稳定)
压裂有效率：45% (有效)
矿压控制效果指标：65 (良好)
插入“风险雷达图”和“得分仪表盘”截图。
第四章 结论与建议 (Conclusion & Suggestion)：
结论生成逻辑：
若三个指标均为“有效/稳定/合格”以上-生成“本次压裂施工效果显著，达到了预期的卸压目的。”
若“压裂有效率” < 10% -生成“本次压裂效果不佳，主要表现为矿压显现未明显减缓。”
建议生成逻辑：
若微震能量高-建议“加强微震监测，警惕大能量事件。”
若巷道变形大-建议“对变形严重区域进行补强支护。”
附件 (Appendices)：
附表：每日矿压监测数据清单（前30天+后30天）。
附图：压裂孔位布置图。
B. 报告生成流程 (Generation Workflow)
触发：用户点击“生成报告”，传入 fracture_id 和 time_range。
提取：后端并发调用 5.4.1 和 5.4.2 的计算服务，获取 JSON 数据及 Base64 格式的图表图片。
渲染：使用模板引擎（如 Freemarker/POI）将数据填入 .docx 模板。
转换：利用转换组件（如 Aspose/OpenOffice）将 Word 转为 PDF。
归档：将生成的文件上传至文件服务器，并在数据库记录 report_log。
3. 输入输出 (Input & Output)
输入数据 (Input)
参数名	来源	类型	说明
fracture_event_id	用户选择	String	目标压裂工程ID
eval_window	用户选择	Object	{start: "2026-01-01", end: "2026-03-01"}
template_id	系统配置	String	使用的报告模板ID
custom_conclusion	用户输入	String	(可选) 用户手动填写的补充结论
输出数据 (Output)
文件流：.pdf 文件（预览/下载）和 .docx 文件（下载编辑）。
数据库记录：
JSON
{
  "report_id": "RPT-20260205-001",
  "title": "28联巷压裂评价报告.pdf",
  "status": "SUCCESS",
  "create_time": "2026-02-05 10:00:00",
  "download_url": "/api/files/reports/RPT-20260205-001.pdf"
}
4. 约束条件 (Constraints)
时效性约束：系统必须在 10分钟 内完成报告生成。建议通过异步任务队列（Message Queue）处理，前端显示进度条，避免 HTTP 请求超时。
图表清晰度：插入文档的统计图表（折线图、云图）DPI 必须 $\ge 300$，确保打印后文字清晰可见，严禁出现模糊截图。
空数据处理：若某章节（如微震）无数据，报告中不应留白或报错，应自动插入文本：“该时间段内未监测到有效微震数据。”
版式固定：PDF 版本的排版（页眉、页脚、水印）必须严格遵循企业标准公文格式。
5. Web 界面与操作流程
A. 界面布局
报告配置向导 (Wizard)：
第一步：基础信息。确认评价对象、时间范围。
第二步：内容选择。勾选需要包含的章节（默认全选）。
第三步：结论预览。文本域显示系统自动生成的结论，支持用户手动修改或追加。
生成进度弹窗：
显示进度条：“正在获取矿压数据... 正在渲染图表... 正在合成文档...”。
结果页：
左侧显示 PDF 在线预览。
右侧提供【下载 PDF】、【下载 Word】、【发送邮件】按钮。
B. 操作流程
用户完成所有指标分析后，点击顶部导航栏的【生成评价报告】按钮。
系统弹出配置框，自动填入当前分析的时间段，用户确认无误。
用户在“结论预览”中看到系统建议：“效果良好”，并手动补充了一句：“建议后续减少 2# 钻孔的注水量。”
点击【开始生成】。
等待约 30 秒（显示进度条）。
生成完毕，浏览器自动下载 Word 文档，同时页面显示 PDF 预览。
6. 测试用例 (Test Cases)
用例 ID	测试场景	输入模拟	预期结果 (Pass Criteria)
TC-RPT-01	全流程生成	选择完整数据源，点击生成	1. 耗时 < 10分钟。2. 成功下载 docx 文件。3. 打开文档，7大章节齐全，图表清晰，数据与界面一致。
TC-RPT-02	智能结论验证	模拟“压裂有效率 = 5%” (无效)	生成的报告结论章节自动写入：“本次压裂效果不佳...”，并用红色字体标记（Word中）。
TC-RPT-03	缺项数据生成	该时间段无“微震数据”	报告正常生成，不崩溃。第二章微震部分显示“无数据”，且评价指标中微震项分数为 0 或 N/A。
TC-RPT-04	并发压力测试	10个用户同时点击生成	服务器排队处理，不出现内存溢出，所有任务最终均完成生成。

(2) 报告导出功能
1. 功能描述 (Functional Description)
本模块提供灵活的评价结果输出能力，支持将生成的压裂效果评价报告转化为标准化的文件格式进行本地存储或流转。
多格式支持：提供“版式还原”的 PDF 导出（用于正式汇报、打印、归档）和“数据结构化”的 Excel 导出（用于科研人员进行二次统计分析）。
按需定制：用户可自定义导出范围（如只导出数据表，不导出文字结论）及文件命名规则，满足个性化存贮需求。
审计追踪：系统自动记录每一次导出操作的“人、时、地、事”，形成可追溯的数据分发日志，保障数据安全。
2. 业务逻辑 (Business Logic)
核心逻辑包括格式转换引擎、内容组装策略与审计日志记录。
A. PDF 导出逻辑 (Layout Preservation)
渲染引擎：基于 (1) 中生成的 Word 模板或 HTML 预览页，利用 PDF 转换组件（如 Aspose.Words / Puppeteer）进行高保真渲染。
排版锁定：确保分页符、图表位置、表格边框、页眉页脚（含页码、机密标识）在导出后不发生错位。
矢量图表：对于折线图、柱状图，优先使用 SVG 矢量格式嵌入 PDF，确保放大打印不失真。
B. Excel 导出逻辑 (Data Serialization)
分表策略 (Multi-Sheet)：不直接导出 Word 中的表格图片，而是将数据重组为多 Sheet 结构的 Excel 文件：
Sheet 1 - 评价结论：包含核心指标得分、等级、文字建议。
Sheet 2 - 矿压监测数据：压裂前后对比的时序数据（时间, P1, P2, P3）。
Sheet 3 - 微震事件清单：微震事件列表（时间, 能量, 坐标）。
Sheet 4 - 变形监测数据：两帮及顶底板变形量数据。
元数据保留：保留数据的物理单位（如 MPa, mm, J）和表头说明。
C. 导出设置逻辑 (Configuration)
范围过滤：
FULL (完整报告)：导出所有章节。
DATA_ONLY (仅数据)：仅导出 Excel 中的 Sheet 2/3/4 或 PDF 中的附表。
CHART_ONLY (仅图表)：仅导出所有生成的统计图图片包 (.zip)。
命名规则：
默认格式字符串：压裂效果评价报告 - {Borehole_ID} - {Date}.{ext}
示例：压裂效果评价报告-28联巷1号孔-20260205.pdf
支持用户在前端修改文件名（但扩展名不可变）。
D. 导出记录逻辑 (Audit Logging)
当文件流成功传输给前端后，后端触发异步日志写入：
记录：timestamp (当前时间), user_id (操作人), export_type (PDF/Excel), file_path (若服务器留存副本), client_ip。
3. 输入输出 (Input & Output)
输入数据 (Input)
参数名	来源	类型	说明
report_id	前端传递	String	目标报告的唯一标识
export_format	用户选择	Enum	PDF / EXCEL / ZIP
export_scope	用户选择	Enum	FULL / DATA / CHART
custom_filename	用户输入	String	(可选) 自定义文件名

输出数据 (Output)
HTTP Response：文件二进制流 (application/pdf 或 application/vnd.ms-excel)，Header 中包含 Content-Disposition: attachment; filename="..."。
Log Record：
SQL
INSERT INTO export_log (time, user, format, target) VALUES ('2026-02-05 14:30', '张工', 'PDF', 'RPT-20260205-001');
4. 约束条件 (Constraints)
安全性约束：仅拥有“数据导出权限”的角色（如技术科长、总工）才可执行导出操作，普通浏览用户该按钮置灰。
性能约束：Excel 导出时，若单张 Sheet 行数超过 100,000 行（如秒级微震数据），需自动分 Sheet 存储（如 微震数据_1, 微震数据_2），防止 Excel 崩溃或导出超时。
文件名约束：自定义文件名中严禁包含特殊字符（如 / \ : * ? " < > |），后端需进行正则校验和自动清洗。
5. Web 界面与操作流程
A. 界面布局
导出设置弹窗 (Export Dialog)：
点击“导出”按钮后触发。
格式选择：单选按钮组 [🔘 PDF 文档] [⚪ Excel 数据表] [⚪ 图表压缩包]。
内容范围：复选框 [☑️ 包含封面目录] [☑️ 包含原始数据附录]。
文件名：输入框，默认显示 压裂效果评价报告-钻孔编号-日期。
导出历史列表：
位于“报表管理中心”页面的底部。
表格列：导出时间 | 文件名 | 格式 | 操作人 | 状态。
B. 操作流程
用户在报告预览页面，点击右上角的【导出】图标。
系统弹出设置框。
用户选择格式为 Excel，意图进行后续的数据回归分析。
用户修改文件名为 2月5日会议汇报数据.xlsx。
点击【确认导出】。
浏览器左下角开始下载文件。
系统后台增加一条“张三于 14:00 导出 Excel”的日志记录。
6. 测试用例 (Test Cases)
用例 ID	测试场景	输入模拟	预期结果 (Pass Criteria)
TC-EXP-01	PDF 完整性测试	导出完整 PDF 报告	1. 文件能被 Adobe Reader 打开。2. 目录链接有效。3. 表格跨页时表头自动重复，无乱码。
TC-EXP-02	Excel 数据可用性	导出 Excel 数据包	1. 包含 4 个 Sheet。2. 监测数据列为数值格式（可直接求和），而非文本格式。3. 时间列格式正确。
TC-EXP-03	特殊字符文件名	输入文件名：报告/2026*	系统自动替换非法字符，实际下载文件名为 报告_2026_，或前端直接拦截提示错误。
TC-EXP-04	权限控制测试	使用“实习生”账号登录	【导出】按钮不可见或点击提示“无权限”。
(3)报告历史版本管理
1. 功能描述 (Functional Description)
本模块旨在构建评价报告的全生命周期管理机制，记录从“初稿”到“终稿”的每一次迭代。
版本溯源：自动记录报告的每一次生成、修改与参数调整，形成完整的版本演进链。
智能比对：提供类似代码管理的“Diff”功能，可视化展示两个版本间的数据差异、结论变化及图表异同，辅助工程师快速识别变更点。
容错回滚：当最新报告出现数据错误或误操作时，支持一键恢复至任意历史状态，保障数据安全。
2. 业务逻辑 (Business Logic)
核心逻辑包括版本快照机制、差异计算引擎与状态回滚策略。
A. 版本保存机制 (Snapshot Strategy)
触发条件：
参数重算：用户修改了前序模块（如数据对比窗口期）并点击“重新生成”。
人工修订：用户在报告预览页手动修改了“结论与建议”文字并保存。
命名规则：采用 V{Major}.{Minor} 格式。
V1.0：首次生成。
V1.x：仅修改文字结论或排版。
Vx.0：修改了核心计算参数（如权重、阈值），导致指标得分发生变化。
存储内容：保存该时刻的 JSON 数据源快照 + 生成的 PDF 文件引用 + 修改日志 (Changelog)。
B. 版本对比逻辑 (Diff Engine)
对象锁定：仅允许对比同一评价对象（如同为“28联巷1号孔”）的不同版本，严禁跨对象对比。
差异维度：
元数据对比：生成人、生成时间、所用模板。
指标对比：对比核心KPI（如“压裂有效率”），若数值变化超过 1%，标记为高亮。
文本对比：采用语义对比算法，标识“新增（绿色）”、“删除（红色）”和“修改（黄色）”的段落。
图表对比：不对比图片像素，而是对比生成图表的源数据序列。若数据点变化，提示“图表数据源已更新”。
C. 版本恢复逻辑 (Rollback)
用户选择历史版本 V_{old} 点击“恢复”时：
系统并不删除当前版本 V_{current}。
系统基于 V_{old} 的数据快照，生成一个新的版本 V_{new} (内容等同于 V_{old}$。
将 V_{new} 标记为“当前生效版本 (Active)”。
安全锁：恢复操作需进行二次确认，防止误触。
3. 输入输出 (Input & Output)
输入数据 (Input)
参数名	来源	类型	说明
report_id	前端传递	String	报告唯一标识
version_a	用户选择	String	对比基准版本号 (如 V1.0)
version_b	用户选择	String	对比目标版本号 (如 V1.2)
restore_target	用户选择	String	拟恢复的版本号
输出数据 (Output JSON)
JSON
{
  "version_list": [
    {"v_id": "V1.2", "time": "2026-02-06 10:00", "editor": "张工", "note": "修订结论", "is_active": true},
    {"v_id": "V1.1", "time": "2026-02-05 15:30", "editor": "李工", "note": "调整微震权重", "is_active": false},
    {"v_id": "V1.0", "time": "2026-02-05 14:00", "editor": "系统", "note": "自动生成", "is_active": false}
  ],
  "diff_result": {
    "score_change": {
      "metric": "压裂有效率",
      "old_val": "45.5%",
      "new_val": "48.2%",
      "delta": "+2.7%"
    },
    "text_diff": [
      {"loc": "第4章-结论", "type": "MOD", "content": "建议后续<del>减少</del><ins>维持</ins>注水量..."}
    ]
  }
}
4. 约束条件 (Constraints)
不可篡改性：历史版本一旦生成，处于只读 (Read-Only) 状态。即使用户恢复了 V1.0，也只是复制了 V1.0 的内容生成 V1.3，原始的 V1.0 记录不得被物理删除或修改。
存储容量控制：仅保留最近 20个 版本。超过限制时，自动清理中间的非关键版本（保留首尾版本和被标记为“里程碑”的版本）。
对比限制：若两个版本所使用的“评价指标体系”完全不同（例如 V1.0 用了旧公式，V2.0 用了新公式），系统应提示“计算模型不兼容，仅展示文本差异，不对比数值”。
5. Web 界面与操作流程
A. 界面布局
侧边栏 - 版本时间轴：
位于报告详情页右侧。
以垂直时间轴展示所有版本，当前版本高亮显示，带有【对比】和【恢复】的小图标。
差异对比视图 (Diff Viewer)：
双栏模式：左侧显示旧版本，右侧显示新版本。
同步滚动：左右两侧内容联动滚动。
高亮标记：差异之处用背景色高亮，点击高亮处可显示具体的数值变化。
B. 操作流程
发现问题：总工审阅报告 V1.2 时，认为结论过于保守，且发现数据与昨天看的不一致。
查看历史：点击右侧“历史版本”，选择 V1.0（昨天的版本）与 V1.2 进行勾选【对比】。
分析差异：进入双栏视图，系统提示“第3章数据表有变更”。发现 V1.2 的微震能量过滤阈值被修改了，导致有效率下降。
执行恢复：确认 V1.2 是误操作。点击 V1.0 旁的【恢复此版本】按钮。
确认操作：系统弹窗“将基于 V1.0 生成新版本 V1.3，是否继续？” -> 点击【确定】。
完成：页面刷新，当前版本变为 V1.3，内容与 V1.0 一致。
6. 测试用例 (Test Cases)
用例 ID	测试场景	输入模拟	预期结果 (Pass Criteria)
TC-VER-01	版本自动迭代	当前为 V1.0，修改微震权重后重新生成	系统自动生成 V2.0，版本列表中出现 V2.0 且标记为 Active，V1.0 变为历史状态。
TC-VER-02	差异高亮测试	V1 结论：“效果优秀”V2 结论：“效果良好”	在对比视图中，“优秀”显示为红色删除线，“良好”显示为绿色背景。
TC-VER-03	跨对象查询	尝试用“1号孔报告”的 ID 查询“2号孔”的历史	系统拦截请求，提示“对象不匹配”或返回空列表。
TC-VER-04	恢复功能验证	恢复 V1.0	1. 产生新记录 V3.0（内容同 V1.0）。2. 之前的 V2.0 依然存在于列表中（未丢失）。3. 页面显示的当前指标数值恢复为 V1.0 的数值。
5.5 辅助功能模块
5.5.1 报警功能
(1)阈值设置
1. 功能描述 (Functional Description)
本模块提供灵活且严谨的监测指标报警界限配置能力。它允许授权用户根据不同的地质条件、设备特性及作业阶段，定制化定义触发报警的逻辑规则。
多维规则定义：打破单一的“数值超限”逻辑，引入“变化率（突变）”和“持续时间（防抖）”维度，支持复合报警策略。
层级化配置：支持从“全矿通用”到“特定传感器”的层级继承配置，既能快速批量设置，也能满足局部特殊地质构造（如断层带）的精细化管控。
安全闭环管理：引入“修改-审批-生效”的严格管控流程，并提供完整的历史版本回溯与一键回滚能力，防止因参数误配引发的安全事故。
2. 业务逻辑 (Business Logic)
核心逻辑包含规则引擎定义、配置继承策略与变更审批流。
A. 阈值规则类型 (Rule Types)
系统支持三种逻辑维度的组合配置：
静态数值阈值 (Static Value)：
上限 (L_{high})：如 P > 60MPa（支架严重过载）。
下限 (L_{low})：如 P < 10MPa（支架初撑力不足/漏液）。
动态变化率阈值 (Rate of Change)：
公式：
场景：微震能量在 1 小时内激增 100%，或瓦斯浓度瞬间飙升。
时间窗阈值 (Duration/Persistence)：
逻辑：仅当异常状态持续超过 T_{persist} (如 5 分钟) 时才触发。
目的：过滤传感器电磁干扰产生的瞬间毛刺（Spike）。
B. 配置继承策略 (Configuration Inheritance)
采用 “具体优先于通用” 的覆盖原则：
Level 1 (全局默认)：如“全矿液压支架默认报警上限 40MPa”。
Level 2 (区域配置)：如“11223 回风顺槽区域（断层带）上限下调至 35MPa”。
Level 3 (单机配置)：如“#55 号支架（压力计故障需屏蔽）上限设为 999MPa”。
判定逻辑：算法读取阈值时，优先查找 Device ID 配置--其次查找 Area ID 配置 --最后使用 Global Defaults。
C. 变更审批与回滚 (Change Management)
提交 (Submit)：工程师修改阈值，状态变为 PENDING_APPROVAL（待审批），此时新阈值不生效，系统仍按旧阈值运行。
审批 (Approve)：管理员（如总工）收到通知，点击“通过”。
生效 (Activate)：状态变为 ACTIVE，旧配置自动归档为 ARCHIVED。
回滚 (Rollback)：若新阈值导致大量误报，管理员可查看历史记录，点击“恢复此版本”，立即覆盖当前配置。
3. 输入输出 (Input & Output)
输入数据 (Input)
参数名	必填	类型	说明
target_scope	是	Object	{type: "DEVICE", id: "支架#50"} 或 {type: "AREA", id: "11223"}
metric_type	是	Enum	PRESSURE / MICROSEISMIC / DEFORMATION
rules	是	List	[{type: "MAX", val: 40}, {type: "DURATION", val: 300s}]
reason	是	String	修改原因（如：工作面推进过断层，需降低阈值）

输出数据 (Output)
配置生效：更新 Redis 或数据库中的规则表，实时计算引擎立即加载新规则。
操作日志：
JSON
{
  "log_id": "CFG-20260206-001",
  "action": "UPDATE_THRESHOLD",
  "operator": "张工",
  "approver": "李总工",
  "before": {"max": 40.0},
  "after": {"max": 35.0},
  "time": "2026-02-06 10:30:00"
}
4. 约束条件 (Constraints)
逻辑自洽性校验：
Max > Min：严禁设置 上限 < 下限。
非负约束：对于能量、压力等物理量，严禁设置负数阈值。
空窗期保护：在“修改提交”但“未审批”的期间，系统必须严格执行旧阈值，严禁出现监测空窗期。
极值熔断：系统应内置一套**“硬编码安全底线”**（如支架压力不得超过 100MPa），防止人为误操作（如手误输入 5000MPa）导致报警完全失效。
5. Web 界面与操作流程
A. 界面布局
左侧导航树：
按“矿区 -> 工作面 -> 巷道 -> 设备类型”层级展开。
右侧配置面板：
当前生效规则卡片：显示正在运行的阈值（绿色边框）。
待审批规则卡片：显示已提交但未通过的草稿（黄色虚线框）。
参数设置表单：
[数值上限 Input] [数值下限 Input]
[变化率上限 Input] / [单位时间 Select]
[持续时间 Input] (防抖动)
底部历史轴：
时间轴显示历史版本（V1, V2, V3...），点击可“查看详情”或“一键回滚”。
B. 操作流程 (用户 A 修改，用户 B 审批)
张工（技术员）操作：
登录系统，选择“11223 工作面”。
将“支架压力报警上限”由 40MPa 修改为 38MPa。
填写备注：“顶板破碎，加强管控”。
点击【提交审批】。系统提示：“已通知李总工，当前仍执行 40MPa 标准。”
李总（管理员）操作：
收到系统消息：“张工申请修改阈值”。
查看变更对比（40变为38），认为合理。
点击【批准生效】。
系统提示：“新阈值 38MPa 已下发至监测引擎。”
6. 测试用例 (Test Cases)
用例 ID	测试场景	操作步骤	预期结果 (Pass Criteria)
TC-THR-01	复合阈值触发	设置：上限 40MPa + 持续 5分钟	1. 模拟压力 42MPa 持续 3分钟 → 不报警。2. 模拟压力 42MPa 持续 6分钟 → 触发报警。
TC-THR-02	逻辑冲突校验	设置：上限 10MPa，下限 20MPa	前端直接拦截提交，提示“下限不可高于上限”。
TC-THR-03	审批流程闭环	提交修改 → 拒绝审批	1. 状态变为 REJECTED。2. 系统继续使用旧阈值运行。3. 提交人收到驳回通知。
TC-THR-04	版本回滚	当前 V2，点击“回滚至 V1”	1. 系统生成新版本 V3（内容同 V1）。2. 报警逻辑立即恢复为 V1 的参数。
（2）报警触发与通知
1. 功能描述 (Functional Description)
本模块负责实时扫描监测数据流，依据预设的阈值规则（数值、变化率、持续时间）进行逻辑研判。一旦识别出异常，立即根据风险等级，通过 Web 界面、短信网关及物理声光设备等多渠道分发报警信息。
实时研判：内置高性能规则引擎，支持毫秒级的数据流匹配。
分级响应：严格区分“预警（黄色）”与“紧急报警（红色）”，避免因过度干扰导致管理人员对报警脱敏。
多维触达：构建“屏+端+场”的立体通知网——屏幕弹窗强提醒、手机短信远程通知、现场声光物理警示。
2. 业务逻辑 (Business Logic)
核心逻辑包括异常捕获、等级判定与策略分发。
A. 报警触发逻辑 (Trigger Engine)
系统订阅实时消息队列（如 Kafka），对每一帧监测数据执行以下校验：
阈值比对：获取该设备当前生效的阈值配置 T。
去抖动判定 (Debounce)：
若配置了“持续时间阈值” t_{dur}（如 5s），系统开启一个计时器。
只有当异常状态连续保持超过 t_{dur}，才正式生成报警事件；否则视为干扰脉冲，予以忽略。
状态锁定：报警触发后，设备状态锁定为 ALARM，直到数值回落至正常区间（通常包含死区/回差，如低于 58MPa）才解除。
B. 报警级别划分 (Level Classification)
预警信息 (Warning)：
逻辑：T_{warn}<=Value} < T_{critical}。
示例：支架压力>= 50MPa 且 < 60MPa。
含义：趋势不好，需关注，但暂无即刻灾变风险。
紧急报警 (Critical)：
逻辑：Value>=T_{critical}。
示例：支架压力>=60MPa。
含义：指标严重超限，需立即停机或采取措施。
C. 通知分发策略 (Notification Strategy)
渠道	触发条件	接收对象	交互行为
平台弹窗	预警 / 紧急	当前在线的所有用户	预警：右下角 Toast 提示，不阻断操作。紧急：屏幕中央模态弹窗（Modal），伴随警报音，需手动确认。
短信通知	紧急(必选) / 预警(可选)	预设的“报警联系人组”	调用 GPRS 网关发送：“【安全预警】11223工作面#50支架压力62MPa，请立即处置。”
声光报警	仅限紧急	监测中心大屏旁硬件	触发 GPIO 信号，启动物理警灯闪烁和蜂鸣器长鸣。

D. 报警记录闭环 (Logging)
每条报警生成唯一的 alarm_id，并记录全生命周期：
Create: 触发时间、触发值。
Notify: 通知发送状态（短信是否送达）。
Ack: 谁、在什么时候点击了“确认”。
Resolve: 警情何时消除。
3. 输入输出 (Input & Output)
输入数据 (Input)
输出数据 (Output)
参数名	来源	类型	说明
realtime_data	数据采集层	Stream	{dev_id: "S_50", value: 62.5, time: ...}
threshold_cfg	阈值设置模块	Object	{warn: 50, critical: 60, duration: 5s}
contact_list	用户管理	List	管理员手机号列表
Websocket 推送：前端界面渲染弹窗。
GPRS 指令：通过串口或 HTTP 接口向短信猫发送文本。
硬件指令：DO_OUTPUT: ON (控制继电器)。
数据库记录：
JSON
{
  "alarm_id": "ALM-20260206-88",
  "level": "CRITICAL",
  "device": "支架#50",
  "trigger_val": 62.5,
  "threshold": 60.0,
  "sms_status": "SENT",
  "is_resolved": false
}
4. 约束条件 (Constraints)
防风暴机制 (Storm Control)：
短信频控：若同一设备在 10 分钟内反复触发报警（如数值在 60MPa 上下波动），系统仅发送第一条短信，后续仅在平台记录，避免短信轰炸。
聚合发送：若 1 分钟内有 50 台支架同时报警（如大面积来压），短信应合并为一条：“11223工作面 #1-#50 等50台设备压力超限”。
硬件可靠性：
若 GPRS 网关无响应（超时 5s），系统应自动尝试备用通道（如企业微信/钉钉接口）或记录“短信发送失败”日志。
最高优先级：
报警处理线程的优先级应高于报表生成、历史查询等任务，确保延迟 < 1s。
5. Web 界面与操作流程
A. 界面布局
全局悬浮窗：
当发生紧急报警时，无论用户在哪个页面，屏幕中央弹出红色边框卡片。
显示内容：报警时间、位置、当前值、超限幅度。
按钮：【确认收到】（点击后声光停止）、【查看详情】（跳转至实时曲线）。
顶部通知栏：
铃铛图标右上角显示未读报警数。
点击下拉列表，区分显示“待处理”和“已恢复”的记录。
B. 操作流程
场景触发：井下发生一次冲击地压事件，微震能量达 5*10^4 J。
系统响应：
监测中心音箱立即发出蜂鸣声。
大屏弹出红色警告框。
值班矿长的手机收到短信。
人员处置：
值班员点击弹窗上的【确认收到】，声光报警器静音。
值班员电话通知井下撤人。
记录归档：
系统自动记录：“值班员张三于 10:05:23 确认报警”。
6. 测试用例 (Test Cases)
用例 ID	测试场景	输入模拟	预期结果 (Pass Criteria)
TC-ALM-01	持续时间阈值验证	设阈值60MPa/5秒。输入：62MPa 持续 3s 后降为 50。	系统不触发报警（成功过滤毛刺）。
TC-ALM-02	紧急报警全通道	设阈值60MPa。输入：65MPa。	1. 网页弹出红色模态框。2. 短信网关日志显示发送成功。3. 模拟声光信号输出为 High。
TC-ALM-03	预警信息验证	设预警50MPa。输入：55MPa。	1. 网页右下角弹出黄色 Toast。2. 不触发声光报警。3. 短信发送（若配置为“预警可选：发送”）。
TC-ALM-04	短信防轰炸	1分钟内连续触发10次相同报警。	仅第1次发送短信，后续9次仅在数据库记录，无短信发出。
(3)报警处置与反馈
1. 功能描述 (Functional Description)
本模块提供对报警事件的全生命周期管理能力，构建 “触发 -> 感知 -> 处置 -> 归档 -> 复盘” 的业务闭环。
工单化管理：系统自动将每一条报警转化为处置工单，追踪其处理进度。
双向消警机制：支持基于数据恢复的“自动消警”和基于人为判断的“手动消警”，兼顾系统自动化与现场灵活性。
超时升级机制：针对长时间未响应的报警，自动触发升级通知（Escalation），防止安全隐患因人为疏忽而扩大。
绩效量化分析：通过统计处置率和响应时效，量化评估各班组的安全管理执行力。
2. 业务逻辑 (Business Logic)
核心逻辑包括状态机流转、超时升级策略与统计分析引擎。
A. 报警状态机 (Alarm State Machine)
一条报警记录包含 4 种状态，流转逻辑如下：
未确认 (New)：报警触发后的初始状态。
已确认 (Acknowledged)：
动作：用户点击【确认收到】。
意义：表示值班员已知晓，声光报警暂停，但隐患未消除（数据仍超限）。
处置中 (Processing)：
动作：用户填写【处置记录】（如：正在调整泵站压力）。
意义：现场正在进行整改措施。
已清除 (Resolved)：
自动清除：监测值回到正常区间（V < T_{limit}）且持续时长>=10 分钟（防止数值在临界点反复跳变）。
手动清除：用户强制关闭报警（通常用于传感器故障或误报场景），需强制填写备注。
B. 处置记录逻辑 (Handling Logic)
用户在处置时需录入结构化信息：
处置措施：下拉选择（如：调整压裂参数、加强支护、停机检查、传感器校准、其他）。
处置描述：文本输入（如：“已通知综采队张三，将泵站压力调至 30MPa”）。
现场照片：(可选) 上传整改后的现场照片。
系统自动补全：operator_id (当前用户)、handle_time (当前时间)。
C. 二次通知/升级机制 (Escalation)
系统启动后台守护线程，每分钟扫描活跃报警：
紧急报警升级：若 status != RESOLVED 且 current_time - trigger_time > 30 min--发送短信给上级领导（如总工/矿长）。
预警信息升级：若 status != RESOLVED 且 current_time - trigger_time > 2 hours --再次发送短信给当前值班员。
D. 统计反馈指标 (Feedback Metrics)
报警处置率：
平均响应时间 (MTTA)：从“触发”到“确认”的平均时长。
平均解决时间 (MTTR)：从“触发”到“清除”的平均时长。
重复报警 TopN：统计同一设备、同一原因报警频次，识别“病态设备”。
3. 输入输出 (Input & Output)
输入数据 (Input)
参数名	来源	类型	说明
alarm_id	前端	String	目标报警 ID
action_type	用户	Enum	ACKNOWLEDGE / HANDLE / CLEAR
handle_detail	用户	Object	{method: "ADJUST_PARAM", note: "..."}
realtime_value	监测流	Float	用于判定自动清除条件

输出数据 (Output)
操作结果：更新数据库状态，返回 Success。
升级通知：调用短信网关发送：“【严重超时】11223工作面#50支架压力报警已持续30分钟未消除，请督办。”
处置报告 (JSON)：
JSON
{
  "report_date": "2026-02-06",
  "total_alarms": 20,
  "handled_rate": 95.0,
  "avg_resolve_time_min": 15.4,
  "top_repeat_device": "微震传感器#03 (5次)"
}
4. 约束条件 (Constraints)
权限互斥：
任何人都可以“确认”报警。
只有“技术员”及以上权限可以填写“处置记录”。
只有“管理员”可以针对紧急报警执行“手动清除”（防止掩盖事故）。
时序逻辑：
必须先“确认”，才能“处置”或“清除”。
防抖动清除：
“自动清除”必须严格执行 10 分钟守候期。若在第 9 分钟数值再次超限，计时器重置，状态保持为“报警中”。
5. Web 界面与操作流程
A. 界面布局
报警中心看板：
顶部统计条：今日报警总数 | 待处置数 (红) | 处置率 | 平均耗时。
左侧列表：按时间倒序排列的报警卡片。卡片左侧有竖条标记状态颜色（红/黄/绿）。
右侧详情区：
顶部：报警时刻的快照数据与阈值对比图。
中部：处置流程时间轴（触发 10:00 -> 确认 10:01 -> 处置 10:05 -> 恢复 10:20）。
底部操作区：[确认收到] [填写处置单] [强制清除]。
处置单弹窗：
表单包含：处置方式（下拉）、详细描述（文本域）、附件上传。
B. 操作流程
收到通知：值班员李四听到警报，看到屏幕显示“支架 #50 压力超限”。
响应：李四点击列表中的报警卡片，点击【确认收到】，警报声停止，状态变为“已确认”。
处置：
李四电话通知井下：“#50 支架压力 62MPa，赶紧降压。”
井下回复：“收到，正在操作。”
李四点击【填写处置单】，选择“现场调整”，备注“通知综采队降压”，提交。状态变为“处置中”。
恢复：
15分钟后，系统监测到压力降至 40MPa 且已保持 10分钟。
系统自动将状态更新为“已清除”，并在时间轴记录“系统自动恢复”。
6. 测试用例 (Test Cases)
用例 ID	测试场景	操作步骤	预期结果 (Pass Criteria)
TC-HDL-01	正常闭环流程	触发 -> 确认 -> 处置 -> 数据恢复正常(>10min)	状态流转顺畅，最终状态为 RESOLVED，记录中包含人工操作记录和系统自动恢复记录。
TC-HDL-02	自动清除防抖	触发 -> 数据恢复正常 8分钟 -> 再次超限	状态保持报警，计时器重置，不触发清除逻辑。
TC-HDL-03	超时升级验证	触发紧急报警 -> 放置 31分钟不处理	后台日志显示触发“升级通知”，向管理员发送了短信。
TC-HDL-04	统计报表准确性	产生 10 条报警，处置 8 条，忽略 2 条	生成日报时，处置率显示 80%，未处置的 2 条记录被列入“遗留隐患”列表。
5.5.2 数据查询与导出
(1)多条件查询
1. 功能描述 (Functional Description)
本模块提供对全矿井历史监测数据的精细化检索能力。鉴于煤矿数据具有多源、异构、海量的特征，系统需提供一个高度可配置的查询引擎。
全域检索：覆盖矿压、微震、变形、压裂施工等所有子系统数据。
组合过滤：支持通过时间、空间、物理量、数据质量等多维度的逻辑组合（AND/OR），快速定位异常数据或特定工况段。
效率工具：提供“查询模板”功能，将复杂的查询条件固化为快捷方式，满足调度员日常巡检或技术员定期分析的快捷需求。
2. 业务逻辑 (Business Logic)
核心逻辑包括查询条件解析、模板管理与分页检索引擎。
A. 复合查询条件构建 (Query Builder)
系统支持以下四类条件的动态拼装：
时间维度：
支持绝对时间段（2026-02-01 08:00:00 至 2026-02-01 16:00:00）。
支持相对时间快捷键（近 1 小时、本班次、近 3 天）。
空间维度 (层级联动)：
树状选择：工作面 (11223)--巷道 (回风顺槽)--(3#)--钻孔 (1-1) --压裂段 (第3段)。
传感器定位：支持直接输入传感器 ID（如 P_1024）或设备别名。
指标维度：
类型过滤：复选框选择（☑️ 支架阻力, ☑️ 微震能量）。
数值范围：支持区间筛选（如 30<=Value<=60）或极值筛选（> 1000）。
状态/质量维度：
数据标记：筛选 原始数据（Raw）或 清洗后数据（Cleaned/Interpolated）。
通讯状态：筛选 在线 或 离线 时段的数据。
B. 逻辑组合与模糊匹配
逻辑关系：不同维度间默认为 AND 关系（如：时间 AND 地点 AND 压力>30）；同一维度内支持 OR 关系（如：支架 #10 OR 支架 #11）。
模糊搜索：传感器编号支持通配符查询，例如输入 ZJ-11223-* 可检索该工作面下所有支架数据。
C. 查询模板管理 (Template Management)
保存：用户配置好复杂的筛选条件后，可点击“存为模板”，命名为“早班高压巡查”。
调用：下次进入页面，从下拉菜单选择该模板，条件自动填充。
权限：支持“个人模板”（私有）和“公共模板”（全员可见，需管理员权限）。
D. 分页显示策略
后端采用 Limit/Offset 或 Scroll ID 机制。
前端支持动态调整 PageSize (10/20/50/100)，默认 20 条。
支持列排序：点击表头（如“监测值”），按升序/降序重排当前页或全量数据。
3. 输入输出 (Input & Output)
输入数据 (Input)
参数名	类型	说明	示例
time_range	Object	起止时间	{start: "2026-02-01 00:00:00", end: "..."}
spatial_scope	List	空间ID列表	["DEVICE_01", "DEVICE_02"]
metric_filters	List	指标范围	[{type: "PRESSURE", min: 30, max: 60}]
keyword	String	模糊搜索词	"11223_RF_*"
page_config	Object	分页参数	{page: 1, size: 50, sort: "time_desc"}
输出数据 (Output)
JSON
{
  "total": 15420,  // 总记录数
  "page": 1,
  "size": 50,
  "items": [
    {
      "time": "2026-02-01 10:00:01",
      "device_name": "11223-支架#50",
      "location": "回风顺槽 1200m",
      "metric_type": "支架压力",
      "value": 45.2,
      "unit": "MPa",
      "status": "NORMAL"
    },
    // ... 更多记录
  ]
}
4. 约束条件 (Constraints)
查询跨度限制：为保护数据库性能，秒级数据的查询跨度单次不得超过 7天。若需查询更长时间范围，建议引导用户切换至“小时级聚合数据”或分批导出。
响应时间：普通查询（百万级数据量下）响应时间应 < 2秒。
数据权限：用户只能查询其权限范围内的区域数据（如：掘进队用户不可查询综采面数据）。
5. Web 界面与操作流程
A. 界面布局
顶部：高级筛选栏 (Collapsible Filter Bar)：
第一行：[时间范围选择] [空间层级级联选择] [模糊搜索框] [查询按钮]。
第二行（展开后）：[指标类型复选] [数值范围滑块] [数据状态下拉]。
右上角：[模板管理] 按钮组（保存、加载）。
中部：数据表格区：
标准 Grid 表格，支持列宽调整、列显隐设置。
每行右侧操作列：[查看详情]（跳转趋势图）。
底部：分页控制栏：
显示“共 15420 条，当前 1-50 条”。
下拉选择“50 条/页”。
B. 操作流程
场景：技术员需要查找昨晚 8 点到 10 点，压力超过 40MPa 的所有支架数据。
设置时间：在时间控件选择 2026-02-05 20:00:00 ~ 22:00:00。
设置指标：指标类型勾选 支架压力，数值范围输入 Min=40。
执行查询：点击【查询】，表格加载出 500 条记录。
保存模板：点击【存为模板】，输入名称“高压异常筛查”，保存。
浏览数据：将每页条数改为 100，快速翻页查看传感器分布情况。
6. 测试用例 (Test Cases)
用例 ID	测试场景	输入模拟	预期结果 (Pass Criteria)
TC-QRY-01	多条件组合查询	时间：近1小时设备：支架#1 - #10压力：>30MPa	返回结果列表中的每一条数据均同时满足上述3个条件。
TC-QRY-02	模糊查询验证	传感器编号输入 *_MS_* (微震)	结果中仅包含包含微震传感器的数据，排除液压支架数据。
TC-QRY-03	模板调用	加载“早班高压巡查”模板	筛选栏中的时间（自动变为今日早班）、区域、阈值等条件自动填充正确。
TC-QRY-04	无结果处理	设置一个不可能的条件（如压力 > 10000MPa）	表格显示“暂无数据”，不报错。
(2) 数据导出
1. 功能描述 (Functional Description)
本模块旨在打通线上监测平台与线下分析工具（如 Excel, MATLAB, SPSS）之间的数据通道。支持用户将查询到的多维监测数据，按照自定义的格式和范围导出为标准的 Excel 文件。
按需定制：用户不仅可以决定“导出哪些行”（数据范围），还可以决定“导出哪些列”（字段裁剪），避免导出包含大量无用系统字段的冗余文件。
高性能分流：针对不同量级的数据请求，自动切换“实时流式导出”与“后台异步导出”模式，既保证小文件的即时性，又防止大文件导出导致浏览器假死或服务器内存溢出。
全程可追溯：对敏感数据的导出行为进行全记录，满足企业数据安全审计需求。
2. 业务逻辑 (Business Logic)
核心逻辑包括导出参数配置、任务分流引擎、文件生成策略与审计记录。
A. 导出配置逻辑 (Configuration Strategy)
用户点击“导出”按钮后，系统弹出配置向导：
字段选择：
展示所有可用字段（如：时间、设备名、压力值、温度、状态码）。
默认全选。用户取消勾选某些字段（如“设备内部ID”），导出的 Excel 中将不包含该列。
范围选择：
当前页：仅导出表格当前显示的 10~100 条数据（所见即所得）。
全部结果：导出符合当前查询条件的所有记录（可能通过 Count 预判数量）。
文件名规则：
默认格式：监测数据_{查询条件摘要}_{导出日期}.xlsx。
示例：监测数据_11223工作面压力_20260206.xlsx。
支持用户手动修改文件名（系统自动过滤非法字符）。
B. 导出执行策略 (Execution Engine)
系统根据预判的数据量 $N$，自动路由至不同的处理通道：
模式一：实时/批量导出 (N<=100,000)
机制：前端建立 WebSocket 连接或长轮询，后端采用流式写入 (Streaming) 技术生成文件。
交互：前端弹出进度条模态框，实时更新进度（如“已处理 45%... 正在打包...”）。
结果：进度 100% 后，浏览器自动触发下载。
模式二：后台异步导出 ($N > 100,000$)
机制：后端将导出请求放入 MQ 消息队列，由独立的 Worker 线程池慢慢处理。前端立即返回“任务已提交”提示，用户可关闭页面进行其他操作。
交互：不显示进度条，避免长时间阻塞用户。
通知：任务完成后，系统发送站内信/弹窗通知：“您的 11223 工作面数据导出已完成，请前往下载中心下载。”
C. Excel 格式规范 (Formatting)
表头：第一行为中文列名，背景色微灰，字体加粗。
数据类型：
监测值：设为 Number 格式（保留2位小数），方便用户在 Excel 中直接求和/绘图。
时间戳：设为 yyyy-MM-dd HH:mm:ss 文本格式，防止科学计数法显示。
状态：将数据库字典值（0/1）转换为可读文本（离线/在线）。
水印/元数据：在文件属性或隐藏 Sheet 中记录导出人、导出时间（防篡改水印）。
D. 导出记录 (Audit Logging)
每次导出成功后，记录：export_time, user_id, query_params (JSON), row_count, file_path (若有留存)。
3. 输入输出 (Input & Output)
输入数据 (Input)
参数名	类型	说明
query_condition	Object	复用查询模块的筛选条件
export_scope	Enum	CURRENT_PAGE / ALL_RESULTS
selected_fields	List	["time", "device_name", "value", "status"]
filename	String	用户自定义文件名

输出数据 (Output)
场景 A (小数据)：application/vnd.ms-excel 二进制流。
场景 B (大数据)：
立即返回：{code: 200, msg: "任务已转后台", task_id: "EXP-1001"}
最终产物：下载链接 URL。
4. 约束条件 (Constraints)
最大行数限制：即使是异步导出，Excel 单个 Sheet 的物理极限是 104 万行。若查询结果超过 100 万条，系统应提示用户“数据量过大，建议缩小时间范围或导出为 CSV 格式”。
并发控制：为保护服务器内存，同一用户同时只能进行 1 个 异步导出任务；全系统并发导出任务数限制为 5 个（超出排队）。
存储清理：后台异步生成的临时文件，保留 7天 后自动从服务器删除，以释放磁盘空间。
5. Web 界面与操作流程
A. 界面布局
导出配置弹窗：
顶部：文件名输入框。
中部：左右穿梭框（左侧：可选字段，右侧：已选字段）。
底部：单选钮 [🔘 导出当前页] [⚪ 导出全部数据 (共 12,500 条)]。
下载中心 (侧边栏/抽屉)：
列表显示历史异步任务：任务名 | 数据量 | 状态 (处理中/成功/失败/已过期) | 操作 (下载/删除)。
B. 操作流程
场景一：技术员导出昨天的数据（8万条）
在查询页面筛选好数据，点击【导出】。
在弹窗中选择【导出全部数据】，保持默认字段，点击【确认】。
界面出现进度条遮罩层：“正在生成... 30%... 80%”。
约 5 秒后，进度条消失，浏览器自动下载 .xlsx 文件。
场景二：总工导出上个月的数据（50万条）
配置同上，系统检测到数据量 > 10万。
点击【确认】后，系统提示：“数据量较大，已转入后台处理，请稍后在消息中心查看。”
总工继续浏览其他页面。
10 分钟后，右上角铃铛图标亮起红点。
点击铃铛，看到“数据导出完成”，点击链接下载文件。
6. 测试用例 (Test Cases)
用例 ID	测试场景	输入模拟	预期结果 (Pass Criteria)
TC-EXP-01	字段裁剪验证	取消勾选“设备内部ID”列	导出的 Excel 表格中无该列，且数据与表头对应正确，无错位。
TC-EXP-02	批量导出进度条	导出 5 万条数据	1. 界面显示进度条。2. 进度条随时间平滑推进，不卡死在 0%。3. 最终文件下载成功。
TC-EXP-03	异步导出触发	导出 15 万条数据	1. 不显示进度条，直接提示“转后台”。2. 下载中心生成一条“处理中”的任务。3. 任务完成后收到通知。
TC-EXP-04	文件名非法字符	输入文件名：数据/测试?	系统自动替换为下划线 数据_测试_，或前端提示“文件名包含非法字符”。
TC-EXP-05	超限保护	尝试导出 200 万条数据	系统拦截提示：“数据量超过 Excel 限制，请分批导出”。
5.5.3 日志管理
1. 功能描述 (Functional Description)
本模块旨在构建一个不可篡改、全量记录的系统审计追踪体系。它通过 AOP（面向切面编程）技术，无侵入地拦截并记录用户在系统中的每一次关键操作行为。
全链路留痕：从用户登录那一刻起，无论是数据的查询、导出，还是参数的修改、指令的下发，均被记录在案。
精细化审计：不仅记录“谁做了什么”，还记录“改前是什么，改后是什么”，提供参数级的变更对比。
分级查阅：严格的数据权限控制，确保日志数据本身的安全，防止审计记录被恶意窥探或清洗。
2. 业务逻辑 (Business Logic)
核心逻辑包括日志捕获策略、存储生命周期管理与访问控制。
A. 日志数据结构 (Log Structure)
每条日志记录包含三大类信息：
元数据 (Metadata)：
trace_id: 全局唯一追踪ID，用于关联前后端链路。
timestamp: 操作精确时间（毫秒级）。
operator: 用户名/工号。
ip_address: 来源IP及对应的物理位置（如：192.168.1.5 (综采队办公室)）。
module: 操作所属模块（如：报警配置、报表生成）。
action_type: 枚举值（LOGIN, CREATE, UPDATE, DELETE, EXPORT, QUERY）。
载荷信息 (Payload)：
target: 操作对象标识（如：设备ID #50）。
content:
对于查询/导出：记录筛选条件（JSON）。
对于修改：记录 Diff 快照（{before: "阈值60", after: "阈值65"}）。
结果状态 (Result)：
status: SUCCESS / FAIL。
error_msg: 仅失败时记录（如：Stack Trace 或“权限不足”提示）。
B. 存储与归档策略 (Lifecycle Management)
热存储 (Hot Store)：最近 6个月 的日志存入高性能数据库（如 Elasticsearch 或 MySQL 分区表），支持毫秒级检索。
冷备份 (Cold Archive)：
每日凌晨 02:00 执行归档任务。
超过 6个月 的日志被打包压缩（.gz），迁移至对象存储（OSS/MinIO）或磁带库。
归档数据保留 5年（满足煤矿安全监察法规要求）。
不可变性：数据库层面设置日志表为 Append-Only，严禁提供 Delete/Update 接口，仅允许 Insert。
C. 权限控制逻辑 (RBAC)
普通用户：只能查询 operator == current_user 的日志。
系统管理员/安全员：可以查询全量日志，但无权删除日志。
审计员：仅拥有“查看归档日志”的特殊权限。
3. 输入输出 (Input & Output)
输入数据 (Input)
拦截源：HTTP Request Header (Token, IP), Request Body (参数), Controller Method (操作类型)。
输出数据 (Output)
前端查询返回：
JSON
{
  "total": 150,
  "logs": [
    {
      "id": "LOG-20260206-001",
      "time": "2026-02-06 14:30:05",
      "user": "张三 (技术员)",
      "ip": "10.0.0.8",
      "action": "UPDATE_THRESHOLD",
      "module": "报警功能",
      "desc": "修改支架#10压力上限",
      "result": "SUCCESS",
      "details": {
        "before": {"max": 60},
        "after": {"max": 55}
      }
    }
  ]
}
4. 约束条件 (Constraints)
性能隐形约束：日志记录必须是异步执行（Asynchronous）的，严禁因为日志写入数据库慢而阻塞正常的业务操作（如报警处理）。建议使用消息队列（Kafka/RabbitMQ）进行削峰填谷。
脱敏约束：在记录“登录”或“人员管理”操作时，严禁明文记录密码、手机号等敏感信息，必须进行掩码处理（如 ******）。
抗抵赖性：日志必须记录“服务器端时间”，而非“客户端时间”，防止用户篡改本地时间来伪造操作记录。
5. Web 界面与操作流程
A. 界面布局
顶部搜索栏：
组合查询：[时间范围] + [操作人] + [操作类型(下拉)] + [状态(成功/失败)]。
关键字搜索：输入“支架#50”可搜索涉及该对象的所有操作。
日志列表区：
列展示：时间 | 操作人 | IP | 模块 | 动作 | 结果 | 操作。
以颜色区分结果：成功（黑色），失败（红色）。
详情抽屉 (Detail Drawer)：
点击某行“查看详情”，右侧滑出抽屉。
使用 Diff 视图（左红右绿）直观展示参数修改前后的差异。
B. 操作流程
场景：追查异常配置修改
发现问题：总工发现今早 8 点微震报警阈值被莫名调高了，导致漏报。
查询日志：管理员进入“操作日志”页面。
筛选：
时间：今天 07:00 - 09:00
模块：报警设置
动作：UPDATE
定位：列表中显示一条记录，操作人为“李四”。
取证：点击详情，看到 Before: 1000J -> After: 5000J。
追责：管理员截图保留证据。
6. 测试用例 (Test Cases)
用例 ID	测试场景	输入模拟	预期结果 (Pass Criteria)
TC-LOG-01	正常操作记录	用户执行一次“导出Excel”操作	日志列表新增一条记录，Action="EXPORT"，Details包含导出的文件名和筛选条件。
TC-LOG-02	异常捕获	用户尝试删除设备，但后端报错（DB连接失败）	日志记录 Action="DELETE"，Status="FAIL"，Exception字段包含错误堆栈信息。
TC-LOG-03	数据脱敏	用户修改登录密码	日志详情中，“新密码”字段显示为 ******，未明文存储。
TC-LOG-04	权限隔离	使用普通账号“User A”登录并查询日志	仅能看到“User A”自己的操作记录，无法查询管理员的操作。
TC-LOG-05	不可删除性	尝试调用 API 删除某条日志	接口返回 403 Forbidden 或 405 Method Not Allowed，数据库无变化。

6.3 接口技术规范
6.3.1 数据格式标准
1.核心数据格式：采用 JSON 格式作为默认数据交换格式，编码格式为 UTF-8，日期时间格式统一为 “YYYY-MM-DD HH:MM:SS”，数值型数据保留指定小数位（压力≤2 位、坐标≤4 位、能量≤6 位）。
2.非结构化数据：压裂曲线图片、报表文件等非结构化数据，通过 Base64 编码后嵌入 JSON 字段传输，或采用文件 URL 地址引用方式（文件服务器存储）。
3.数据字段规范：所有传输字段名称采用下划线命名法，与数据库表字段一一对应，禁止自定义非标准字段。
6.3.2 接口调用规范
1.接口类型：所有接口均为 RESTful API，HTTP 请求方法遵循 “GET（查询）、POST（提交）、PUT（更新）、DELETE（删除）” 的使用原则。
2.请求格式：HTTP 请求头需包含 “Authorization”（身份令牌）、“Content-Type”（数据格式标识）、“User-ID”（用户标识）字段。
3.响应格式：成功响应返回状态码 200，响应体包含 “code（状态码）、message（描述信息）、data（数据主体）”；失败响应返回对应错误码及描述信息。
6.4 接口安全要求
1.身份认证：所有接口调用需通过 JWT（JSON Web Token）身份认证，令牌有效期为 2 小时，过期需重新获取，令牌包含用户角色、权限范围等信息。
2.权限控制：基于 RBAC（角色基础访问控制）模型，接口调用权限与用户角色绑定，不同角色仅能调用对应权限范围内的接口。
3.数据加密：接口传输数据采用 HTTPS 协议加密（TLS 1.2 及以上版本），敏感数据（如设备密码、坐标信息）需额外进行 AES-256 加密处理。
4.接口限流：为防止恶意请求，接口采用限流机制，单用户单接口最大调用频率≤60 次 / 分钟，超出限流阈值时返回 1003 错误码。
5.日志审计：所有接口调用均记录详细日志，包含调用时间、调用方 IP、请求参数、响应结果、错误信息等，日志留存≥6 个月，支持追溯审计。


环境类型	配置要求
开发环境	JDK 8.0（64 位）、.NET Framework 4.8、Python 3.9、IntelliJ IDEA 2022.1、Visual Studio 2019
测试环境	与生产环境配置一致（服务器配置减半），部署 JMeter 5.4.3（性能测试）、Postman 9.15.2（接口测试）
版本控制	Git + GitLab 14.5.2，支持代码提交审核、分支管理、版本回溯
